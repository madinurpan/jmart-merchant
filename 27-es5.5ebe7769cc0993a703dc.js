function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(s){i=!0,a=s}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{DVvf:function(e,t,n){"use strict";n.r(t);var r=n("ofXK"),i=n("3Pt+"),a=n("sYmb"),o=n("xJkR"),c=n("4Nuw"),s=n("PCNd"),u=n("tyNb"),l=n("fXoL"),d=n("bsP8"),m=n("S1F0"),f=n("oKsb"),h=n("fvpk"),b=n("mrSG"),v=n("quSY"),p=n("itXk"),y=n("lJxs"),A=n("pLZG"),g=n("TwVa"),S=n("+/Tu"),R=n("zwEd"),T=n("4wRv"),k=n("1kSV");function w(e,t){if(1&e&&l.Rb(0,"p",10),2&e){var n=l.mc();l.uc("innerHTML",n.errorText,l.Jc)}}var C,E,O,I=((C=function(){function e(t,n){_classCallCheck(this,e),this.modal=t,this.router=n}return _createClass(e,[{key:"dismissModal",value:function(){this.modal.dismiss()}},{key:"closeModal",value:function(){this.router.navigate(["/transfers"]),this.modal.close()}}]),e}()).\u0275fac=function(e){return new(e||C)(l.Qb(k.a),l.Qb(u.c))},C.\u0275cmp=l.Kb({type:C,selectors:[["j-transfer-error"]],inputs:{description:"description",errorText:"errorText"},decls:15,vars:5,consts:[[1,"modal-header","j-modal-header"],[1,"modal-body","px-4","pt-0","pb-4","text-center"],["src","/assets/img/history/modals/error.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted"],["translate",""],["class","mt-3 mb-0 text-danger",3,"innerHTML",4,"ngIf"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-primary","btn-block","mb-3",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[1,"mt-3","mb-0","text-danger",3,"innerHTML"]],template:function(e,t){1&e&&(l.Rb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"img",2),l.nc(3,"translate"),l.Wb(4,"h3",3),l.Tc(5,"SHARED.ERROR"),l.Vb(),l.Wb(6,"p",4),l.Wb(7,"span",5),l.Tc(8),l.Vb(),l.Vb(),l.Rc(9,w,1,1,"p",6),l.Vb(),l.Wb(10,"div",7),l.Wb(11,"button",8),l.ic("click",(function(e){return t.closeModal()})),l.Tc(12," SHARED.TRY_AGAIN "),l.Vb(),l.Wb(13,"button",9),l.ic("click",(function(e){return t.dismissModal()})),l.Tc(14," SHARED.BACK_TO_HOME "),l.Vb(),l.Vb()),2&e&&(l.Ab(2),l.vc("alt",l.oc(3,3,"SHARED.ERROR")),l.Ab(6),l.Uc(t.description),l.Ab(1),l.uc("ngIf",t.errorText))},directives:[a.a,r.u],pipes:[a.d],styles:[""]}),C),x=n("Kx/q"),N=((E=function(){function e(t){_classCallCheck(this,e),this.modal=t}return _createClass(e,[{key:"dismissModal",value:function(){this.modal.dismiss()}},{key:"closeModal",value:function(){this.modal.close()}}]),e}()).\u0275fac=function(e){return new(e||E)(l.Qb(k.a))},E.\u0275cmp=l.Kb({type:E,selectors:[["j-transfer-success"]],inputs:{description:"description",totalBalance:"totalBalance"},decls:14,vars:5,consts:[[1,"modal-header","j-modal-header"],[1,"modal-body","j-modal-body","text-center","pb-4"],["src","/assets/img/history/modals/success.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[3,"money"],["translate","",1,"m-0","text-muted"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-primary","btn-block","mb-3",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"]],template:function(e,t){1&e&&(l.Rb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"img",2),l.nc(3,"translate"),l.Wb(4,"h3",3),l.Wb(5,"strong"),l.Rb(6,"j-money",4),l.Vb(),l.Vb(),l.Wb(7,"p",5),l.Tc(8),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"button",7),l.ic("click",(function(e){return t.closeModal()})),l.Tc(11," TRANSFERS.NAVIGATE_TO_HISTORY "),l.Vb(),l.Wb(12,"button",8),l.ic("click",(function(e){return t.dismissModal()})),l.Tc(13," SHARED.BACK_TO_HOME "),l.Vb(),l.Vb()),2&e&&(l.Ab(2),l.vc("alt",l.oc(3,3,t.description)),l.Ab(4),l.uc("money",t.totalBalance),l.Ab(2),l.Vc(" ",t.description," "))},directives:[a.a,x.a],pipes:[a.d],styles:[""]}),E),_=n("y5b2"),F=n("L+ju"),j=n("+BgI"),V=n("wtV8"),D=n("mR7B"),P=((O=function(){function e(t,n,r){_classCallCheck(this,e),this.paymentsPipelineService=t,this.paymentsApiService=n,this.maskedService=r}return _createClass(e,[{key:"getTransferById",value:function(e){return this.paymentsApiService.getPaymentById(e)}},{key:"saveEditedTransfer",value:function(e,t){return this.paymentsApiService.updatePayment(Object.assign(Object.assign({},t),this.mapTransferOwnPaymentBody(e)),{paymentId:e.id})}},{key:"createOwnTransfer",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.abrupt("return",this.paymentsApiService.createPayment(this.mapTransferOwnPaymentBody(e)));case 4:throw t.prev=4,t.t0=t.catch(0),t.t0;case 7:case"end":return t.stop()}}),t,this,[[0,4]])})))}},{key:"createAndSignOwnTransfer",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.createOwnTransfer(e);case 2:return n=t.sent,t.abrupt("return",this.paymentsPipelineService.processPaymentVerify(n));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"mapTransferOwnPaymentBody",value:function(e){var t=g.j.IN_BETWEEN,n=null;e.fromAccount.accountType===F.a.ACCOUNT&&e.toAccount.accountType===F.a.CARD&&(t=g.j.ACCOUNT_TO_CARD),e.fromAccount.accountType===F.a.CARD&&e.toAccount.accountType===F.a.ACCOUNT&&(t=g.j.CARD_TO_ACCOUNT,n=e.fromAccount.accountId),e.fromAccount.accountType===F.a.CARD&&e.toAccount.accountType===F.a.CARD&&(t=g.j.CARD_TO_CARD,n=e.fromAccount.accountId);var r={type:t,category:g.h.DOMESTIC,paymentRecipient:{recipientAccount:{iban:e.to}},details:{payerIban:e.from,paymentAmount:{amount:this.maskedService.getNumberedAmount(e.amount),currency:S.a.KZT},documentId:e.documentNumber,associatedField:{parameters:{payerCardNumber:e.fromAccount.accountType===F.a.CARD?e.fromAccount.cardNumber:null,recipientCardNumber:e.toAccount.accountType===F.a.CARD?e.toAccount.cardNumber:null}}}};return n&&(r.details=Object.assign(Object.assign({},r.details),{payerAccountId:n})),r}},{key:"mapTransferOwnToPayment",value:function(e,t){return t.paymentRecipient.recipientAccount.iban=e.to,t.details.payerIban=e.from,t.details.paymentAmount.amount=this.maskedService.getNumberedAmount(e.amount),t.details.documentId=e.documentNumber,t}}]),e}()).\u0275fac=function(e){return new(e||O)(l.ec(j.a),l.ec(V.a),l.ec(D.a))},O.\u0275prov=l.Mb({token:O,factory:O.\u0275fac,providedIn:"root"}),O),L=n("VnnJ"),M=n("CVrE"),W=n("7rOj"),B=n("+eKG"),H=n("VO+5"),Q=n("2A1n"),U=n("kDIH"),K=n("hsBV"),G=n("9odQ"),q=n("NpBu"),J=["fromDropdown"],X=["toDropdown"],Y=function(){return{height:"56px","background-color":"#ECEEF1"}},Z=function(){return{height:"56px",width:"200px","background-color":"#ECEEF1"}};function z(e,t){1&e&&(l.Ub(0),l.Rb(1,"ngx-skeleton-loader",3),l.Rb(2,"ngx-skeleton-loader",3),l.Rb(3,"ngx-skeleton-loader",3),l.Rb(4,"ngx-skeleton-loader",3),l.Wb(5,"div",4),l.Rb(6,"ngx-skeleton-loader",3),l.Vb(),l.Tb()),2&e&&(l.Ab(1),l.uc("theme",l.yc(5,Y)),l.Ab(1),l.uc("theme",l.yc(6,Y)),l.Ab(1),l.uc("theme",l.yc(7,Y)),l.Ab(1),l.uc("theme",l.yc(8,Y)),l.Ab(2),l.uc("theme",l.yc(9,Z)))}function $(e,t){1&e&&l.Rb(0,"j-restricted-placeholder",5)}function ee(e,t){if(1&e&&(l.Rb(0,"p",17),l.nc(1,"translate")),2&e){var n=l.mc(2);l.uc("innerHTML",l.pc(1,1,"TRANSFERS.NOT_ENOUGH",n.translateParams),l.Jc)}}function te(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",18),l.Wb(1,"button",19),l.ic("click",(function(e){return l.Ic(n),l.mc(2).edit()})),l.Tc(2,"TRANSFERS.SAVE"),l.Vb(),l.Vb()}}function ne(e,t){if(1&e){var n=l.Xb();l.Wb(0,"button",19),l.ic("click",(function(e){return l.Ic(n),l.mc(3).createOnly()})),l.Tc(1,"TRANSFERS.FOR_SIGN"),l.Vb()}}function re(e,t){if(1&e){var n=l.Xb();l.Wb(0,"button",22),l.ic("click",(function(e){return l.Ic(n),l.mc(3).createAndSign()})),l.Tc(1,"TRANSFERS.SIGN"),l.Vb()}}function ie(e,t){if(1&e){var n=l.Xb();l.Wb(0,"button",22),l.ic("click",(function(e){return l.Ic(n),l.mc(3).createOnly()})),l.Tc(1,"TRANSFERS.SEND"),l.Vb()}}function ae(e,t){if(1&e&&(l.Wb(0,"div",18),l.Rc(1,ne,2,0,"button",20),l.Rc(2,re,2,0,"button",21),l.Rc(3,ie,2,0,"button",21),l.Vb()),2&e){var n=l.mc(2);l.Ab(1),l.uc("ngIf",n.canSendAndSign),l.Ab(1),l.uc("ngIf",n.canSendAndSign),l.Ab(1),l.uc("ngIf",n.canSendOnly)}}function oe(e,t){if(1&e){var n=l.Xb();l.Ub(0),l.Wb(1,"form",6),l.Wb(2,"div",7),l.Wb(3,"j-account-dropdown",8,9),l.ic("selected",(function(e){return l.Ic(n),l.mc().onFromSelect(e)})),l.Vb(),l.Vb(),l.Wb(5,"div",10),l.Wb(6,"j-account-dropdown",11,12),l.ic("selected",(function(e){return l.Ic(n),l.mc().onToSelect(e)})),l.Vb(),l.Vb(),l.Wb(8,"div",10),l.Rb(9,"j-input",13),l.Vb(),l.Wb(10,"div",10),l.Rb(11,"j-amount-input",14),l.Rc(12,ee,2,4,"p",15),l.Vb(),l.Rc(13,te,3,0,"div",16),l.Rc(14,ae,4,3,"div",16),l.Vb(),l.Tb()}if(2&e){var r=l.mc();l.Ab(1),l.uc("formGroup",r.transferForm),l.Ab(2),l.uc("hasError",r.f.from.invalid&&r.isSubmitted)("accounts",r.fromAccounts)("isDisabledSelectable",!1)("isLoading",r.isAccountsLoading)("isFromArrowShown",!0),l.Ab(3),l.uc("hasError",r.f.to.invalid&&r.isSubmitted)("accounts",r.toAccounts)("isLoading",r.isAccountsLoading)("isDisabledSelectable",!0),l.Ab(3),l.uc("hasError",r.f.documentNumber.invalid&&r.isSubmitted)("isClearable",!1)("formControl",r.f.documentNumber),l.Ab(2),l.uc("hasError",r.f.amount.invalid&&r.isSubmitted)("helperText","TRANSFERS.COMMISSION")("helperTextParams",r.commissionParams)("formControl",r.f.amount),l.Ab(1),l.uc("ngIf",r.hasUnsufficientFunds),l.Ab(1),l.uc("ngIf",r.isEditing),l.Ab(1),l.uc("ngIf",!r.isEditing)}}var ce,se,ue,le=((se=function(){function e(t,n,r,a,o,c,s,u,l,d,m,f,h,b,p,y,A){_classCallCheck(this,e),this.route=t,this.transfersService=n,this.companyService=r,this.paymentsService=a,this.accountsService=o,this.amountFormatPipe=c,this.modalService=s,this.router=u,this.maskedService=l,this.paymentsApiService=d,this.cardsService=m,this.featureFlagsService=f,this.notifierService=h,this.translateService=b,this.moneyPipe=p,this.navService=y,this.authorityPermissionsService=A,this.isRestricted=!1,this.isSubmitted=!1,this.isLoading=!0,this.repeatPayment=null,this.commissionParams={amount:this.moneyPipe.transform({amount:0,currency:S.a.KZT})},this.subscription=new v.a,this.isAccountsLoading=!0,this.transferForm=new i.k({id:new i.h(""),from:new i.h("",[i.H.required]),fromAccount:new i.h(null),to:new i.h("",[i.H.required]),toAccount:new i.h(null),documentNumber:new i.h("",[i.H.required]),amount:new i.h("",[i.H.required,function(e){var t;return 0==(null===(t=e)||void 0===t?void 0:t.value)?{cantBeZero:!0}:null}])})}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this,t=this.route.params.subscribe((function(t){t.id&&(e.f.id.setValue(t.id),e.isEditing=!0)}));this.subscription.add(t)}},{key:"ngAfterViewInit",value:function(){var e=this;this.getPermission().then((function(){e.isRestricted?e.isLoading=!1:e.initPage()})).catch((function(t){e.isLoading=!1,e.initPage()}))}},{key:"initPage",value:function(){var e=this,t=Object(p.a)([this.route.paramMap.pipe(Object(y.a)((function(){return window.history.state}))),this.featureFlagsService.featureFlags$.pipe(Object(A.a)((function(e){var t;return(null===(t=e)||void 0===t?void 0:t.length)>0})))]).subscribe((function(t){var n=_slicedToArray(t,1)[0];e.isEditing?e.loadEditTransfer(e.f.id.value):n.repeatPaymentId?e.loadRepeatTransfer(n.repeatPaymentId):e.loadNewTransfer()})),n=this.transferForm.valueChanges.subscribe((function(t){e.isSubmitted=!1}));this.subscription.add(t),this.subscription.add(n)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"onFromSelect",value:function(e){e&&(this.selectFromAccount(e),this.applyClearOnFromSelectedRule(e),this.applySelectFromCompanionRule(e))}},{key:"onToSelect",value:function(e){e&&(this.selectToAccount(e),this.applyClearOnToSelectedRule(e),this.applySelectToCompanionRule(e))}},{key:"loadRepeatTransfer",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.isLoading=!0,t.next=3,Promise.all([this.transfersService.getTransferById(e),this.retrieveAccounts()]);case 3:return n=t.sent,this.applyOnlyAccountRule(),r=_slicedToArray(n,1),i=r[0],t.next=9,this.mapRepeatTransferFromPayment(i);case 9:a=t.sent,this.initRepeatTransfer(a),this.setAutoNumeration(),this.isLoading=!1;case 11:case"end":return t.stop()}}),t,this)})))}},{key:"loadEditTransfer",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.isLoading=!0,t.next=3,this.transfersService.getTransferById(e);case 3:return this.originalPayment=t.sent,t.next=6,this.mapRepeatTransferFromPayment(this.originalPayment);case 6:return n=t.sent,t.next=9,this.retrieveAccounts();case 9:this.applyOnlyAccountRule(),this.initRepeatTransfer(n),this.isLoading=!1;case 12:case"end":return t.stop()}}),t,this)})))}},{key:"loadNewTransfer",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoading=!0,e.next=3,this.retrieveAccounts();case 3:this.setAutoNumeration(),this.isLoading=!1;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"edit",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSubmitted=!0,this.transferForm.invalid){e.next=10;break}return e.prev=1,e.next=4,this.transfersService.saveEditedTransfer(this.transferForm.value,this.originalPayment);case 4:this.showEditSuccess(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),this.showEditError(e.t0);case 10:case"end":return e.stop()}}),e,this,[[1,7]])})))}},{key:"createOnly",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSubmitted=!0,!this.transferForm.invalid){e.next=2;break}return e.abrupt("return");case 2:return this.isLoading=!0,t=this.transferForm.getRawValue(),e.next=6,this.checkIfAllowedToCreate(t.amount);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",void(this.isLoading=!1));case 8:return n=this.paymentsService.paymentNumber,e.prev=9,e.next=12,this.transfersService.createOwnTransfer(t);case 12:this.showCreateSuccess(),n.entity=null,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(9),n.entity=this.f.documentNumber.value,this.showCreateError(e.t0);case 19:return e.prev=19,this.isLoading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[9,16,19,22]])})))}},{key:"createAndSign",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSubmitted=!0,!this.transferForm.invalid){e.next=2;break}return e.abrupt("return");case 2:return this.isLoading=!0,t=this.transferForm.getRawValue(),e.next=6,this.checkIfAllowedToCreate(t.amount);case 6:if(e.sent){e.next=8;break}return e.abrupt("return",void(this.isLoading=!1));case 8:return n=this.paymentsService.paymentNumber,e.prev=9,e.next=12,this.transfersService.createAndSignOwnTransfer(t);case 12:this.showCreateAndSignSuccess(),n.entity=null,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(9),n.entity=this.f.documentNumber.value,this.showCreateAndSignError(e.t0);case 19:return e.prev=19,this.isLoading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[9,16,19,22]])})))}},{key:"getPermission",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.authorityPermissionsService.isRestricted(g.j.IN_BETWEEN);case 3:this.isRestricted=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this.isRestricted=!1;case 9:case"end":return e.stop()}}),e,this,[[0,6]])})))}},{key:"checkIfAllowedToCreate",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.paymentsApiService.checkWorkingTime();case 2:return n=t.sent,t.next=5,this.paymentsApiService.checkAmountLimit(e,g.j.IN_BETWEEN);case 5:return r=t.sent,t.abrupt("return",(console.log(n,r),n&&r));case 7:case"end":return t.stop()}}),t,this)})))}},{key:"mapRepeatTransferFromPayment",value:function(e){var t,n,r,i,a;return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function o(){var s;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.retrieveAccounts();case 2:return s=null===(t=e.details)||void 0===t?void 0:t.payerIban,o.abrupt("return",(e.type!==g.j.CARD_TO_CARD&&e.type!==g.j.CARD_TO_ACCOUNT||(s=this.fromAccounts.find((function(t){var n;return t.accountType===c.a.CARD&&t.accountId===(null===(n=e.details)||void 0===n?void 0:n.payerAccountId)})).iban),{to:null===(r=null===(n=e.paymentRecipient)||void 0===n?void 0:n.recipientAccount)||void 0===r?void 0:r.iban,toAccount:this.toAccounts.find((function(t){var n,r;return t.iban===(null===(r=null===(n=e.paymentRecipient)||void 0===n?void 0:n.recipientAccount)||void 0===r?void 0:r.iban)})),from:s,fromAccount:this.fromAccounts.find((function(e){return e.iban===s})),documentNumber:null===(i=e.details)||void 0===i?void 0:i.documentId,amount:null===(a=e.details)||void 0===a?void 0:a.paymentAmount.amount}));case 4:case"end":return o.stop()}}),o,this)})))}},{key:"initRepeatTransfer",value:function(e){e&&(this.selectToAccountByIban(e.to),this.selectFromAccountByIban(e.from),this.f.documentNumber.setValue(e.documentNumber),this.f.amount.setValue(this.maskedService.getMaskedAmount(e.amount)))}},{key:"applySelectToCompanionRule",value:function(e){var t,n;if(2==(null===(t=this.accounts)||void 0===t?void 0:t.length)){var r=this.findUnselectedAccount(e);this.selectFromAccount(r),null===(n=this.fromDropdown)||void 0===n||n.selectAccount(r)}}},{key:"applySelectFromCompanionRule",value:function(e){var t,n;if(2==(null===(t=this.accounts)||void 0===t?void 0:t.length)){var r=this.findUnselectedAccount(e);this.selectToAccount(r),null===(n=this.toDropdown)||void 0===n||n.selectAccount(r)}}},{key:"findUnselectedAccount",value:function(e){var t;return null===(t=this.accounts)||void 0===t?void 0:t.find((function(t){return t!=e}))}},{key:"findAccountByIban",value:function(e){var t;return null===(t=this.accounts)||void 0===t?void 0:t.find((function(t){return t.iban==e}))}},{key:"applyClearOnFromSelectedRule",value:function(e){var t,n=e==this.to,r=e.iban==(null===(t=this.to)||void 0===t?void 0:t.iban)&&!n;(n||r)&&this.clearToAccount(),r&&this.notifierService.notify("default",this.translateService.instant("TRANSFERS.SAME_IBANS_NOTIFICATION"))}},{key:"applyClearOnToSelectedRule",value:function(e){var t,n=e==this.from,r=e.iban==(null===(t=this.from)||void 0===t?void 0:t.iban)&&!n;(n||r)&&this.clearFromAccount(),r&&this.notifierService.notify("default",this.translateService.instant("TRANSFERS.SAME_IBANS_NOTIFICATION"))}},{key:"applyOnlyAccountRule",value:function(){var e;if(1==(null===(e=this.accounts)||void 0===e?void 0:e.length)){var t=this.accounts[0];t.isLocked||t.hasLockedState?(this.selectToAccount(t),this.toDropdown.selectAccount(t)):(this.selectFromAccount(t),this.fromDropdown.selectAccount(t))}}},{key:"selectToAccount",value:function(e){var t;this.to=e,this.f.to.setValue(null===(t=this.to)||void 0===t?void 0:t.iban),this.f.toAccount.setValue(this.to)}},{key:"selectFromAccount",value:function(e){var t;this.from=e,this.f.from.setValue(null===(t=this.from)||void 0===t?void 0:t.iban),this.f.fromAccount.setValue(this.from)}},{key:"selectToAccountByIban",value:function(e){var t=this.findAccountByIban(e);this.selectToAccount(t),this.toDropdown.selectAccount(t)}},{key:"selectFromAccountByIban",value:function(e){var t=this.findAccountByIban(e);this.selectFromAccount(t),this.fromDropdown.selectAccount(t)}},{key:"clearToAccount",value:function(){var e;this.to=null,this.f.to.setValue(null),null===(e=this.toDropdown)||void 0===e||e.clearSelected()}},{key:"clearFromAccount",value:function(){var e;this.from=null,this.f.from.setValue(null),null===(e=this.fromDropdown)||void 0===e||e.clearSelected()}},{key:"retrieveAccounts",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isAccountsLoading=!0,e.prev=1,e.next=4,this.accountsService.retrieveAccounts().then((function(e){var n=e.filter((function(e){return e.balance.currency===S.a.KZT&&e.accountType===c.a.ACCOUNT}));t.accounts=t.accounts?[].concat(_toConsumableArray(t.accounts),_toConsumableArray(n)):_toConsumableArray(n)})).catch((function(e){t.accounts=t.accounts||[],console.log(e)}));case 4:if(e.t0=this.featureFlagsService.isDisabled(T.a.CARD_TRANSFERS),e.t0){e.next=8;break}return e.next=8,this.cardsService.getCorporateCards().then((function(e){var n=e.filter((function(e){return e.balance.currency===S.a.KZT}));t.accounts=t.accounts?[].concat(_toConsumableArray(t.accounts),_toConsumableArray(n)):_toConsumableArray(n)})).catch((function(e){t.accounts=t.accounts||[],console.log(e)}));case 8:e.next=12;break;case 10:e.prev=10,e.t1=e.catch(1);case 12:return e.prev=12,this.isAccountsLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[1,10,12,15]])})))}},{key:"showEditSuccess",value:function(){var e=parseFloat(this.maskedService.getUnmaskedAmount(this.f.amount.value));this.showSuccessModal("TRANSFERS.EDIT.SUCCESS",e)}},{key:"showEditError",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.showErrorModal("TRANSFERS.EDIT.ERROR",e);case 3:this.edit(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),this.navigateToHome();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"showCreateSuccess",value:function(){var e=this.maskedService.getNumberedAmount(this.f.amount.value);this.showSuccessModal("TRANSFERS.CREATE.SUCCESS",e)}},{key:"showCreateError",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.showErrorModal("TRANSFERS.CREATE.ERROR",e);case 3:this.createOnly(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),this.navigateToHome();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"showCreateAndSignSuccess",value:function(){var e=this.maskedService.getNumberedAmount(this.f.amount.value);this.showSuccessModal("TRANSFERS.CREATE_AND_SIGN.SUCCESS",e,!0)}},{key:"showCreateAndSignError",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.showErrorModal("TRANSFERS.CREATE_AND_SIGN.ERROR",e);case 3:this.createAndSign(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),this.navigateToHome();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"showSuccessModal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(i=this.modalService.open(N,{backdropClass:"backdrop_light",windowClass:"modal_light modal_sm",backdrop:"static",centered:!0})).componentInstance.description=e,i.componentInstance.totalBalance={amount:t,currency:S.a.KZT},r.prev=2,r.next=5,i.result;case 5:this.navigateToHistory(n),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(2),this.navigateToHome();case 11:case"end":return r.stop()}}),r,this,[[2,8]])})))}},{key:"showErrorModal",value:function(e,t){var n,r=this.modalService.open(I,{backdropClass:"backdrop_light",windowClass:"modal_light modal_sm",backdrop:"static",centered:!0});return r.componentInstance.description=e,r.componentInstance.errorText=this.mapErrors(null===(n=t)||void 0===n?void 0:n.data)||t,r.result}},{key:"mapErrors",value:function(e){for(var t="",n=0,r=Object.entries(e);n<r.length;n++){var i=_slicedToArray(r[n],2);i[0],t+=i[1]+"<br>"}return t||null}},{key:"setAutoNumeration",value:function(){var e=this;this.subscription.add(this.paymentsService.paymentNumber$.subscribe((function(t){e.f.documentNumber.setValue(t)})))}},{key:"navigateToHome",value:function(){this.navService.retrieveContractBadges(),this.navService.retrieveLetterBadges(),this.router.navigate(["/"])}},{key:"navigateToHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=_.d.FOR_SIGN;this.navService.retrieveContractBadges(),this.navService.retrieveLetterBadges(),e&&this.companyService.isPrimaryAuthority()&&this.companyService.isSingleSignScheme()&&(t=_.d.IN_PROGRESS),this.router.navigate(["/history/tenge"],{queryParams:{paymentStatus:t}})}},{key:"fromAccounts",get:function(){var e;return null===(e=this.accounts)||void 0===e?void 0:e.filter((function(e){return!(e.accountType===c.a.CARD&&e.category===R.a.PRIVATE)}))}},{key:"toAccounts",get:function(){return this.accounts}},{key:"canSendAndSign",get:function(){return this.companyService.isSecondaryAuthority()||this.companyService.isPrimaryAuthority()&&this.companyService.isSingleSignScheme()}},{key:"canSendOnly",get:function(){return this.companyService.isNoSignAuthority()||this.companyService.isPrimaryAuthority()&&this.companyService.isMultipleSignScheme()}},{key:"f",get:function(){return this.transferForm.controls}},{key:"translateParams",get:function(){return{amount:this.amountFormatPipe.transform(this.amountDelta)}}},{key:"hasUnsufficientFunds",get:function(){return this.amountDelta>0}},{key:"amountDelta",get:function(){var e,t,n=this.transferForm.getRawValue().amount;return this.maskedService.getNumberedAmount(n)-(null===(t=null===(e=this.from)||void 0===e?void 0:e.balance)||void 0===t?void 0:t.amount)}}]),e}()).\u0275fac=function(e){return new(e||se)(l.Qb(u.a),l.Qb(P),l.Qb(L.a),l.Qb(M.g),l.Qb(c.c),l.Qb(W.a),l.Qb(k.q),l.Qb(u.c),l.Qb(D.a),l.Qb(M.c),l.Qb(B.a),l.Qb(T.b),l.Qb(H.c),l.Qb(a.e),l.Qb(W.e),l.Qb(d.a),l.Qb(Q.c))},se.\u0275cmp=l.Kb({type:se,selectors:[["j-transfers-own"]],viewQuery:function(e,t){var n;1&e&&(l.Yc(J,!0),l.Yc(X,!0)),2&e&&(l.Ec(n=l.jc())&&(t.fromDropdown=n.first),l.Ec(n=l.jc())&&(t.toDropdown=n.first))},decls:4,vars:4,consts:[[4,"ngIf"],[3,"hidden"],["label","PAYMENTS.RESTRICTED_PLACEHOLDER",4,"ngIf"],[3,"theme"],[1,"d-flex","justify-content-end"],["label","PAYMENTS.RESTRICTED_PLACEHOLDER"],[3,"formGroup"],[1,"form-group","form-from"],["label","TRANSFERS.FROM",3,"hasError","accounts","isDisabledSelectable","isLoading","isFromArrowShown","selected"],["fromDropdown",""],[1,"form-group"],["label","TRANSFERS.TO",3,"hasError","accounts","isLoading","isDisabledSelectable","selected"],["toDropdown",""],["label","TRANSFERS.DOCUMENT_NUMBER",3,"hasError","isClearable","formControl"],["label","TRANSFERS.AMOUNT",3,"hasError","helperText","helperTextParams","formControl"],["class","text-muted p3",3,"innerHTML",4,"ngIf"],["class","form-footer",4,"ngIf"],[1,"text-muted","p3",3,"innerHTML"],[1,"form-footer"],["type","button","translate","",1,"btn","btn-outline-primary",3,"click"],["type","button","class","btn btn-outline-primary","translate","",3,"click",4,"ngIf"],["type","submit","class","btn btn-primary ml-3","translate","",3,"click",4,"ngIf"],["type","submit","translate","",1,"btn","btn-primary","ml-3",3,"click"]],template:function(e,t){1&e&&(l.Rc(0,z,7,10,"ng-container",0),l.Wb(1,"section",1),l.Rc(2,$,1,0,"j-restricted-placeholder",2),l.Rc(3,oe,15,20,"ng-container",0),l.Vb()),2&e&&(l.uc("ngIf",t.isLoading),l.Ab(1),l.uc("hidden",t.isLoading),l.Ab(1),l.uc("ngIf",t.isRestricted),l.Ab(1),l.uc("ngIf",!t.isRestricted))},directives:[r.u,o.a,U.a,i.J,i.u,i.l,K.a,G.b,i.t,i.i,q.a,a.a],pipes:[a.d],styles:[".form-footer[_ngcontent-%COMP%]{border-top:1px solid rgba(183,190,197,.5);display:-webkit-box;display:flex;-webkit-box-pack:end;justify-content:flex-end;margin-top:1.5rem;padding-top:1.5rem}.form-from[_ngcontent-%COMP%]{position:relative;z-index:5}"]}),se),de=((ce=function(){function e(t,n){_classCallCheck(this,e),this.router=t,this.navService=n}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"onClose",value:function(){this.navService.retrieveLetterBadges(),this.navService.retrieveContractBadges(),this.router.navigate(["/"])}}]),e}()).\u0275fac=function(e){return new(e||ce)(l.Qb(u.c),l.Qb(d.a))},ce.\u0275cmp=l.Kb({type:ce,selectors:[["j-transfers"]],decls:7,vars:0,consts:[["closePosition","outside","colsClassList","offset-lg-2 col-lg-8 offset-xl-3 col-xl-6",3,"closed"],[1,"account-header"],["translate","",1,"f-page-title"]],template:function(e,t){1&e&&(l.Wb(0,"f-page",0),l.ic("closed",(function(e){return t.onClose()})),l.Wb(1,"f-page-header"),l.Wb(2,"section",1),l.Wb(3,"h1",2),l.Tc(4,"TRANSFERS.TITLE"),l.Vb(),l.Vb(),l.Vb(),l.Wb(5,"f-page-body"),l.Rb(6,"j-transfers-own"),l.Vb(),l.Vb())},directives:[m.a,f.a,a.a,h.a,le],styles:[""]}),ce),me=[{path:"",component:de,data:{title:"TRANSFERS.TITLE"}},{path:":id",component:de},{path:"**",redirectTo:""}],fe=((ue=function e(){_classCallCheck(this,e)}).\u0275mod=l.Ob({type:ue}),ue.\u0275inj=l.Nb({factory:function(e){return new(e||ue)},imports:[[u.g.forChild(me)],u.g]}),ue);n.d(t,"TransfersModule",(function(){return be}));var he,be=((he=function e(){_classCallCheck(this,e)}).\u0275mod=l.Ob({type:he}),he.\u0275inj=l.Nb({factory:function(e){return new(e||he)},imports:[[r.c,i.n,i.D,o.b,fe,c.b,s.a,a.c]]}),he)}}]);