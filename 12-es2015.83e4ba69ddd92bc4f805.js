(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{gfTr:function(t,e,i){"use strict";i.d(e,"a",(function(){return g})),i.d(e,"b",(function(){return h})),i.d(e,"c",(function(){return p}));var n=i("fXoL"),s=i("PqYM"),r=i("ofXK");const o=["fileSelector"];function c(t,e){if(1&t&&(n.Wb(0,"div",7),n.Tc(1),n.Vb()),2&t){const t=n.mc(2);n.Ab(1),n.Uc(t.dropZoneLabel)}}function a(t,e){if(1&t){const t=n.Xb();n.Wb(0,"div"),n.Wb(1,"input",8),n.ic("click",(function(e){return n.Ic(t),n.mc(2).openFileSelector(e)})),n.Vb(),n.Vb()}if(2&t){const t=n.mc(2);n.Ab(1),n.Db(t.browseBtnClassName),n.vc("value",t.browseBtnLabel)}}function l(t,e){if(1&t&&(n.Rc(0,c,2,1,"div",5),n.Rc(1,a,2,3,"div",6)),2&t){const t=n.mc();n.uc("ngIf",t.dropZoneLabel),n.Ab(1),n.uc("ngIf",t.showBrowseBtn)}}function d(t,e){}const b=function(t){return{openFileSelector:t}};class u{constructor(t,e){this.relativePath=t,this.fileEntry=e}}let h=(()=>{class t{constructor(t){this.template=t}}return t.\u0275fac=function(e){return new(e||t)(n.Qb(n.L))},t.\u0275dir=n.Lb({type:t,selectors:[["","ngx-file-drop-content-tmp",""]]}),t})(),g=(()=>{class t{constructor(t,e){this.zone=t,this.renderer=e,this.accept="*",this.directory=!1,this.multiple=!0,this.dropZoneLabel="",this.dropZoneClassName="ngx-file-drop__drop-zone",this.useDragEnter=!1,this.contentClassName="ngx-file-drop__content",this.showBrowseBtn=!1,this.browseBtnClassName="btn btn-primary btn-xs ngx-file-drop__browse-btn",this.browseBtnLabel="Browse files",this.onFileDrop=new n.n,this.onFileOver=new n.n,this.onFileLeave=new n.n,this.isDraggingOverDropZone=!1,this.globalDraggingInProgress=!1,this.files=[],this.numOfActiveReadEntries=0,this.helperFormEl=null,this.fileInputPlaceholderEl=null,this.dropEventTimerSubscription=null,this._disabled=!1,this.openFileSelector=t=>{this.fileSelector&&this.fileSelector.nativeElement&&this.fileSelector.nativeElement.click()},this.globalDragStartListener=this.renderer.listen("document","dragstart",t=>{this.globalDraggingInProgress=!0}),this.globalDragEndListener=this.renderer.listen("document","dragend",t=>{this.globalDraggingInProgress=!1})}get disabled(){return this._disabled}set disabled(t){this._disabled=null!=t&&"false"!==`${t}`}ngOnDestroy(){this.dropEventTimerSubscription&&(this.dropEventTimerSubscription.unsubscribe(),this.dropEventTimerSubscription=null),this.globalDragStartListener(),this.globalDragEndListener(),this.files=[],this.helperFormEl=null,this.fileInputPlaceholderEl=null}onDragOver(t){this.useDragEnter?(this.preventAndStop(t),t.dataTransfer&&(t.dataTransfer.dropEffect="copy")):this.isDropzoneDisabled()||this.useDragEnter||!t.dataTransfer||(this.isDraggingOverDropZone||(this.isDraggingOverDropZone=!0,this.onFileOver.emit(t)),this.preventAndStop(t),t.dataTransfer.dropEffect="copy")}onDragEnter(t){!this.isDropzoneDisabled()&&this.useDragEnter&&(this.isDraggingOverDropZone||(this.isDraggingOverDropZone=!0,this.onFileOver.emit(t)),this.preventAndStop(t))}onDragLeave(t){this.isDropzoneDisabled()||(this.isDraggingOverDropZone&&(this.isDraggingOverDropZone=!1,this.onFileLeave.emit(t)),this.preventAndStop(t))}dropFiles(t){if(!this.isDropzoneDisabled()&&(this.isDraggingOverDropZone=!1,t.dataTransfer)){let e;e=t.dataTransfer.items?t.dataTransfer.items:t.dataTransfer.files,this.preventAndStop(t),this.checkFiles(e)}}uploadFiles(t){!this.isDropzoneDisabled()&&t.target&&(this.checkFiles(t.target.files||[]),this.resetFileInput())}checkFiles(t){for(let e=0;e<t.length;e++){const i=t[e];let n=null;if(this.canGetAsEntry(i)&&(n=i.webkitGetAsEntry()),n)if(n.isFile){const t=new u(n.name,n);this.addToQueue(t)}else n.isDirectory&&this.traverseFileTree(n,n.name);else if(i){const t={name:i.name,isDirectory:!1,isFile:!0,file:t=>t(i)},e=new u(t.name,t);this.addToQueue(e)}}this.dropEventTimerSubscription&&this.dropEventTimerSubscription.unsubscribe(),this.dropEventTimerSubscription=Object(s.a)(200,200).subscribe(()=>{if(this.files.length>0&&0===this.numOfActiveReadEntries){const t=this.files;this.files=[],this.onFileDrop.emit(t)}})}traverseFileTree(t,e){if(t.isFile){const i=new u(e,t);this.files.push(i)}else{e+="/";const i=t.createReader();let n=[];const s=()=>{this.numOfActiveReadEntries++,i.readEntries(i=>{if(i.length)n=n.concat(i),s();else if(0===n.length){const i=new u(e,t);this.zone.run(()=>{this.addToQueue(i)})}else for(let t=0;t<n.length;t++)this.zone.run(()=>{this.traverseFileTree(n[t],e+n[t].name)});this.numOfActiveReadEntries--})};s()}}resetFileInput(){if(this.fileSelector&&this.fileSelector.nativeElement){const t=this.fileSelector.nativeElement,e=t.parentElement,i=this.getHelperFormElement(),n=this.getFileInputPlaceholderElement();e!==i&&(this.renderer.insertBefore(e,n,t),this.renderer.appendChild(i,t),i.reset(),this.renderer.insertBefore(e,t,n),this.renderer.removeChild(e,n))}}getHelperFormElement(){return this.helperFormEl||(this.helperFormEl=this.renderer.createElement("form")),this.helperFormEl}getFileInputPlaceholderElement(){return this.fileInputPlaceholderEl||(this.fileInputPlaceholderEl=this.renderer.createElement("div")),this.fileInputPlaceholderEl}canGetAsEntry(t){return!!t.webkitGetAsEntry}isDropzoneDisabled(){return this.globalDraggingInProgress||this.disabled}addToQueue(t){this.files.push(t)}preventAndStop(t){t.stopPropagation(),t.preventDefault()}}return t.\u0275fac=function(e){return new(e||t)(n.Qb(n.z),n.Qb(n.D))},t.\u0275cmp=n.Kb({type:t,selectors:[["ngx-file-drop"]],contentQueries:function(t,e,i){var s;1&t&&n.Ib(i,h,!0,n.L),2&t&&n.Ec(s=n.jc())&&(e.contentTemplate=s.first)},viewQuery:function(t,e){var i;1&t&&n.Oc(o,!0),2&t&&n.Ec(i=n.jc())&&(e.fileSelector=i.first)},inputs:{accept:"accept",directory:"directory",multiple:"multiple",dropZoneLabel:"dropZoneLabel",dropZoneClassName:"dropZoneClassName",useDragEnter:"useDragEnter",contentClassName:"contentClassName",showBrowseBtn:"showBrowseBtn",browseBtnClassName:"browseBtnClassName",browseBtnLabel:"browseBtnLabel",disabled:"disabled"},outputs:{onFileDrop:"onFileDrop",onFileOver:"onFileOver",onFileLeave:"onFileLeave"},decls:7,vars:17,consts:[[3,"drop","dragover","dragenter","dragleave"],["type","file",1,"ngx-file-drop__file-input",3,"accept","multiple","change"],["fileSelector",""],["defaultContentTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["class","ngx-file-drop__drop-zone-label",4,"ngIf"],[4,"ngIf"],[1,"ngx-file-drop__drop-zone-label"],["type","button",3,"value","click"]],template:function(t,e){if(1&t&&(n.Wb(0,"div",0),n.ic("drop",(function(t){return e.dropFiles(t)}))("dragover",(function(t){return e.onDragOver(t)}))("dragenter",(function(t){return e.onDragEnter(t)}))("dragleave",(function(t){return e.onDragLeave(t)})),n.Wb(1,"div"),n.Wb(2,"input",1,2),n.ic("change",(function(t){return e.uploadFiles(t)})),n.Vb(),n.Rc(4,l,2,2,"ng-template",null,3,n.Sc),n.Rc(6,d,0,0,"ng-template",4),n.Vb(),n.Vb()),2&t){const t=n.Fc(5);n.Db(e.dropZoneClassName),n.Hb("ngx-file-drop__drop-zone--over",e.isDraggingOverDropZone),n.Ab(1),n.Db(e.contentClassName),n.Ab(1),n.uc("accept",e.accept)("multiple",e.multiple),n.Bb("directory",e.directory||void 0)("webkitdirectory",e.directory||void 0)("mozdirectory",e.directory||void 0)("msdirectory",e.directory||void 0)("odirectory",e.directory||void 0),n.Ab(4),n.uc("ngTemplateOutlet",e.contentTemplate||t)("ngTemplateOutletContext",n.zc(15,b,e.openFileSelector))}},directives:[r.B,r.u],styles:[".ngx-file-drop__drop-zone[_ngcontent-%COMP%]{border:2px dotted #0782d0;border-radius:30px;height:100px;margin:auto}.ngx-file-drop__drop-zone--over[_ngcontent-%COMP%]{background-color:hsla(0,0%,57.6%,.5)}.ngx-file-drop__content[_ngcontent-%COMP%]{align-items:center;color:#0782d0;display:flex;height:100px;justify-content:center}.ngx-file-drop__drop-zone-label[_ngcontent-%COMP%]{text-align:center}.ngx-file-drop__file-input[_ngcontent-%COMP%]{display:none}"]}),t})(),p=(()=>{class t{}return t.\u0275mod=n.Ob({type:t,bootstrap:function(){return[g]}}),t.\u0275inj=n.Nb({factory:function(e){return new(e||t)},providers:[],imports:[[r.c]]}),t})()},mCIM:function(t,e,i){"use strict";i.r(e);var n=i("ofXK"),s=i("3Pt+"),r=i("xJkR"),o=i("dlKe"),c=i("gfTr"),a=i("5cNS"),l=i("PCNd"),d=i("mQSa"),b=i("tyNb"),u=function(t){return t.INBOX="inbox",t.OUTBOX="outbox",t.DRAFTS="drafts",t}({}),h=function(t){return t.ON_SIGN="ON_SIGN",t.SENT="SENT",t}({}),g=function(t){return t.CERTIFICATE="CERTIFICATE",t.APPLICATION="APPLICATION",t}({});const p=[{id:"919fbae5-ca24-4b3a-9323-a5b0c96a4512",displayName:"\u041f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u043f\u0438\u0441\u044c\u043c\u043e",description:"\u041f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u043f\u0438\u0441\u044c\u043c\u043e",type:"APPLICATION"},{id:"d61a02d0-50ea-4867-9c3b-ec318cb569ac",displayName:"\u041e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435 \u043f\u043e \u0432\u0430\u043b\u044e\u0442\u043d\u044b\u043c \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442\u0430\u043c",description:"\u041e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435 \u043f\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u0443 \u0432\u0430\u043b\u044e\u0442\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442\u0430",type:"APPLICATION"},{id:"fba22715-756c-41d7-b100-e29f80ab0ea9",displayName:"\u041d\u0430 \u0432\u044b\u0434\u0430\u0447\u0443 \u043d\u0430\u043b\u0438\u0447\u043d\u044b\u0445 \u0434\u0435\u043d\u0435\u0433",description:"\u0417\u0430\u044f\u0432\u043a\u0430 \u043d\u0430 \u0432\u044b\u0434\u0430\u0447\u0443 \u043d\u0430\u043b\u0438\u0447\u043d\u044b\u0445 \u0434\u0435\u043d\u0435\u0433 \u0432 \u043e\u0442\u0434\u0435\u043b\u0435\u043d\u0438\u0438",type:"APPLICATION"},{id:"fa1be069-e728-4a2f-950f-ec4893dc42ac",displayName:"\u041d\u0430 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e\u0435 \u0438\u0437\u044a\u044f\u0442\u0438\u0435 \u0441 \u0434\u0435\u043f\u043e\u0437\u0438\u0442\u0430",description:"\u0417\u0430\u044f\u0432\u043a\u0430 \u043d\u0430 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e\u0435 \u0438\u0437\u044a\u044f\u0442\u0438\u0435 \u0441 \u0434\u0435\u043f\u043e\u0437\u0438\u0442\u0430",type:"APPLICATION"},{id:"d6d2fb09-6d94-4be1-b75c-f4f3dbfd0d75",displayName:"\u0421\u043c\u0435\u043d\u0430 \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044f, \u0430\u0434\u0440\u0435\u0441\u0430, \u0443\u0447\u0440\u0435\u0434\u0438\u0442\u0435\u043b\u0435\u0439 \u0438 \u0442.\u0434",description:"\u0417\u0430\u044f\u0432\u043a\u0430 \u043d\u0430 \u0441\u043c\u0435\u043d\u0443 \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044f, \u0430\u0434\u0440\u0435\u0441\u0430, \u0443\u0447\u0440\u0435\u0434\u0438\u0442\u0435\u043b\u0435\u0439 \u0438 \u0442.\u0434. \u0441 \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u0435\u043c \u0443\u0447\u0440\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 (\u043f\u0440\u0438\u043a\u0430\u0437\u044b, \u0440\u0435\u0448\u0435\u043d\u0438\u044f, \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430)",type:"APPLICATION"},{id:"4a7c08ee-f640-4feb-a012-15f99084f8a1",displayName:"\u041d\u0430 \u0437\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u0432\u0430\u043b\u044e\u0442\u044b \u043d\u0430 \u0441\u0447\u0435\u0442",description:"\u0417\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u0435 \u043e \u0437\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0438 \u0432\u0430\u043b\u044e\u0442\u044b \u043d\u0430 \u0441\u0447\u0435\u0442",type:"APPLICATION"},{id:"07e410d5-3283-4f8c-902c-6c86e2436677",displayName:"\u041e \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u0441\u0447\u0435\u0442\u0430",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u0431\u0430\u043d\u043a\u043e\u0432\u0441\u043a\u043e\u0433\u043e \u0441\u0447\u0435\u0442\u0430",type:"CERTIFICATE"},{id:"8295913a-b8ba-472f-af7c-8e12195b8ddf",displayName:"\u041e\u0431 \u043e\u0441\u0442\u0430\u0442\u043a\u0430\u0445 \u043d\u0430 \u0441\u0447\u0435\u0442\u0435",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u043e\u0431 \u043e\u0441\u0442\u0430\u0442\u043a\u0430\u0445 \u043d\u0430 \u0431\u0430\u043d\u043a\u043e\u0432\u0441\u043a\u043e\u043c \u0441\u0447\u0435\u0442\u0435",type:"CERTIFICATE"},{id:"a66d0329-8956-4bce-89ee-bdc9e3571349",displayName:"\u041e\u0431 \u043e\u0431\u043e\u0440\u043e\u0442\u0430\u0445 \u043d\u0430 \u0441\u0447\u0435\u0442\u0435",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u043e\u0431 \u043e\u0431\u043e\u0440\u043e\u0442\u0430\u0445 \u0431\u0430\u043d\u043a\u043e\u0432\u0441\u043a\u043e\u0433\u043e \u0441\u0447\u0435\u0442\u0430",type:"CERTIFICATE"},{id:"affb46a1-2012-47d2-9222-96b12603771c",displayName:"\u041e \u0440\u0435\u043a\u0432\u0438\u0437\u0438\u0442\u0430\u0445 \u0441\u0447\u0435\u0442\u0430",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u043e \u0440\u0435\u043a\u0432\u0438\u0437\u0438\u0442\u0430\u0445 \u0431\u0430\u043d\u043a\u043e\u0432\u0441\u043a\u043e\u0433\u043e \u0441\u0447\u0435\u0442\u0430",type:"CERTIFICATE"},{id:"48e07781-bc49-4e04-b24c-3136366b913f",displayName:"\u0414\u043b\u044f \u0430\u0443\u0434\u0438\u0442\u043e\u0440\u0441\u043a\u0438\u0445 \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0439",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u0434\u043b\u044f \u0430\u0443\u0434\u0438\u0442\u043e\u0440\u0441\u043a\u0438\u0445 \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0439",type:"CERTIFICATE"},{id:"903dabe2-5b6a-405a-93ab-5df77f8c1b7f",displayName:"\u0414\u043b\u044f \u0443\u0447\u0430\u0441\u0442\u0438\u044f \u0432 \u0442\u0435\u043d\u0434\u0435\u0440\u0435",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u0434\u043b\u044f \u0443\u0447\u0430\u0441\u0442\u0438\u044f \u0432 \u0442\u0435\u043d\u0434\u0435\u0440\u0435",type:"CERTIFICATE"},{id:"34ce1113-6f15-4f64-92af-fc97db0599be",displayName:"\u041e\u0431 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0438 \u043f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d\u043d\u043e\u0439 \u0437\u0430\u0434\u043e\u043b\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u043e\u0431 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0438 \u043f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d\u043d\u043e\u0439 \u0437\u0430\u0434\u043e\u043b\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438",type:"CERTIFICATE"},{id:"e4da4358-f6fe-42dc-8099-07026932f2cf",displayName:"\u041e \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0445 \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u0439 3-\u0438\u0445 \u043b\u0438\u0446",description:"\u0421\u043f\u0440\u0430\u0432\u043a\u0430 \u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u044b\u0445 \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u0439 3-\u0438\u0445 \u043b\u0438\u0446 (\u0415\u041a\u041e)",type:"CERTIFICATE"}];var f=function(t){return t.ACCOUNT_AVAILABILITY="ACCOUNT_AVAILABILITY",t.ACCOUNT_BALANCES="ACCOUNT_BALANCES",t.ACCOUNT_DETAILS="ACCOUNT_DETAILS",t.ACCOUNT_TURNOVER="ACCOUNT_TURNOVER",t}({}),m=i("R0Ic"),S=i("fXoL"),T=i("mrSG"),v=i("tk/3"),y=i("2Vo4"),_=i("Wgwc"),O=i.n(_),E=i("kAiJ"),A=i("VnnJ"),w=i("ZF+8"),I=i("yZrb"),C=i("FhWM"),L=i("sYmb");let R=(()=>{class t{constructor(t,e,i,n,s){this.companyService=t,this.filesService=e,this.apiService=i,this.listService=n,this.translateService=s,this.files=[],this.lastLettersListPath$=new y.a("outbox"),this.retrieveTopics()}clearFiles(){this.files=[],this.filesService.uploading$.next([])}onFileDrop(t){const e=[];for(const i of t)e.push(i);e.length>0&&(this.files=[...e],this.filesService.uploading$.next(this.files))}mapLetterDate(t){const e=t.created,i=O()().isSame(e,"day"),s=O()().subtract(1,"date").isSame(e,"day"),r=O()(e).format("HH:mm");if(i)return{key:"LETTERS.DATE.TODAY",params:{time:r}};if(s)return{key:"LETTERS.DATE.YESTERDAY",params:{time:r}};{const t=O()().isSame(e,"year")?"d MMMM HH:mm":"d MMMM yyyy HH:mm";return Object(n.K)(e,t,this.translateService.currentLang)}}getById(t){const e=this.mapUrl(`/${t}`);return this.apiService.get(e)}getLetterSignatures(t){const e=this.mapUrl(`/${t}/signatures`);return this.apiService.get(e)}sign(t){return this.listService.sign("letters",t)}getList(t={}){return Object(T.a)(this,void 0,void 0,(function*(){const e=this.mapUrl();let i=new v.h;for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){let e=t[s];e&&("dateFrom"!=s&&"dateTo"!=s||(e=Object(E.d)(e)),i=i.append(s,e))}const n=yield this.apiService.get(e,null,i,{observe:"response"});return{items:n.body,totalCount:+n.headers.get("X-Total-Count")}}))}retrieveTopics(){return Object(T.a)(this,void 0,void 0,(function*(){const t=this.mapUrl("/topics");let e;try{e=yield this.apiService.get(t)}catch(i){e=p}return this.cashedTopics=e,this.cashedTopics}))}getTopics(t){return Object(T.a)(this,void 0,void 0,(function*(){return this.cashedTopics?this.filterTopicsByType(t):(this.cashedTopics=yield this.retrieveTopics(),this.filterTopicsByType(t))}))}getTopicValues(){return Object(T.a)(this,void 0,void 0,(function*(){return this.cashedTopics?this.mapTopicValues():(this.cashedTopics=yield this.retrieveTopics(),this.mapTopicValues())}))}edit(t){const e=this.mapUrl(`/${t.id}`);return this.apiService.put(e,t)}create(t){const e=this.mapUrl();return this.apiService.post(e,t)}sendToSign(t){const e=Array.isArray(t),i=this.mapUrl(e?":on-sign":`/${t}:on-sign`);return this.apiService.patch(i,e?{itemIds:t}:null)}filterTopicsByType(t){return this.cashedTopics.filter(e=>e.type===t)}mapTopicValues(){return this.cashedTopics.map(t=>t.displayName)}mapUrl(t=""){return`companies/${this.companyService.currentId}/letters${t}`}}return t.\u0275fac=function(e){return new(e||t)(S.ec(A.a),S.ec(w.b),S.ec(I.a),S.ec(C.a),S.ec(L.e))},t.\u0275prov=S.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),x=(()=>{class t{constructor(t,e){this.apiService=t,this.companyService=e,this.cashedCertificateTypes$=new y.a([]),this.retrieveCertificateTypes()}getCertificate(t,e=null){return Object(T.a)(this,void 0,void 0,(function*(){try{const i=this.mapUrl(),n={certificateTypeCode:t,params:e};return yield this.apiService.post(i,n,null,null,{responseType:"blob"})}catch(i){const t=new FileReader,e=new Promise(e=>{t.onloadend=()=>{e(JSON.parse(t.result))}});throw t.readAsText(i.error),e}}))}getCertificateTypes(){return this.cashedCertificateTypes$.asObservable()}retrieveCertificateTypes(){return Object(T.a)(this,void 0,void 0,(function*(){const t=this.mapUrl("/types");let e;try{e=yield this.apiService.get(t)}catch(i){e=[]}return this.cashedCertificateTypes$.next(e),e}))}mapUrl(t=""){return`companies/${this.companyService.currentId}/certificates${t}`}}return t.\u0275fac=function(e){return new(e||t)(S.ec(I.a),S.ec(A.a))},t.\u0275prov=S.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var F=i("e8Ap"),D=i("fK/r"),j=i("PGAL"),N=i("Kcpt"),P=i("Hjq/"),V=i("g1SY");function k(t,e){if(1&t&&(S.Ub(0),S.Tc(1),S.Tb()),2&t){const t=S.mc(2);S.Ab(1),S.Vc(" ",t.dateText," ")}}function M(t,e){if(1&t&&(S.Ub(0),S.Tc(1),S.nc(2,"translate"),S.Tb()),2&t){const t=S.mc(2);S.Ab(1),S.Vc(" ",S.pc(2,1,t.date.key,t.date.params)," ")}}function W(t,e){if(1&t&&(S.Wb(0,"div",10),S.Rc(1,k,2,1,"ng-container",11),S.Rc(2,M,3,4,"ng-container",11),S.Vb()),2&t){const t=S.mc();S.Ab(1),S.uc("ngIf",t.dateText),S.Ab(1),S.uc("ngIf",t.date)}}function B(t,e){if(1&t){const t=S.Xb();S.Wb(0,"button",14),S.ic("click",(function(i){S.Ic(t);const n=e.$implicit;return S.mc(3).onFileClick(n)})),S.Rb(1,"span",15),S.Wb(2,"div",16),S.Tc(3),S.Vb(),S.Vb()}if(2&t){const t=e.$implicit;S.Ab(3),S.Vc(" ",null==t?null:t.name," ")}}function U(t,e){if(1&t&&(S.Ub(0),S.Rc(1,B,4,1,"button",13),S.Tb()),2&t){const t=S.mc(2);S.Ab(1),S.uc("ngForOf",t.letter.files)}}const Q=function(){return{height:"32px","background-color":"#ECEEF1"}};function G(t,e){1&t&&S.Rb(0,"ngx-skeleton-loader",17),2&t&&S.uc("theme",S.yc(1,Q))}function $(t,e){if(1&t&&(S.Rc(0,U,2,1,"ng-container",11),S.Rc(1,G,1,2,"ngx-skeleton-loader",12)),2&t){const t=S.mc();S.uc("ngIf",!t.isFilesLoading),S.Ab(1),S.uc("ngIf",t.isFilesLoading)}}function X(t,e){if(1&t){const t=S.Xb();S.Wb(0,"div",19),S.Wb(1,"button",20),S.ic("click",(function(e){return S.Ic(t),S.mc(2).onReply()})),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Vb()}if(2&t){const t=S.mc(2);S.Ab(2),S.Vc(" ",S.oc(3,1,t.mapTranslate("REPLY"))," ")}}function z(t,e){if(1&t&&S.Rc(0,X,4,3,"div",18),2&t){const t=S.mc();S.uc("ngIf",t.letter.incoming)}}function Y(t,e){if(1&t&&(S.Wb(0,"div",27),S.Wb(1,"div",28),S.Tc(2),S.Vb(),S.Wb(3,"div",29),S.Tc(4),S.Vb(),S.Vb()),2&t){const t=e.$implicit;S.Ab(2),S.Uc(t.name),S.Ab(1),S.Db(t.classList),S.Ab(1),S.Uc(t.label)}}function H(t,e){if(1&t&&(S.Wb(0,"section",4),S.Wb(1,"j-collapsible"),S.Wb(2,"j-collapsible-trigger"),S.Wb(3,"div",22),S.Wb(4,"h5",23),S.Tc(5),S.nc(6,"translate"),S.Vb(),S.Rb(7,"j-icon",24),S.Vb(),S.Vb(),S.Wb(8,"j-collapsible-body"),S.Wb(9,"div",25),S.Rc(10,Y,5,4,"div",26),S.Vb(),S.Vb(),S.Vb(),S.Vb()),2&t){const t=S.mc(2);S.Ab(5),S.Vc(" ",S.oc(6,3,t.mapTranslate("SIGNERS"))," "),S.Ab(2),S.uc("isStroke",!0),S.Ab(3),S.uc("ngForOf",t.signers)}}function K(t,e){if(1&t&&S.Rc(0,H,11,5,"section",21),2&t){const t=S.mc();S.uc("ngIf",(null==t.signers?null:t.signers.length)>0)}}let Z=(()=>{class t{constructor(t,e,i,n){this.router=t,this.lettersService=e,this.filesService=i,this.companyService=n,this.closed=new S.n,this.isFilesLoading=!0}ngOnInit(){this.mapDateText(),this.loadAttachments()}onClose(){this.closed.emit()}onFileClick(t){this.filesService.downloadFileById(t.id,t.name)}onReply(){this.router.navigate(["/letters/create"],{state:{title:this.mapTranslate("TITLE")}})}mapTranslate(t){return`LETTERS.DETAILS.${t}`}loadAttachments(){return Object(T.a)(this,void 0,void 0,(function*(){this.isFilesLoading=!0;try{const t=yield this.lettersService.getById(this.letter.id);this.letter=Object.assign(Object.assign({},this.letter),t),this.loadSignatures()}catch(t){}finally{this.isFilesLoading=!1}}))}loadSignatures(){return Object(T.a)(this,void 0,void 0,(function*(){this.letter.incoming||(this.signers=this.companyService.generateSignersList(this.letter.statusCode,this.letter.signatureScheme,this.letter.signatures))}))}mapDateText(){const t=this.lettersService.mapLetterDate(this.letter);"string"==typeof t?this.dateText=t:this.date=t}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(b.c),S.Qb(R),S.Qb(w.b),S.Qb(A.a))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-details-content"]],inputs:{letter:"letter"},outputs:{closed:"closed"},decls:20,vars:8,consts:[[1,"letter-details"],[1,"letter-details__header"],[3,"ngTemplateOutlet"],["inlineSVG","/assets/icons/letters/close.svg",1,"letter-details__close",3,"click"],[1,"letter-details__body"],[1,"p2",3,"innerHtml"],["dateTemplate",""],["filesTemplate",""],["actionsTemplate",""],["signersTemplate",""],[1,"text-muted","p3"],[4,"ngIf"],["count","5",3,"theme",4,"ngIf"],["class","letter-details__file",3,"click",4,"ngFor","ngForOf"],[1,"letter-details__file",3,"click"],["inlineSVG","/assets/icons/contracts/file.svg",1,"mr-3"],[1,"text-truncate","p2"],["count","5",3,"theme"],["class","letter-details__actions",4,"ngIf"],[1,"letter-details__actions"],[1,"btn","btn-primary","btn-block",3,"click"],["class","letter-details__body",4,"ngIf"],[1,"letter-details__collapse"],[1,"m-0"],["name","arrowUp",1,"ml-auto","details__arrow",3,"isStroke"],[1,"letter-details__signers","p2"],["class","j-desc-row letter-details__signer",4,"ngFor","ngForOf"],[1,"j-desc-row","letter-details__signer"],[1,"text-dark","j-desc-child"],["translate","",1,"text-muted","j-desc-child"]],template:function(t,e){if(1&t&&(S.Wb(0,"div",0),S.Wb(1,"div",1),S.Sb(2,2),S.Wb(3,"button",3),S.ic("click",(function(t){return e.onClose()})),S.Vb(),S.Vb(),S.Wb(4,"article",4),S.Wb(5,"h6"),S.Tc(6),S.Vb(),S.Rb(7,"p",5),S.nc(8,"linkifyPipe"),S.Sb(9,2),S.Sb(10,2),S.Vb(),S.Sb(11,2),S.Vb(),S.Rc(12,W,3,2,"ng-template",null,6,S.Sc),S.Rc(14,$,2,2,"ng-template",null,7,S.Sc),S.Rc(16,z,1,1,"ng-template",null,8,S.Sc),S.Rc(18,K,1,1,"ng-template",null,9,S.Sc)),2&t){const t=S.Fc(13),i=S.Fc(15),n=S.Fc(17),s=S.Fc(19);S.Ab(2),S.uc("ngTemplateOutlet",t),S.Ab(4),S.Uc(e.letter.title),S.Ab(1),S.uc("innerHtml",S.oc(8,6,e.letter.body),S.Jc),S.Ab(2),S.uc("ngTemplateOutlet",i),S.Ab(1),S.uc("ngTemplateOutlet",n),S.Ab(1),S.uc("ngTemplateOutlet",s)}},directives:[n.B,F.a,n.u,n.t,r.a,D.a,j.a,N.a,P.a,L.a],pipes:[V.a,L.d],styles:[".letter-details__header[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between}.letter-details__close[_ngcontent-%COMP%]{display:inline-block;font-weight:400;color:#1a1c1f;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;color:#666c72;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out}.letter-details__close[_ngcontent-%COMP%]:hover{color:#ef5630}.letter-details__body[_ngcontent-%COMP%]{margin-top:1.5rem;background:#fff;overflow:hidden;padding:1.5rem 1rem;border-radius:12px}.letter-details__file[_ngcontent-%COMP%]{display:inline-block;font-weight:400;color:#1a1c1f;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;width:100%;padding:0;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out;color:#1586bb}.letter-details__file[_ngcontent-%COMP%]:hover{color:#ef5630}.letter-details__file[_ngcontent-%COMP%] + .letter-details__file[_ngcontent-%COMP%]{margin-top:1.5rem}.letter-details__actions[_ngcontent-%COMP%]{margin-top:2.5rem}.letter-details__trigger[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.letter-details__signers[_ngcontent-%COMP%]{padding-top:1rem}.letter-details__collapse[_ngcontent-%COMP%]{-webkit-box-align:center;align-items:center;cursor:pointer;display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between}.letter-details__signer[_ngcontent-%COMP%]{grid-template-columns:1fr 100px}"]}),t})();var J=i("quSY");function q(t,e){if(1&t){const t=S.Xb();S.Wb(0,"button",3),S.ic("click",(function(i){S.Ic(t);const n=e.$implicit;return S.mc(2).onLinkSelect(n)})),S.Wb(1,"span"),S.Tc(2),S.Vb(),S.Rb(3,"span",4),S.Vb()}if(2&t){const t=e.$implicit;S.Ab(2),S.Uc(t.displayName)}}function tt(t,e){if(1&t&&(S.Ub(0),S.Wb(1,"div",1),S.Wb(2,"h6"),S.Tc(3),S.nc(4,"translate"),S.Vb(),S.Rc(5,q,4,1,"button",2),S.Vb(),S.Tb()),2&t){const t=S.mc();S.Ab(3),S.Uc(S.oc(4,2,t.mapTranslate(t.topicType))),S.Ab(2),S.uc("ngForOf",t.topics)}}const et=function(){return{height:"450px","background-color":"#ECEEF1"}};function it(t,e){1&t&&(S.Ub(0),S.Rb(1,"ngx-skeleton-loader",5),S.Tb()),2&t&&(S.Ab(1),S.uc("theme",S.yc(1,et)))}let nt=(()=>{class t{constructor(t,e){this.lettersService=t,this.router=e,this.isLoading=!0}ngOnInit(){this.loadTopics()}mapTranslate(t){return`LETTERS.CREATE_CONTENT.${t}`}onLinkSelect(t){this.router.navigate(["/letters/create"],{state:{title:t.displayName}})}loadTopics(){return Object(T.a)(this,void 0,void 0,(function*(){try{this.topics=yield this.lettersService.getTopics(this.topicType)}catch(t){}finally{this.isLoading=!1}}))}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(R),S.Qb(b.c))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-create-group"]],inputs:{topicType:"topicType"},decls:2,vars:2,consts:[[4,"ngIf"],[1,"letters-create-group"],["class","letters-create-group__button p2",3,"click",4,"ngFor","ngForOf"],[1,"letters-create-group__button","p2",3,"click"],["inlineSVG","/assets/icons/letters/next.svg",1,"d-inline-block","ml-3"],[3,"theme"]],template:function(t,e){1&t&&(S.Rc(0,tt,6,4,"ng-container",0),S.Rc(1,it,2,2,"ng-container",0)),2&t&&(S.uc("ngIf",!e.isLoading),S.Ab(1),S.uc("ngIf",e.isLoading))},directives:[n.u,n.t,F.a,r.a],pipes:[L.d],styles:["[_nghost-%COMP%]{display:block}.letters-create-group[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;padding:1.25rem 1rem}.letters-create-group[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-bottom:1rem}.letters-create-group__button[_ngcontent-%COMP%]{display:inline-block;font-weight:400;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;display:-webkit-box;display:flex;padding:0;text-align:left;width:100%;-webkit-box-align:baseline;align-items:baseline;-webkit-box-pack:justify;justify-content:space-between;color:#1a1c1f;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out}.letters-create-group__button[_ngcontent-%COMP%]:hover{color:#ef5630}.letters-create-group__button[_ngcontent-%COMP%] + .letters-create-group__button[_ngcontent-%COMP%]{margin-top:1rem}"]}),t})();var st=i("itXk"),rt=i("L+ju"),ot=i("1kSV"),ct=i("l/gM");let at=(()=>{class t{constructor(t){this.modal=t}onClose(){this.modal.dismiss()}onSubmit(t){this.modal.close(t)}ngOnInit(){}mapTranslate(t){return`LETTERS.CERTIFICATES.MODAL.${t}`}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(ot.a))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-certificates-modal"]],decls:5,vars:5,consts:[[1,"modal-body","px-4","pt-4","pb-0"],[3,"hideBorders","submitLabel","closed","submitted"]],template:function(t,e){1&t&&(S.Wb(0,"div",0),S.Wb(1,"h5"),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Vb(),S.Wb(4,"j-range-input",1),S.ic("closed",(function(t){return e.onClose()}))("submitted",(function(t){return e.onSubmit(t)})),S.Vb()),2&t&&(S.Ab(2),S.Uc(S.oc(3,3,e.mapTranslate("TITLE"))),S.Ab(2),S.uc("hideBorders",!0)("submitLabel",e.mapTranslate("SUBMIT")))},directives:[ct.a],pipes:[L.d],styles:[""]}),t})();var lt=i("xErE"),dt=i("VO+5"),bt=i("hsBV");const ut=["accountDropdown"];function ht(t,e){if(1&t){const t=S.Xb();S.Wb(0,"button",5),S.ic("click",(function(i){S.Ic(t);const n=e.$implicit;return S.mc(2).onTypeSelect(n)})),S.Rb(1,"span",6),S.Wb(2,"span"),S.Tc(3),S.Vb(),S.Vb()}if(2&t){const t=e.$implicit;S.Ab(3),S.Uc(t.description)}}function gt(t,e){if(1&t&&(S.Wb(0,"div"),S.Rc(1,ht,4,1,"button",4),S.Vb()),2&t){const t=S.mc();S.Ab(1),S.uc("ngForOf",t.types)}}const pt=function(){return{height:"138.06px","background-color":"#ECEEF1"}};function ft(t,e){1&t&&(S.Ub(0),S.Rb(1,"ngx-skeleton-loader",7),S.Tb()),2&t&&(S.Ab(1),S.uc("theme",S.yc(1,pt)))}const mt={backdropClass:"backdrop_light",windowClass:"modal_light modal_dictionary",backdrop:"static",centered:!0};let St=(()=>{class t{constructor(t,e,i,n,s,r,o){this.companyService=t,this.certificatesService=e,this.accountsService=i,this.filesService=n,this.notifierService=s,this.translateService=r,this.modalService=o,this.isLoading=!0,Object(st.a)([this.accountsService.getAccountsList(),this.certificatesService.getCertificateTypes()]).subscribe(t=>{const[e,i]=t;this.mapAccounts(e),this.types=i,this.isLoading=!1})}ngOnInit(){}mapTranslate(t){return`LETTERS.CERTIFICATES.${t}`}onTypeSelect(t){return Object(T.a)(this,void 0,void 0,(function*(){t.code===f.ACCOUNT_TURNOVER?this.showSertificatesModal(t):this.downloadCertificate(t,this.params)}))}onAccountSelect(t){this.params=t.accountType===rt.a.ALL?null:{iban:t.iban}}showSertificatesModal(t){return Object(T.a)(this,void 0,void 0,(function*(){const e=this.modalService.open(at,mt);try{const i=yield e.result;this.downloadCertificate(t,Object.assign(Object.assign({},this.params),{dateFrom:Object(E.d)(i.from),dateTo:Object(E.d)(i.to)}))}catch(i){}}))}downloadCertificate(t,e=null){return Object(T.a)(this,void 0,void 0,(function*(){try{const i=yield this.certificatesService.getCertificate(t.code,e);this.filesService.downloadFile(i,`${t.description} - ${this.companyService.currentCompany.name}.pdf`)}catch(i){this.mapError(i)}}))}mapError(t){return Object(T.a)(this,void 0,void 0,(function*(){const e=yield t,i=e.description||e.code||this.translateService.instant(this.mapTranslate("ERROR"));this.notifierService.notify("error",i)}))}mapAccounts(t){const e=t.filter(t=>t.accountType===rt.a.ACCOUNT);this.accounts=e.length>1?[...e,{accountType:rt.a.ALL}]:e,setTimeout(()=>{this.accountDropdown.selectAccount(this.accounts[this.accounts.length-1])},0)}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(A.a),S.Qb(x),S.Qb(lt.a),S.Qb(w.b),S.Qb(dt.c),S.Qb(L.e),S.Qb(ot.q))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-certificates"]],viewQuery:function(t,e){var i;1&t&&S.Yc(ut,!0),2&t&&S.Ec(i=S.jc())&&(e.accountDropdown=i.first)},decls:8,vars:9,consts:[[1,"letters-create-group"],[3,"isLoading","accounts","isDisabledSelectable","label","selected"],["accountDropdown",""],[4,"ngIf"],["class","letters-certificate__button p2",3,"click",4,"ngFor","ngForOf"],[1,"letters-certificate__button","p2",3,"click"],["inlineSVG","/assets/icons/v2/file-24.svg",1,"d-inline-block","mr-3"],[3,"theme"]],template:function(t,e){1&t&&(S.Wb(0,"div",0),S.Wb(1,"h6"),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Wb(4,"j-account-dropdown",1,2),S.ic("selected",(function(t){return e.onAccountSelect(t)})),S.Vb(),S.Rc(6,gt,2,1,"div",3),S.Rc(7,ft,2,2,"ng-container",3),S.Vb()),2&t&&(S.Ab(2),S.Uc(S.oc(3,7,e.mapTranslate("TITLE"))),S.Ab(2),S.uc("isLoading",e.isLoading)("accounts",e.accounts)("isDisabledSelectable",!0)("label",e.mapTranslate("ACCOUNTS_DROPDOWN")),S.Ab(2),S.uc("ngIf",!e.isLoading),S.Ab(1),S.uc("ngIf",e.isLoading))},directives:[bt.a,n.u,n.t,F.a,r.a],pipes:[L.d],styles:["[_nghost-%COMP%]{display:block}.letters-create-group[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;padding:1.25rem 1rem}.letters-create-group[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-bottom:1rem}.letters-certificate__button[_ngcontent-%COMP%]{display:inline-block;font-weight:400;color:#1a1c1f;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:0;display:-webkit-box;display:flex;color:#1586bb;-webkit-box-align:center;align-items:center;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out}.letters-certificate__button[_ngcontent-%COMP%]:hover{color:#ef5630}.letters-certificate__button[_ngcontent-%COMP%] + .letters-certificate__button[_ngcontent-%COMP%]{margin-top:1rem}"]}),t})();function Tt(t,e){1&t&&S.Rb(0,"j-letters-certificates")}let vt=(()=>{class t{constructor(t){this.certificatesService=t,this.closed=new S.n,this.LETTER_TOPIC_TYPE=g,this.subscription=new J.a,this.isCertificatesShown=!1;const e=this.certificatesService.getCertificateTypes().subscribe(t=>{var e;this.isCertificatesShown=(null===(e=t)||void 0===e?void 0:e.length)>0});this.subscription.add(e)}ngOnDestroy(){this.subscription.unsubscribe()}mapTranslate(t){return`LETTERS.CREATE_CONTENT.${t}`}onClose(){this.closed.emit()}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(x))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-create-content"]],outputs:{closed:"closed"},decls:10,vars:6,consts:[[1,"letters-create-content"],[1,"letters-create-content__header"],[1,"m-0"],["inlineSVG","/assets/icons/letters/close.svg",1,"letters-create-content__close",3,"click"],[1,"letters-create-content__body"],[4,"ngIf"],[1,"mt-3",3,"topicType"]],template:function(t,e){1&t&&(S.Wb(0,"div",0),S.Wb(1,"div",1),S.Wb(2,"h5",2),S.Tc(3),S.nc(4,"translate"),S.Vb(),S.Wb(5,"button",3),S.ic("click",(function(t){return e.onClose()})),S.Vb(),S.Vb(),S.Wb(6,"div",4),S.Rc(7,Tt,1,0,"j-letters-certificates",5),S.Rb(8,"j-letters-create-group",6),S.Rb(9,"j-letters-create-group",6),S.Vb(),S.Vb()),2&t&&(S.Ab(3),S.Uc(S.oc(4,4,e.mapTranslate("TITLE"))),S.Ab(4),S.uc("ngIf",e.isCertificatesShown),S.Ab(1),S.uc("topicType",e.LETTER_TOPIC_TYPE.CERTIFICATE),S.Ab(1),S.uc("topicType",e.LETTER_TOPIC_TYPE.APPLICATION))},directives:[F.a,n.u,nt,St],pipes:[L.d],styles:["[_nghost-%COMP%]{margin:-1rem;display:block}.letters-create-content__close[_ngcontent-%COMP%]{display:inline-block;font-weight:400;color:#1a1c1f;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;color:#666c72;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out}.letters-create-content__close[_ngcontent-%COMP%]:hover{color:#ef5630}.letters-create-content__header[_ngcontent-%COMP%]{background-color:#fff;padding:1.5rem;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between}.letters-create-content__body[_ngcontent-%COMP%]{padding:1.5rem}"]}),t})();function yt(t,e){if(1&t){const t=S.Xb();S.Wb(0,"j-letters-details-content",5),S.ic("closed",(function(e){return S.Ic(t),S.mc().hideAside()})),S.Vb()}if(2&t){const t=S.mc();S.uc("letter",t.letter)}}function _t(t,e){if(1&t){const t=S.Xb();S.Wb(0,"j-letters-create-content",6),S.ic("closed",(function(e){return S.Ic(t),S.mc().hideAside()})),S.Vb()}}let Ot=(()=>{class t{constructor(t){this.document=t,this.isContentShown=!1,this.isDetailsShowing=!1,this.isCreateShowing=!1,this.closed=new S.n}ngOnDestroy(){this.document.body.classList.remove("overflow-hidden")}showDetails(t){this.isDetailsShowing=!0,this.isCreateShowing=!1,this.letter=t,this.showContent()}showCreate(){this.isCreateShowing=!0,this.isDetailsShowing=!1,this.showContent()}hideAside(){this.letter=null,this.isCreateShowing=!1,this.isDetailsShowing=!1,this.document.body.classList.remove("overflow-hidden"),this.isContentShown=!1,this.closed.emit()}showContent(){this.document.body.classList.add("overflow-hidden"),this.isContentShown=!0}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(n.e))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-aside"]],outputs:{closed:"closed"},decls:5,vars:4,consts:[[1,"f-page-wrapper","is-shown"],[1,"f-page-backdrop",3,"click"],[1,"f-page-content","f-page-content--gray","f-page-content--quarter","is-shown","letters-aside"],[3,"letter","closed",4,"ngIf"],[3,"closed",4,"ngIf"],[3,"letter","closed"],[3,"closed"]],template:function(t,e){1&t&&(S.Wb(0,"section",0),S.Wb(1,"div",1),S.ic("click",(function(t){return e.hideAside()})),S.Vb(),S.Wb(2,"section",2),S.Rc(3,yt,1,1,"j-letters-details-content",3),S.Rc(4,_t,1,0,"j-letters-create-content",4),S.Vb(),S.Vb()),2&t&&(S.uc("@wrapper",e.isContentShown?"shown":"hidden"),S.Ab(2),S.uc("@content",e.isContentShown?"shown":"hidden"),S.Ab(1),S.uc("ngIf",e.isDetailsShowing),S.Ab(1),S.uc("ngIf",e.isCreateShowing))},directives:[n.u,Z,vt],styles:[".letters-aside[_ngcontent-%COMP%]{padding:1rem;top:62px}@media(min-width:960px){.letters-aside[_ngcontent-%COMP%]{top:98px}}@media(min-width:1280px){.letters-aside[_ngcontent-%COMP%]{top:0}}"],data:{animation:[Object(m.o)("wrapper",[Object(m.l)("shown",Object(m.m)({transform:"scale(1)",visibility:"visible",opacity:"1"})),Object(m.l)("hidden",Object(m.m)({transform:"scale(0.9)",visibility:"hidden",opacity:"0"})),Object(m.n)("shown<=>hidden",Object(m.e)("250ms"))]),Object(m.o)("content",[Object(m.l)("shown",Object(m.m)({right:"0%"})),Object(m.l)("hidden",Object(m.m)({right:"-25%"})),Object(m.n)("shown<=>hidden",Object(m.e)("500ms ease-in-out"))])]}}),t})();var Et=i("570E"),At=i("S1F0"),wt=i("oKsb"),It=i("fvpk"),Ct=i("lJxs"),Lt=i("TwVa"),Rt=i("h7tf"),xt=i("9odQ"),Ft=i("LFY/"),Dt=i("M6pS");function jt(t,e){if(1&t&&(S.Ub(0),S.Wb(1,"form",5),S.Sb(2,6),S.Sb(3,6),S.Sb(4,6),S.Sb(5,6),S.Vb(),S.Tb()),2&t){const t=S.mc(),e=S.Fc(3),i=S.Fc(5),n=S.Fc(7),s=S.Fc(9);S.Ab(1),S.uc("formGroup",t.form),S.Ab(1),S.uc("ngTemplateOutlet",e),S.Ab(1),S.uc("ngTemplateOutlet",i),S.Ab(1),S.uc("ngTemplateOutlet",n),S.Ab(1),S.uc("ngTemplateOutlet",s)}}const Nt=function(){return{height:"56px","background-color":"#ECEEF1"}},Pt=function(){return{height:"335px","background-color":"#ECEEF1"}},Vt=function(){return{"margin-bottom":"50px",width:"50%",height:"32px","background-color":"#ECEEF1"}};function kt(t,e){if(1&t&&(S.Wb(0,"div"),S.Rb(1,"ngx-skeleton-loader",7),S.Rb(2,"ngx-skeleton-loader",7),S.Rb(3,"ngx-skeleton-loader",7),S.Sb(4,6),S.Wb(5,"div",8),S.Rb(6,"ngx-skeleton-loader",7),S.Vb(),S.Vb()),2&t){S.mc();const t=S.Fc(7);S.Ab(1),S.uc("theme",S.yc(5,Nt)),S.Ab(1),S.uc("theme",S.yc(6,Pt)),S.Ab(1),S.uc("theme",S.yc(7,Vt)),S.Ab(1),S.uc("ngTemplateOutlet",t),S.Ab(2),S.uc("theme",S.yc(8,Nt))}}function Mt(t,e){if(1&t&&(S.Wb(0,"span",14),S.Tc(1),S.Vb()),2&t){const t=e.$implicit;S.Ab(1),S.Vc(" ",t," ")}}function Wt(t,e){if(1&t){const t=S.Xb();S.Wb(0,"div",9),S.Wb(1,"j-dropdown-input",10,11),S.ic("selected",(function(e){return S.Ic(t),S.mc().onTitleSelect(e)})),S.Rc(3,Mt,2,1,"ng-template",null,12,S.Sc),S.Vb(),S.Vb(),S.Wb(5,"div",9),S.Rb(6,"j-input",13),S.nc(7,"async"),S.Vb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("options",t.topics)("hasError",t.f.title.invalid&&t.isSubmitted)("selectedItem",t.f.title.value)("label",t.mapTranslate("TITLE")),S.Ab(5),S.uc("label",t.mapTranslate("BODY"))("inputExtra",S.oc(7,11,t.bodyLengthMessage$))("formControl",t.f.body)("hasError",t.f.body.invalid&&t.isSubmitted)("errorText",t.mapBodyErrors())("maxLength",t.bodyMaxLength)("isClearable",!1)}}function Bt(t,e){if(1&t&&(S.Wb(0,"div",23),S.Tc(1),S.nc(2,"translate"),S.Vb()),2&t){const t=S.mc(2);S.Ab(1),S.Vc(" ",S.oc(2,1,t.mapTranslate("MAX_FILES_REACHED"))," ")}}const Ut=function(t){return{acceptedFormats:t}};function Qt(t,e){if(1&t){const t=S.Xb();S.Wb(0,"div",15),S.Wb(1,"div",16),S.Wb(2,"input",17),S.ic("change",(function(e){return S.Ic(t),S.mc().onAddFile(e)})),S.Vb(),S.Wb(3,"label",18),S.Rb(4,"span",19),S.Wb(5,"span"),S.Tc(6),S.nc(7,"translate"),S.Vb(),S.Vb(),S.Wb(8,"span",20),S.Tc(9),S.nc(10,"translate"),S.Vb(),S.Vb(),S.Wb(11,"j-uploading-files",21),S.ic("updated",(function(e){return S.Ic(t),S.mc().onUploadingFilesUpdate(e)})),S.Vb(),S.Rc(12,Bt,3,3,"div",22),S.Vb()}if(2&t){const t=S.mc();S.Ab(2),S.uc("formControl",t.f.uploadModel)("accept",t.acceptedFormats),S.Ab(4),S.Vc(" ",S.oc(7,9,t.mapTranslate("ADD_FILE"))," "),S.Ab(3),S.Vc(" ",S.pc(10,11,t.mapTranslate("ADD_FILE_DESCRIPTION"),S.zc(14,Ut,t.acceptedFormats))," "),S.Ab(2),S.uc("isLoading",t.isLoading)("acceptedFormats",t.acceptedFormats)("uploadingFiles",t.uploadingFiles)("maxSize",t.maxSize),S.Ab(1),S.uc("ngIf",(null==t.uploadingFiles?null:t.uploadingFiles.length)>10)}}function Gt(t,e){if(1&t&&(S.Wb(0,"div",24),S.Rb(1,"span",25),S.Wb(2,"span"),S.Tc(3),S.nc(4,"translate"),S.Vb(),S.Vb()),2&t){const t=S.mc();S.Ab(3),S.Vc(" ",S.oc(4,1,t.mapTranslate("INFO"))," ")}}function $t(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"button",27),S.ic("click",(function(e){return S.Ic(t),S.mc(2).edit()})),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Tb()}if(2&t){const t=S.mc(2);S.Ab(1),S.uc("jLoadingInverted",!0)("disabled",t.isSubmitting||(null==t.uploadingFiles?null:t.uploadingFiles.length)>10)("jLoading",t.isSubmitting),S.Ab(1),S.Vc(" ",S.oc(3,4,t.mapTranslate("SAVE_EDITING"))," ")}}function Xt(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"button",28),S.ic("click",(function(e){return S.Ic(t),S.mc(2).saveToDraft()})),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Tb()}if(2&t){const t=S.mc(2);S.Ab(1),S.uc("disabled",t.isSubmitting||(null==t.uploadingFiles?null:t.uploadingFiles.length)>10)("jLoading",t.isSubmitting)("jLoadingInverted",!0),S.Ab(1),S.Vc(" ",S.oc(3,4,t.mapTranslate("SAVE_TO_DRAFT"))," ")}}function zt(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"button",29),S.ic("click",(function(e){return S.Ic(t),S.mc(2).createAndSign()})),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Tb()}if(2&t){const t=S.mc(2);S.Ab(1),S.uc("disabled",t.isSubmitting||(null==t.uploadingFiles?null:t.uploadingFiles.length)>10)("jLoading",t.isSubmitting),S.Ab(1),S.Vc(" ",S.oc(3,3,t.mapTranslate(t.createAndSignLabel))," ")}}function Yt(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"button",29),S.ic("click",(function(e){return S.Ic(t),S.mc(2).createAndSendForSign()})),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Tb()}if(2&t){const t=S.mc(2);S.Ab(1),S.uc("disabled",t.isSubmitting||(null==t.uploadingFiles?null:t.uploadingFiles.length)>10)("jLoading",t.isSubmitting),S.Ab(1),S.Vc(" ",S.oc(3,3,t.mapTranslate("CREATE_AND_SEND_FOR_SIGN"))," ")}}function Ht(t,e){if(1&t&&(S.Wb(0,"div",26),S.Rc(1,$t,4,6,"ng-container",0),S.Rc(2,Xt,4,6,"ng-container",0),S.Rc(3,zt,4,5,"ng-container",0),S.Rc(4,Yt,4,5,"ng-container",0),S.Vb()),2&t){const t=S.mc();S.Ab(1),S.uc("ngIf",t.isEditing),S.Ab(1),S.uc("ngIf",!t.isEditing),S.Ab(1),S.uc("ngIf",t.canSendAndSign),S.Ab(1),S.uc("ngIf",t.canSendOnly)}}var Kt=function(t){return t.SAVED_TO_DRAFT="NOTIFICATIONS.SAVED_TO_DRAFT",t.SENT_FOR_SIGN="NOTIFICATIONS.SENT_FOR_SIGN",t.SAVED_EDITING="NOTIFICATIONS.SAVED_EDITING",t.SIGNED="NOTIFICATIONS.SIGNED",t.SAVED_TO_DRAFT_ERROR="NOTIFICATIONS.SAVED_TO_DRAFT_ERROR",t.SENT_FOR_SIGN_ERROR="NOTIFICATIONS.SENT_FOR_SIGN_ERROR",t.SAVED_EDITING_ERROR="NOTIFICATIONS.SAVED_EDITING_ERROR",t.SIGNED_ERROR="NOTIFICATIONS.SIGNED_ERROR",t}({});let Zt=(()=>{class t{constructor(t,e,i,n,s,r,o){this.route=t,this.router=e,this.lettersService=i,this.companyService=n,this.filesService=s,this.notifierService=r,this.translateService=o,this.acceptedFormats=".doc, .docx, .pdf, .jpg, .jpeg, .png, .xls, .xlsx",this.maxSize=5e6,this.isSubmitted=!1,this.isLoading=!1,this.isSubmitting=!1,this.isEditing=!1,this.uploadingFiles=[],this.bodyMaxLength=1e3,this.bodyLengthMessage$=new y.a(`0/${this.bodyMaxLength}`),this.subscription=new J.a;const c=Object(st.a)([this.route.paramMap.pipe(Object(Ct.a)(()=>window.history.state)),this.route.params]).subscribe(t=>{const[e,i]=t;e.letter?(this.isEditing=!0,this.loadEditLetterByBody(e.letter,e.topics,e.files)):i.id?(this.isEditing=!0,this.loadEditLetterById(i.id)):this.loadNewLetter(e.title)});this.subscription.add(c),this.createAndSignLabel=this.companyService.isSecondaryAuthority()?"SIGN":"CREATE_AND_SIGN"}ngOnDestroy(){this.lettersService.clearFiles(),this.subscription.unsubscribe()}get f(){return this.form.controls}get canSendAndSign(){return this.companyService.isSecondaryAuthority()||this.companyService.isPrimaryAuthority()&&this.companyService.isSingleSignScheme()}get canSendOnly(){return this.companyService.isNoSignAuthority()||this.companyService.isPrimaryAuthority()&&this.companyService.isMultipleSignScheme()}loadEditLetter(t){this.originalLetter=t,setTimeout(()=>{var e;const{id:i,title:n,body:s}=t;this.form.setValue({id:i,title:n,body:s,uploadModel:null}),(null===(e=t.files)||void 0===e?void 0:e.length)>0&&(this.uploadingFiles=t.files.map(t=>({isLoading:!1,file:t})))},0)}loadEditLetterByBody(t,e,i=[]){return Object(T.a)(this,void 0,void 0,(function*(){this.uploadingFiles=i,this.topics=e,this.loadEditLetter(t),this.initForm(t)}))}loadEditLetterById(t){return Object(T.a)(this,void 0,void 0,(function*(){this.isLoading=!0;try{const e=yield this.lettersService.getById(t);yield this.loadTopics(),this.loadEditLetter(e),this.initForm(e)}catch(e){}finally{this.isLoading=!1}}))}loadNewLetter(t=""){return Object(T.a)(this,void 0,void 0,(function*(){this.isLoading=!0;try{yield this.loadTopics(),this.initForm({title:t})}catch(e){}finally{this.isLoading=!1}}))}loadTopics(){return Object(T.a)(this,void 0,void 0,(function*(){this.topics=yield this.lettersService.getTopicValues()}))}initForm(t=null){const{id:e,title:i,body:n}={id:t.id||null,title:t.title||"",body:t.body||""};this.form=new s.k({id:new s.h(e),title:new s.h(i,s.H.required),body:new s.h(n,[s.H.required,s.H.maxLength(this.bodyMaxLength)]),uploadModel:new s.h("")});const r=this.form.valueChanges.subscribe(t=>{this.isSubmitted=!1}),o=this.f.body.valueChanges.subscribe(t=>{this.bodyLengthMessage$.next(`${t.length}/${this.bodyMaxLength}`)});this.subscription.add(o),this.subscription.add(r)}prepareCreate(){return this.isSubmitted=!0,!this.form.invalid&&(this.filesService.hasLoadingFiles(this.uploadingFiles)?(this.notifierService.notify("default",this.translateService.instant("FILES.PLEASE_WAIT")),!1):(this.filesService.hasErroredFiles(this.uploadingFiles)&&this.notifierService.notify("default",this.translateService.instant("FILES.HAS_ERRORED_FILES")),!0))}saveToDraft(){return Object(T.a)(this,void 0,void 0,(function*(){if(!this.isSubmitting){this.isSubmitting=!0;try{const t=yield this.createDraft();this.showNotification(Kt.SAVED_TO_DRAFT),this.router.navigate(["/letters/drafts"],{state:{highlighted:t.id}}),this.isSubmitting=!1}catch(t){this.showNotification(Kt.SAVED_TO_DRAFT_ERROR,"error"),this.isSubmitting=!1}}}))}createAndSendForSign(){return Object(T.a)(this,void 0,void 0,(function*(){if(!this.isSubmitting&&this.prepareCreate()){this.isSubmitting=!0;try{const t=yield this.lettersService.create(Object.assign(Object.assign({},this.mapLetterBody()),{statusCode:Lt.g.ON_SIGN}));this.showNotification(Kt.SENT_FOR_SIGN),this.router.navigate(["/letters/outbox/on-sign"],{state:{highlighted:t.id}})}catch(t){this.showNotification(Kt.SENT_FOR_SIGN_ERROR,"error"),this.isSubmitting=!1}}}))}createDraftAndNavigate(){return Object(T.a)(this,void 0,void 0,(function*(){try{this.originalLetter=yield this.createDraft(),this.router.navigate(["edit",this.originalLetter.id],{relativeTo:this.route.parent,state:{letter:this.originalLetter,topics:this.topics,files:this.uploadingFiles}})}catch(t){}}))}createAndSign(){return Object(T.a)(this,void 0,void 0,(function*(){if(!this.isSubmitting&&this.prepareCreate()){this.isSubmitting=!0;try{yield this.createDraftAndNavigate(),yield this.lettersService.sign(this.originalLetter.id),this.showNotification(Kt.SIGNED),this.companyService.isSecondaryAuthority()?this.router.navigate(["/letters/outbox/on-sign"],{state:{highlighted:this.originalLetter.id}}):this.router.navigate(["/letters/outbox/sent"],{state:{highlighted:this.originalLetter.id}})}catch(t){this.showNotification(Kt.SIGNED_ERROR,"error"),this.isSubmitting=!1}}}))}edit(){return Object(T.a)(this,void 0,void 0,(function*(){this.isSubmitting=!0;try{yield this.lettersService.edit(Object.assign(Object.assign({},this.originalLetter),this.mapLetterBody())),this.showNotification(Kt.SAVED_EDITING),this.router.navigate(["/letters/drafts"],{state:{highlighted:this.originalLetter.id}})}catch(t){this.showNotification(Kt.SAVED_EDITING_ERROR,"error"),this.isSubmitting=!1}}))}createDraft(){return this.lettersService.create(Object.assign(Object.assign({},this.mapLetterBody()),{statusCode:Lt.g.DRAFT}))}mapTranslate(t){return`LETTERS.CREATE.${t}`}mapBodyErrors(){return this.f.body.errors?this.f.body.errors.maxlength?"ERRORS.MAX_LENGTH":void 0:null}onTitleSelect(t){this.f.title.setValue(t)}onAddFile(t){var e,i;(null===(i=null===(e=t)||void 0===e?void 0:e.target)||void 0===i?void 0:i.files)&&(this.lettersService.onFileDrop(t.target.files),this.f.uploadModel.setValue(null))}onUploadingFilesUpdate(t){this.uploadingFiles=t}showNotification(t,e="default"){const i=this.mapTranslate(t),n=this.translateService.instant(i);this.notifierService.notify(e,n)}mapLetterBody(){return Object.assign(Object.assign({},this.form.getRawValue()),{fileIds:this.uploadingFiles.filter(t=>{var e;return!t.error&&(null===(e=t.file)||void 0===e?void 0:e.id)}).map(t=>t.file.id)})}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(b.a),S.Qb(b.c),S.Qb(R),S.Qb(A.a),S.Qb(w.b),S.Qb(dt.c),S.Qb(L.e))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-create-form"]],decls:10,vars:2,consts:[[4,"ngIf"],["formTemplate",""],["filesTemplate",""],["infoTemplate",""],["submitTemplate",""],[1,"letters-create",3,"formGroup"],[3,"ngTemplateOutlet"],[3,"theme"],[1,"form-footer","form-footer--bordered"],[1,"form-group"],[3,"options","hasError","selectedItem","label","selected"],["titleDropdown",""],["optionTemplate",""],["type","textarea","inputClass","j-input--large-textarea",3,"label","inputExtra","formControl","hasError","errorText","maxLength","isClearable"],[1,"py-2"],[1,"letters-create__files"],[1,"j-input-file"],["id","fileUpload","type","file","multiple","true",3,"formControl","accept","change"],["for","fileUpload",1,"link-blue"],["inlineSVG","/assets/icons/letters/attachment.svg",1,"mr-2"],[1,"text-muted"],[3,"isLoading","acceptedFormats","uploadingFiles","maxSize","updated"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"],[1,"form-footer","letters-create__info","form-footer--bordered","text-muted"],["inlineSVG","/assets/icons/letters/info.svg",1,"mr-3"],[1,"form-footer","form-footer--bordered","letter-create__submit"],["type","button",1,"btn","btn-link",3,"jLoadingInverted","disabled","jLoading","click"],["type","button",1,"btn","btn-link",3,"disabled","jLoading","jLoadingInverted","click"],["type","submit",1,"btn","btn-primary",3,"disabled","jLoading","click"]],template:function(t,e){1&t&&(S.Rc(0,jt,6,5,"ng-container",0),S.Rc(1,kt,7,9,"div",0),S.Rc(2,Wt,8,13,"ng-template",null,1,S.Sc),S.Rc(4,Qt,13,16,"ng-template",null,2,S.Sc),S.Rc(6,Gt,5,3,"ng-template",null,3,S.Sc),S.Rc(8,Ht,5,4,"ng-template",null,4,S.Sc)),2&t&&(S.uc("ngIf",e.form&&!e.isLoading),S.Ab(1),S.uc("ngIf",e.isLoading))},directives:[n.u,s.J,s.u,s.l,n.B,r.a,Rt.a,xt.b,s.t,s.i,s.c,F.a,Ft.a,Dt.a],pipes:[n.b,L.d],styles:[".letter-create__submit[_ngcontent-%COMP%]{-webkit-box-orient:vertical;-webkit-box-direction:reverse;flex-direction:column-reverse}.letter-create__submit[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%] + .btn[_ngcontent-%COMP%]{margin-top:1rem;margin-left:0}@media(min-width:1280px){.letter-create__submit[_ngcontent-%COMP%]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.letter-create__submit[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%] + .btn[_ngcontent-%COMP%]{margin-top:0;margin-left:1rem}}.letter-create__submit[_ngcontent-%COMP%]   ngx-skeleton-loader[_ngcontent-%COMP%]{width:50%}.letters-create__info[_ngcontent-%COMP%]{-webkit-box-pack:start;justify-content:flex-start;-webkit-box-align:center;align-items:center;padding:1.5rem 0}"]}),t})(),Jt=(()=>{class t{constructor(t,e,i){this.route=t,this.router=e,this.lettersService=i,this.subscription=new J.a,this.lettersService.lastLettersListPath$.subscribe(t=>{this.lastLetterListPath=t})}ngOnInit(){const t=this.route.params.subscribe(t=>{this.title=t.id?"LETTERS.CREATE.EDIT":"LETTERS.CREATE.TITLE"});this.subscription.add(t)}ngOnDestroy(){this.lettersService.clearFiles(),this.subscription.unsubscribe()}onFileDropped(t){this.lettersService.onFileDrop(t)}onClose(){this.lettersService.clearFiles(),this.router.navigate(["/letters",this.lastLetterListPath])}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(b.a),S.Qb(b.c),S.Qb(R))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-create"]],decls:9,vars:3,consts:[["jDnd","",1,"dnd-wrap",3,"fileDropped"],["closePosition","outside","colsClassList","offset-lg-1 col-lg-10 offset-xl-2 col-xl-8","headerClassList","bg-white",3,"closed"],[1,"account-header"],[1,"f-page-title"]],template:function(t,e){1&t&&(S.Wb(0,"section",0),S.ic("fileDropped",(function(t){return e.onFileDropped(t)})),S.Wb(1,"f-page",1),S.ic("closed",(function(t){return e.onClose()})),S.Wb(2,"f-page-header"),S.Wb(3,"section",2),S.Wb(4,"h1",3),S.Tc(5),S.nc(6,"translate"),S.Vb(),S.Vb(),S.Vb(),S.Wb(7,"f-page-body"),S.Rb(8,"j-letters-create-form"),S.Vb(),S.Vb(),S.Vb()),2&t&&(S.Ab(5),S.Vc("",S.oc(6,1,e.title)," "))},directives:[Et.a,At.a,wt.a,It.a,Zt],pipes:[L.d],styles:[".dnd-wrap[_ngcontent-%COMP%]{-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out}.dnd-wrap.fileover[_ngcontent-%COMP%]{opacity:.5}"]}),t})();var qt=i("bsP8"),te=i("paXB"),ee=i("7/bn"),ie=i("oMXN"),ne=i("EiG8"),se=i("zdqJ");function re(t,e){if(1&t&&(S.Wb(0,"span",10),S.Tc(1),S.Vb()),2&t){const t=S.mc(2).$implicit;S.Db(t.badgeClass),S.Ab(1),S.Uc(t.badge)}}function oe(t,e){1&t&&(S.Wb(0,"span",11),S.Rb(1,"span",12),S.Vb()),2&t&&(S.Ab(1),S.uc("jLoading",!0))}function ce(t,e){if(1&t&&(S.Ub(0),S.Rc(1,re,2,3,"span",8),S.Rc(2,oe,2,1,"span",9),S.Tb()),2&t){const t=S.mc().$implicit;S.Ab(1),S.uc("ngIf",0!=t.badge),S.Ab(1),S.uc("ngIf",null==t.badge)}}function ae(t,e){if(1&t&&(S.Wb(0,"a",6),S.Wb(1,"span"),S.Tc(2),S.nc(3,"translate"),S.Vb(),S.Rc(4,ce,3,2,"ng-container",7),S.Vb()),2&t){const t=e.$implicit,i=S.mc();S.uc("routerLink",t.url),S.Ab(2),S.Uc(S.oc(3,3,t.label)),S.Ab(2),S.uc("ngIf",i.isBadgesShown(t.id))}}let le=(()=>{class t{constructor(t,e){this.navService=t,this.route=e,this.letterTypes=[{id:"outbox",label:"LETTERS.TYPES.OUTBOX",url:"/letters/outbox",badge:null,badgeClass:"badge-primary"},{id:"inbox",label:"LETTERS.TYPES.INBOX",url:"/letters/inbox",badge:null,badgeClass:"badge-primary"},{id:"draft",label:"LETTERS.TYPES.DRAFT",url:"/letters/drafts",badge:null,badgeClass:"badge-light"}],this.createShown=new S.n,this.subscription=new J.a,this.route.data.subscribe(t=>{this.isOutboxRoute=t.isOutbox||!1}),this.subscription.add(this.navService.getLetterBadges().subscribe(t=>{this.setBadge("outbox",t.onSignForMe),this.setBadge("inbox",t.unread),this.setBadge("draft",t.draft)}))}isBadgesShown(t){switch(t){case"inbox":case"draft":return!0;case"outbox":return!this.isOutboxRoute}}ngOnDestroy(){this.subscription.unsubscribe()}setBadge(t,e){this.letterTypes.find(e=>e.id===t).badge=e}onCreateShown(){this.createShown.emit()}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(qt.a),S.Qb(b.a))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-nav"]],outputs:{createShown:"createShown"},decls:8,vars:4,consts:[[1,"j-tabs"],[1,"j-tabs__list"],["class","j-tabs__item","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["jTour","LETTERS.NEW","jTourPosition","bottom",1,"ml-auto","btn","btn-link","j-tabs__add",3,"click"],["inlineSVG","/assets/icons/contracts/add.svg",1,"j-tabs__add-icon"],[1,"d-none","d-md-block"],["routerLinkActive","active",1,"j-tabs__item",3,"routerLink"],[4,"ngIf"],["class","j-tabs__badge badge",3,"class",4,"ngIf"],["class","j-tabs__badge badge badge-light",4,"ngIf"],[1,"j-tabs__badge","badge"],[1,"j-tabs__badge","badge","badge-light"],[3,"jLoading"]],template:function(t,e){1&t&&(S.Wb(0,"div",0),S.Wb(1,"nav",1),S.Rc(2,ae,5,5,"a",2),S.Wb(3,"button",3),S.ic("click",(function(t){return e.onCreateShown()})),S.Rb(4,"span",4),S.Wb(5,"span",5),S.Tc(6),S.nc(7,"translate"),S.Vb(),S.Vb(),S.Vb(),S.Vb()),2&t&&(S.Ab(2),S.uc("ngForOf",e.letterTypes),S.Ab(4),S.Uc(S.oc(7,2,"LETTERS.ADD_NEW")))},directives:[n.t,se.a,F.a,b.f,b.e,n.u,Dt.a],pipes:[L.d],styles:[""]}),t})();var de=i("LRne"),be=i("JIr8"),ue=i("I+WJ"),he=i("hJI6"),ge=i("vZvt");function pe(t,e){if(1&t&&(S.Wb(0,"div",9),S.Tc(1),S.nc(2,"translate"),S.Vb()),2&t){const t=S.mc(2);S.Ab(1),S.Uc(S.oc(2,1,t.mapTranslate("FOR_SIGN")))}}const fe=function(t){return{$implicit:t}};function me(t,e){if(1&t&&(S.Wb(0,"div",5),S.Wb(1,"div",6),S.Sb(2,7),S.Rc(3,pe,3,3,"div",8),S.Vb(),S.Sb(4,7),S.Vb()),2&t){const t=e.$implicit,i=S.mc(),n=S.Fc(6),s=S.Fc(8);S.Ab(2),S.uc("ngTemplateOutlet",n)("ngTemplateOutletContext",S.zc(5,fe,t)),S.Ab(1),S.uc("ngIf",i.isSignable),S.Ab(1),S.uc("ngTemplateOutlet",s)("ngTemplateOutletContext",S.zc(7,fe,t))}}function Se(t,e){if(1&t&&(S.Wb(0,"div",5),S.Sb(1,7),S.Sb(2,7),S.Vb()),2&t){const t=e.$implicit;S.mc();const i=S.Fc(6),n=S.Fc(8);S.Ab(1),S.uc("ngTemplateOutlet",i)("ngTemplateOutletContext",S.zc(4,fe,t)),S.Ab(1),S.uc("ngTemplateOutlet",n)("ngTemplateOutletContext",S.zc(6,fe,t))}}function Te(t,e){if(1&t&&(S.Wb(0,"div",10),S.Tc(1),S.nc(2,"async"),S.Vb()),2&t){const t=e.$implicit,i=S.mc();S.Ab(1),S.Vc(" ",S.oc(2,1,i.mapDateText(t))," ")}}function ve(t,e){if(1&t&&S.Rb(0,"div",15),2&t){const t=S.mc().$implicit;S.uc("jClamp",1)("innerText",null==t?null:t.body)}}function ye(t,e){if(1&t&&S.Rb(0,"div",16),2&t){const t=S.mc().$implicit;S.uc("jClamp",1)("innerText",null==t?null:t.body)}}function _e(t,e){if(1&t&&(S.Wb(0,"article",11),S.Rb(1,"strong",12),S.Rc(2,ve,1,2,"div",13),S.Rc(3,ye,1,2,"div",14),S.Vb()),2&t){const t=e.$implicit;S.Ab(1),S.uc("jClamp",1)("innerText",null==t?null:t.title),S.Ab(1),S.uc("ngIf",!t.hasTour),S.Ab(1),S.uc("ngIf",t.hasTour)}}let Oe=(()=>{class t{constructor(t,e,i,n,s,r){this.lettersService=t,this.router=e,this.route=i,this.navService=n,this.companyService=s,this.translateService=r,this.isDeletable=!1,this.isSelectable=!1,this.isSignable=!1,this.detailsShown=new S.n,this.scrolled=new S.n,this.translatePrefix="LETTERS.LIST",this.urlPath="letters",this.modalPartialTitleFn=this.mapModalPartialTitle.bind(this),this.highlightedFn=this.shouldBeHighlighted.bind(this),this.highlightedTemporarilyFn=this.shouldBeHighlightedTemporarily.bind(this)}onClick(t){t.read=!0,t.statusCode===Lt.g.DRAFT?this.router.navigate(["edit",t.id],{relativeTo:this.route.parent}):this.detailsShown.emit(t)}onScroll(){this.scrolled.emit()}shouldBeHighlighted(t){return!t.read}shouldBeHighlightedTemporarily(t){return this.highlighted===t.id}mapModalPartialTitle(t){return`\u2116 ${t.letterNumber}:`}onClear(){this.navService.retrieveLetterBadges()}onSign(){(this.companyService.isSingleSignScheme()||this.companyService.isMultipleSignScheme()&&this.companyService.isPrimaryAuthority())&&this.router.navigate(["sent"],{relativeTo:this.route.parent})}mapTranslate(t){return`${this.translatePrefix}.${t}`}mapDateText(t){const e=this.lettersService.mapLetterDate(t);return"string"==typeof e?Object(de.a)(e):this.translateService.stream(e.key,e.params)}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(R),S.Qb(b.c),S.Qb(b.a),S.Qb(qt.a),S.Qb(A.a),S.Qb(L.e))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-group"]],inputs:{title:"title",list:"list",highlighted:"highlighted",isDeletable:"isDeletable",isSelectable:"isSelectable",isSignable:"isSignable"},outputs:{detailsShown:"detailsShown",scrolled:"scrolled"},decls:9,vars:11,consts:[[3,"list","title","urlPath","translatePrefix","isDeletable","isSelectable","isSignable","isHoverable","partialTitleFn","highlightedFn","highlightedTemporarilyFn","scrolled","clicked","cleared","signed"],["selectableTemplate",""],["defaultTemplate",""],["dateTemplate",""],["contentTemplate",""],[1,"p3","letters-item"],[1,"letters-item__status"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["class","text-blue",4,"ngIf"],[1,"text-blue"],[1,"letters-item__date","text-muted"],[1,"letters-item__content","p3"],[1,"letters-item__title","text-dark",3,"jClamp","innerText"],["class","text-muted letters-item__body",3,"jClamp","innerText",4,"ngIf"],["class","text-muted letters-item__body","jTour","LETTERS.DETAILS","jTourPosition","bottom",3,"jClamp","innerText",4,"ngIf"],[1,"text-muted","letters-item__body",3,"jClamp","innerText"],["jTour","LETTERS.DETAILS","jTourPosition","bottom",1,"text-muted","letters-item__body",3,"jClamp","innerText"]],template:function(t,e){1&t&&(S.Wb(0,"j-list",0),S.ic("scrolled",(function(t){return e.onScroll()}))("clicked",(function(t){return e.onClick(t)}))("cleared",(function(t){return e.onClear()}))("signed",(function(t){return e.onSign()})),S.Rc(1,me,5,9,"ng-template",null,1,S.Sc),S.Rc(3,Se,3,8,"ng-template",null,2,S.Sc),S.Vb(),S.Rc(5,Te,3,3,"ng-template",null,3,S.Sc),S.Rc(7,_e,4,4,"ng-template",null,4,S.Sc)),2&t&&S.uc("list",e.list)("title",e.title)("urlPath",e.urlPath)("translatePrefix",e.translatePrefix)("isDeletable",e.isDeletable)("isSelectable",e.isSelectable)("isSignable",e.isSignable)("isHoverable",!0)("partialTitleFn",e.modalPartialTitleFn)("highlightedFn",e.highlightedFn)("highlightedTemporarilyFn",e.highlightedTemporarilyFn)},directives:[he.a,n.B,n.u,ge.a,se.a],pipes:[L.d,n.b],styles:["[_nghost-%COMP%]{display:block;background:#fff}.letters-item[_ngcontent-%COMP%]{display:grid;-webkit-column-gap:16px;-moz-column-gap:16px;column-gap:16px;grid-template-columns:148px minmax(0,1fr)}"]}),t})();var Ee=i("4cI0"),Ae=i("lABO");const we=function(){return{width:"25%",height:"33px","background-color":"#ECEEF1"}};function Ie(t,e){1&t&&S.Rb(0,"ngx-skeleton-loader",3),2&t&&S.uc("theme",S.yc(1,we))}const Ce=function(){return{width:"13%","margin-right":"2%",height:"42px","background-color":"#ECEEF1"}},Le=function(){return{width:"80%",height:"42px","background-color":"#ECEEF1"}};function Re(t,e){1&t&&(S.Wb(0,"div"),S.Rb(1,"ngx-skeleton-loader",3),S.Rb(2,"ngx-skeleton-loader",3),S.Vb()),2&t&&(S.Ab(1),S.uc("theme",S.yc(2,Ce)),S.Ab(1),S.uc("theme",S.yc(3,Le)))}let xe=(()=>{class t{constructor(){this.hasTitle=!1}get loadingCount(){return Array(5)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-loading"]],inputs:{hasTitle:"hasTitle"},decls:3,vars:2,consts:[[1,"bg-white","p-3"],[3,"theme",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"theme"]],template:function(t,e){1&t&&(S.Wb(0,"section",0),S.Rc(1,Ie,1,2,"ngx-skeleton-loader",1),S.Rc(2,Re,3,4,"div",2),S.Vb()),2&t&&(S.Ab(1),S.uc("ngIf",e.hasTitle),S.Ab(1),S.uc("ngForOf",e.loadingCount))},directives:[n.u,n.t,r.a],styles:[""]}),t})();function Fe(t,e){1&t&&S.Rb(0,"j-empty-placeholder",5)}function De(t,e){if(1&t){const t=S.Xb();S.Wb(0,"j-error-placeholder",6),S.ic("retried",(function(e){return S.Ic(t),S.mc(2).onRetry()})),S.Vb()}}function je(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"j-letters-group",1),S.ic("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Wb(2,"j-letters-group",2),S.ic("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Rc(3,Fe,1,0,"j-empty-placeholder",3),S.Rc(4,De,1,0,"j-error-placeholder",4),S.Tb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("list",t.onSignForMeList)("highlighted",t.highlighted)("isSignable",!0)("isSelectable",!0)("isDeletable",!0),S.Ab(1),S.uc("list",t.onSignForOthersList)("highlighted",t.highlighted)("title",t.mapTranslate("OTHERS_FOR_SIGN"))("isDeletable",!0),S.Ab(1),S.uc("ngIf",0===t.onSignForMeList.length&&0===t.onSignForOthersList.length&&!t.errorText),S.Ab(1),S.uc("ngIf",t.errorText)}}function Ne(t,e){1&t&&(S.Ub(0),S.Rb(1,"j-letters-loading"),S.Rb(2,"j-letters-loading",7),S.Tb()),2&t&&(S.Ab(2),S.uc("hasTitle",!0))}let Pe=(()=>{class t{constructor(t,e,i){this.lettersService=t,this.navService=e,this.companyService=i,this.retrieved=new S.n,this.detailsShown=new S.n,this.isLoading=!0,this.onSignForMeList=[],this.onSignForOthersList=[],this.lettersSearch={incoming:!1,statusCode:[Lt.g.ON_SIGN],pageSize:1e5},this.errorText=null,this.subscription=new J.a,this.subscription.add(this.companyService.refresh$.subscribe(t=>{const[e,i,n]=t;n&&this.retrieveLetters()}))}ngOnDestroy(){this.subscription.unsubscribe()}mapTranslate(t){return`LETTERS.LIST.${t}`}onDetailsShown(t){this.detailsShown.emit(t)}onRetry(){this.retrieveLetters()}retrieveLetters(){return Object(T.a)(this,void 0,void 0,(function*(){this.errorText=null,this.navService.retrieveLetterBadges();try{yield Promise.all([this.retrieveOnSignForMe(),this.retrieveOnSignForOthers()]),this.onSignForMeList.length>0?this.onSignForMeList[0].hasTour=!0:this.onSignForOthersList.length>0&&(this.onSignForOthersList[0].hasTour=!0),this.retrieved.emit({onSignForMe:this.onSignForMeList.length,onSignForOthers:this.onSignForOthersList.length})}catch(t){this.errorText=t.description||t}finally{this.isLoading=!1}}))}retrieveOnSignForMe(){return Object(T.a)(this,void 0,void 0,(function*(){const t=yield this.lettersService.getList(Object.assign(Object.assign({},this.lettersSearch),{onSignForMe:!0}));this.onSignForMeList=t.items}))}retrieveOnSignForOthers(){return Object(T.a)(this,void 0,void 0,(function*(){const t=yield this.lettersService.getList(Object.assign(Object.assign({},this.lettersSearch),{onSignForOthers:!0}));this.onSignForOthersList=t.items}))}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(R),S.Qb(qt.a),S.Qb(A.a))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-on-sign"]],inputs:{highlighted:"highlighted"},outputs:{retrieved:"retrieved",detailsShown:"detailsShown"},decls:2,vars:2,consts:[[4,"ngIf"],[3,"list","highlighted","isSignable","isSelectable","isDeletable","detailsShown"],[1,"d-block","pt-3",3,"list","highlighted","title","isDeletable","detailsShown"],["class","bg-white","label","LETTERS.EMPTY.FOR_SIGN",4,"ngIf"],["class","bg-white",3,"retried",4,"ngIf"],["label","LETTERS.EMPTY.FOR_SIGN",1,"bg-white"],[1,"bg-white",3,"retried"],[3,"hasTitle"]],template:function(t,e){1&t&&(S.Rc(0,je,5,11,"ng-container",0),S.Rc(1,Ne,3,1,"ng-container",0)),2&t&&(S.uc("ngIf",!e.isLoading),S.Ab(1),S.uc("ngIf",e.isLoading))},directives:[n.u,Oe,Ee.a,Ae.a,xe],styles:[""]}),t})();var Ve=i("y5b2"),ke=i("jZlK"),Me=i("u+5l");function We(t,e){if(1&t){const t=S.Xb();S.Wb(0,"button",5),S.ic("click",(function(e){return S.Ic(t),S.mc(2).onClearPeriod()})),S.nc(1,"translate"),S.Vb()}2&t&&S.uc("ngbTooltip",S.oc(1,1,"SHARED.CLEAR"))}function Be(t,e){if(1&t){const t=S.Xb();S.Wb(0,"section",2),S.Wb(1,"j-filter-period-dropdown",3),S.ic("submitted",(function(e){return S.Ic(t),S.mc().onFilter(e)})),S.Vb(),S.Rc(2,We,2,3,"button",4),S.Vb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("hasClearButton",!1),S.Ab(1),S.uc("ngIf",t.currentDates)}}function Ue(t,e){if(1&t&&(S.Wb(0,"div",10),S.Tc(1),S.nc(2,"translate"),S.Vb()),2&t){const t=S.mc(2);S.Ab(1),S.Vc(" ",S.oc(2,1,t.mapTranslate("ALL_LOADED"))," ")}}function Qe(t,e){if(1&t&&S.Rb(0,"j-empty-placeholder",11),2&t){const t=S.mc(2);S.uc("label",t.currentDates?t.emptyNotFound:t.emptyLabel)}}function Ge(t,e){if(1&t){const t=S.Xb();S.Wb(0,"j-error-placeholder",12),S.ic("retried",(function(e){return S.Ic(t),S.mc(2).onRetry()})),S.Vb()}}function $e(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"j-letters-group",6),S.ic("scrolled",(function(e){return S.Ic(t),S.mc().onScroll()}))("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Rc(2,Ue,3,3,"div",7),S.Rc(3,Qe,1,1,"j-empty-placeholder",8),S.Rc(4,Ge,1,0,"j-error-placeholder",9),S.Tb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("list",t.list)("isSignable",t.isSignable)("isSelectable",t.isSelectable)("highlighted",t.highlighted)("isDeletable",t.isDeletable),S.Ab(1),S.uc("ngIf",!t.hasMorePages&&t.list.length>0),S.Ab(1),S.uc("ngIf",0===t.list.length&&!t.errorText),S.Ab(1),S.uc("ngIf",t.errorText)}}function Xe(t,e){1&t&&(S.Ub(0),S.Rb(1,"j-letters-loading"),S.Tb())}let ze=(()=>{class t{constructor(t,e,i,n){this.lettersService=t,this.companyService=e,this.navService=i,this.filterService=n,this.isLoading=!0,this.hasMorePages=!0,this.list=[],this.emptyNotFound="LETTERS.EMPTY.NOT_FOUND",this.emptyLabel="LETTERS.EMPTY.DEFAULT",this.isSelectable=!1,this.isSignable=!1,this.isDeletable=!1,this.hasDateFilter=!1,this.retrieved=new S.n,this.detailsShown=new S.n,this.page=1,this.pageSize=10,this.currentDates=null,this.errorText=null,this.subscription=new J.a}ngOnInit(){this.filterService.updatePeriod(Ve.e.NONE),this.subscription.add(this.companyService.refresh$.subscribe(t=>{const[e,i,n]=t;n&&this.onClearPeriod()}))}ngOnDestroy(){this.subscription.unsubscribe()}onRetry(){this.retrieveLetters({page:1})}onFilter(t){this.currentDates=t,this.retrieveLetters({page:1,dateFrom:t.from,dateTo:t.to})}onClearPeriod(){this.currentDates=null,this.filterService.updatePeriod(Ve.e.NONE),this.retrieveLetters({page:1})}onScroll(){!this.isLoading&&this.hasMorePages&&this.retrieveLetters({page:++this.page})}onDetailsShown(t){this.detailsShown.emit(t)}mapTranslate(t){return`LETTERS.LIST.${t}`}retrieveLetters(t){return Object(T.a)(this,void 0,void 0,(function*(){this.isLoading=!0,this.errorText=null;try{let e=Object.assign(Object.assign(Object.assign({},this.listParams),t),{pageSize:this.pageSize});const i=yield this.lettersService.getList(e);this.hasMorePages=i.totalCount>t.page*this.pageSize,this.page=t.page,this.list=t.page>1?[...this.list,...i.items]:i.items,this.list.length>0&&(this.list[0].hasTour=!0),this.retrieved.emit(this.list.length),this.navService.retrieveLetterBadges()}catch(e){this.errorText=e.description||e}finally{this.isLoading=!1}}))}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(R),S.Qb(A.a),S.Qb(qt.a),S.Qb(ke.a))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-list-base"]],inputs:{emptyNotFound:"emptyNotFound",emptyLabel:"emptyLabel",highlighted:"highlighted",listParams:"listParams",isSelectable:"isSelectable",isSignable:"isSignable",isDeletable:"isDeletable",hasDateFilter:"hasDateFilter"},outputs:{retrieved:"retrieved",detailsShown:"detailsShown"},decls:3,vars:3,consts:[["class","j-list__filter letters__inbox-filter",4,"ngIf"],[4,"ngIf"],[1,"j-list__filter","letters__inbox-filter"],["placement","left-top",3,"hasClearButton","submitted"],["class","letters__clear","tooltipClass","tooltip-light","inlineSVG","/assets/icons/tags-remove.svg",3,"ngbTooltip","click",4,"ngIf"],["tooltipClass","tooltip-light","inlineSVG","/assets/icons/tags-remove.svg",1,"letters__clear",3,"ngbTooltip","click"],[3,"list","isSignable","isSelectable","highlighted","isDeletable","scrolled","detailsShown"],["class","bg-white text-center text-muted py-5 p3",4,"ngIf"],["class","bg-white",3,"label",4,"ngIf"],["class","bg-white",3,"retried",4,"ngIf"],[1,"bg-white","text-center","text-muted","py-5","p3"],[1,"bg-white",3,"label"],[1,"bg-white",3,"retried"]],template:function(t,e){1&t&&(S.Rc(0,Be,3,2,"section",0),S.Rc(1,$e,5,8,"ng-container",1),S.Rc(2,Xe,2,0,"ng-container",1)),2&t&&(S.uc("ngIf",e.hasDateFilter),S.Ab(1),S.uc("ngIf",!e.isLoading||e.page>1),S.Ab(1),S.uc("ngIf",e.isLoading))},directives:[n.u,Me.a,F.a,ot.E,Oe,Ee.a,Ae.a,xe],pipes:[L.d],styles:[".letters__inbox-filter[_ngcontent-%COMP%]{text-align:right;-webkit-box-align:center;align-items:center;display:-webkit-box;display:flex;-webkit-box-pack:end;justify-content:flex-end;height:83px}.letters__inbox-filter[_ngcontent-%COMP%]   j-filter-period-dropdown[_ngcontent-%COMP%]{display:inline-block}.letters__clear[_ngcontent-%COMP%]{display:inline-block;font-weight:400;color:#1a1c1f;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;width:24px;height:24px;padding:0;margin-left:8px;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}"]}),t})();function Ye(t,e){if(1&t){const t=S.Xb();S.Wb(0,"div",2),S.Wb(1,"j-statuses",3),S.ic("selected",(function(e){return S.Ic(t),S.mc().onStatusSelect(e)})),S.Vb(),S.Vb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("statuses",t.statuses)}}function He(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"j-letters-on-sign",4),S.ic("retrieved",(function(e){return S.Ic(t),S.mc().onSignableRetrieved(e)}))("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Tb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("highlighted",t.highlighted)}}function Ke(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"j-letters-list-base",5),S.ic("retrieved",(function(e){return S.Ic(t),S.mc().onSentRetrieved(e)}))("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Tb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("listParams",t.sentParams)("highlighted",t.highlighted)}}let Ze=(()=>{class t{constructor(t,e,i,n,s,r){this.router=t,this.route=e,this.lettersService=i,this.navService=n,this.companyService=s,this.tourService=r,this.detailsShown=new S.n,this.statuses=[{label:this.mapTranslate("ON_SIGN"),value:h.ON_SIGN,count:null,isSelected:!0,isDisabled:!1},{label:this.mapTranslate("SENT"),value:h.SENT,count:0,isSelected:!1,isDisabled:!1}],this.sentParams={incoming:!1,statusCode:[Lt.g.SENT,Lt.g.READY_TO_SEND]},this.outboxStatus=this.statuses[0].value,this.LETTER_OUTBOX_STATUS=h,this.isOnSignHidden=!1,this.subscription=new J.a,this.subscription.add(Object(st.a)([this.route.data,this.companyService.getAuthorizedPersons().pipe(Object(be.a)((t,e)=>Object(de.a)([])))]).subscribe(t=>{const[e,i]=t;this.isOnSignHidden=!!i&&this.companyService.hasOnlyPrimaryAuthorities(i)&&this.companyService.isSingleSignScheme(),this.isOnSignHidden&&e.status===h.ON_SIGN?this.router.navigate(["sent"],{relativeTo:this.route.parent}):(this.onInit(e.status),this.lettersService.lastLettersListPath$.next(e.lastPath))}));const o=this.navService.getLetterBadges().subscribe(t=>{const{onSignForMe:e,onSignForOthers:i}=t,n=e>0;Object.assign(this.statuses.find(t=>t.value===h.ON_SIGN),{count:n?e:i,classList:n?"badge-primary":"badge-light"})});this.subscription.add(o)}ngOnDestroy(){this.subscription.unsubscribe()}onSignableRetrieved(t){}onSentRetrieved(t){}onDetailsShown(t){this.detailsShown.emit(t)}onInit(t=h.ON_SIGN){this.outboxStatus=t,this.statuses=this.statuses.map(e=>Object.assign(Object.assign({},e),{isSelected:e.value===t}))}onStatusSelect(t){let e="";switch(t){case h.ON_SIGN:e="on-sign";break;case h.SENT:e="sent"}this.router.navigate([e],{relativeTo:this.route.parent})}mapTranslate(t){return`LETTERS.STATUSES.${t}`}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(b.c),S.Qb(b.a),S.Qb(R),S.Qb(qt.a),S.Qb(A.a),S.Qb(w.g))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-outbox"]],inputs:{highlighted:"highlighted"},outputs:{detailsShown:"detailsShown"},decls:3,vars:3,consts:[["class","j-list__filter",4,"ngIf"],[4,"ngIf"],[1,"j-list__filter"],["jTour","LETTERS.STATUSES","jTourPosition","bottom",3,"statuses","selected"],[3,"highlighted","retrieved","detailsShown"],["emptyLabel","LETTERS.EMPTY.OUTBOX",3,"listParams","highlighted","retrieved","detailsShown"]],template:function(t,e){1&t&&(S.Rc(0,Ye,2,1,"div",0),S.Rc(1,He,2,1,"ng-container",1),S.Rc(2,Ke,2,2,"ng-container",1)),2&t&&(S.uc("ngIf",!e.isOnSignHidden),S.Ab(1),S.uc("ngIf",e.outboxStatus===e.LETTER_OUTBOX_STATUS.ON_SIGN&&!e.isOnSignHidden),S.Ab(1),S.uc("ngIf",e.outboxStatus===e.LETTER_OUTBOX_STATUS.SENT))},directives:[n.u,ue.a,se.a,Pe,ze],styles:[""]}),t})();const Je=["lettersAside"];function qe(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"j-letters-outbox",12),S.ic("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Tb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("highlighted",t.highlighted)}}function ti(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"j-letters-list-base",13),S.ic("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Tb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("listParams",t.inboxParams)("highlighted",t.highlighted)("hasDateFilter",!0)}}function ei(t,e){if(1&t){const t=S.Xb();S.Ub(0),S.Wb(1,"j-letters-list-base",14),S.ic("detailsShown",(function(e){return S.Ic(t),S.mc().onDetailsShown(e)})),S.Vb(),S.Tb()}if(2&t){const t=S.mc();S.Ab(1),S.uc("listParams",t.draftsParams)("isSelectable",!0)("highlighted",t.highlighted)("isDeletable",!0)}}let ii=(()=>{class t{constructor(t,e,i){this.route=t,this.navService=e,this.lettersService=i,this.LETTERS_CATEGORY=u,this.subscription=new J.a,this.inboxParams={incoming:!0},this.draftsParams={statusCode:[Lt.g.DRAFT]};const n=Object(st.a)([this.route.paramMap.pipe(Object(Ct.a)(()=>window.history.state)),this.route.data]).subscribe(t=>{const[e,i]=t;this.lettersCategory=i.category,this.lettersService.lastLettersListPath$.next(i.lastPath),e.highlighted&&(this.highlighted=e.highlighted)});this.subscription.add(n)}ngOnDestroy(){this.subscription.unsubscribe()}onDetailsShown(t){this.lettersAside.showDetails(t)}onCreateShown(){this.lettersAside.showCreate()}onAsideClose(){this.navService.retrieveLetterBadges()}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(b.a),S.Qb(qt.a),S.Qb(R))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters-list"]],viewQuery:function(t,e){var i;1&t&&S.Yc(Je,!0),2&t&&S.Ec(i=S.jc())&&(e.lettersAside=i.first)},decls:19,vars:4,consts:[[1,"row"],[1,"col-lg-10","offset-lg-1","col-xl-8","offset-xl-2"],[1,"j-page"],["translate","",1,"d-none","d-lg-block","j-page__title"],[1,"j-page__body"],[1,"j-list"],[1,"j-list__nav"],[3,"createShown"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"closed"],["lettersAside",""],[3,"highlighted","detailsShown"],["emptyLabel","LETTERS.EMPTY.INBOX",3,"listParams","highlighted","hasDateFilter","detailsShown"],["emptyLabel","LETTERS.EMPTY.DRAFTS",3,"listParams","isSelectable","highlighted","isDeletable","detailsShown"]],template:function(t,e){1&t&&(S.Wb(0,"j-layout-home"),S.Wb(1,"j-aside"),S.Rb(2,"j-nav-main"),S.Vb(),S.Wb(3,"j-main"),S.Wb(4,"section",0),S.Wb(5,"section",1),S.Wb(6,"section",2),S.Wb(7,"h2",3),S.Tc(8,"LETTERS.TITLE"),S.Vb(),S.Wb(9,"section",4),S.Wb(10,"section",5),S.Wb(11,"div",6),S.Wb(12,"j-letters-nav",7),S.ic("createShown",(function(t){return e.onCreateShown()})),S.Vb(),S.Vb(),S.Ub(13,8),S.Rc(14,qe,2,1,"ng-container",9),S.Rc(15,ti,2,3,"ng-container",9),S.Rc(16,ei,2,4,"ng-container",9),S.Tb(),S.Vb(),S.Vb(),S.Vb(),S.Vb(),S.Vb(),S.Wb(17,"j-letters-aside",10,11),S.ic("closed",(function(t){return e.onAsideClose()})),S.Vb(),S.Vb(),S.Vb()),2&t&&(S.Ab(13),S.uc("ngSwitch",e.lettersCategory),S.Ab(1),S.uc("ngSwitchCase",e.LETTERS_CATEGORY.OUTBOX),S.Ab(1),S.uc("ngSwitchCase",e.LETTERS_CATEGORY.INBOX),S.Ab(1),S.uc("ngSwitchCase",e.LETTERS_CATEGORY.DRAFTS))},directives:[te.a,ee.a,ie.a,ne.a,L.a,le,n.y,n.z,Ot,Ze,ze],styles:[".letters__body[_ngcontent-%COMP%]{box-shadow:0 0 1px rgba(0,0,0,.04),0 0 2px rgba(0,0,0,.06),0 4px 8px rgba(0,0,0,.04);border-radius:.5rem}.letters__page-title[_ngcontent-%COMP%]{margin-top:40px;margin-bottom:40px}.letters__header[_ngcontent-%COMP%]{padding:20px 1rem;display:none}@media(min-width:960px){.letters__header[_ngcontent-%COMP%]{display:grid}}"]}),t})();var ni=i("4wRv");const si=[{path:"",component:(()=>{class t{constructor(t){this.featureFlagsService=t,this.subscription=new J.a}ngOnInit(){this.subscription.add(this.featureFlagsService.featureFlags$.subscribe(t=>{this.featureFlagsService.checkFeatureRoute(ni.a.LETTER)}))}ngOnDestroy(){this.subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(S.Qb(ni.b))},t.\u0275cmp=S.Kb({type:t,selectors:[["j-letters"]],decls:1,vars:0,template:function(t,e){1&t&&S.Rb(0,"router-outlet")},directives:[b.h],styles:[".letters__body[_ngcontent-%COMP%]{box-shadow:0 0 1px rgba(0,0,0,.04),0 0 2px rgba(0,0,0,.06),0 4px 8px rgba(0,0,0,.04);border-radius:.5rem}.letters__page-title[_ngcontent-%COMP%]{margin-top:40px;margin-bottom:40px}.letters__header[_ngcontent-%COMP%]{padding:20px 1rem;display:none}@media(min-width:960px){.letters__header[_ngcontent-%COMP%]{display:grid}}"]}),t})(),data:{title:"CONTRACTS.TITLE"},children:[{path:"outbox",children:[{path:"on-sign",component:ii,data:{category:u.OUTBOX,status:h.ON_SIGN,lastPath:"outbox/on-sign",isOutbox:!0}},{path:"sent",component:ii,data:{category:u.OUTBOX,status:h.SENT,lastPath:"outbox/sent",isOutbox:!0}},{path:"**",redirectTo:"on-sign"}]},{path:"inbox",component:ii,data:{category:u.INBOX,lastPath:"inbox"}},{path:"drafts",component:ii,data:{category:u.DRAFTS,lastPath:"drafts"}},{path:"create",component:Jt},{path:"edit/:id",component:Jt},{path:"**",redirectTo:"outbox"}]},{path:"**",redirectTo:""}];let ri=(()=>{class t{}return t.\u0275mod=S.Ob({type:t}),t.\u0275inj=S.Nb({factory:function(e){return new(e||t)},imports:[[b.g.forChild(si)],b.g]}),t})();i("LJJp"),i.d(e,"LettersModule",(function(){return ci}));const oi=[n.c,s.n,s.D,r.b,c.c,o.b,a.a,l.a,d.a,ri];let ci=(()=>{class t{}return t.\u0275mod=S.Ob({type:t}),t.\u0275inj=S.Nb({factory:function(e){return new(e||t)},imports:[[oi]]}),t})()}}]);