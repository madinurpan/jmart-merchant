(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{KlkT:function(t,e,o){"use strict";o.r(e);var n=o("ofXK"),i=o("3Pt+"),c=o("xJkR"),r=o("tmjD"),a=o("PCNd"),l=o("YMfE"),s=o("fXoL");let b=(()=>{class t{}return t.\u0275mod=s.Ob({type:t}),t.\u0275inj=s.Nb({factory:function(e){return new(e||t)},imports:[[n.c]]}),t})();var u=o("tyNb"),d=o("mrSG"),p=o("2Vo4"),m=o("quSY"),h=o("itXk"),f=o("XNiG"),g=o("l5mm"),y=o("3E0/"),v=o("zP0r"),R=o("pLZG"),E=o("lJxs"),j=o("/uUt"),T=o("vkgz"),x=o("JX91"),O=o("1G5W"),k=o("IzEk");class S{constructor(t){this.removing$=new p.a(void 0),this.destroy$=new f.a,this.id=t.id,this.data=t}destroy(){this.destroy$.next(Date.now()),this.destroy$.complete(),this.removing$.complete(),this.cancelRemove$&&this.cancelRemove$.complete(),this.deleteWith=void 0}}var A=o("LRne"),w=o("EY2u"),V=o("Kj3r"),C=o("eIep"),I=o("+/Tu"),W=o("eEJz"),P=o("SMdK"),D=o("1kSV"),M=o("B1Ao"),$=o("mR7B"),Y=o("Eajh"),_=o("0mgW"),L=o("sYmb"),F=o("e8Ap"),N=o("4oqK"),G=o("QfCG"),U=o("2aJj"),B=o("13E/"),H=o("SfXN"),K=o("M6pS"),Q=o("jRXw"),X=o("zN9f"),q=o("oa9T"),z=o("zOyH"),J=o("jMpN"),Z=o("Ya7Z"),tt=o("Kx0l"),et=o("ScFe");const ot=["formDirective"];function nt(t,e){if(1&t){const t=s.Xb();s.Wb(0,"button",27),s.ic("click",(function(e){return s.Ic(t),s.mc().onDelete()})),s.Rb(1,"i",28),s.nc(2,"svgPath"),s.Vb()}2&t&&(s.Ab(1),s.uc("inlineSVG",s.oc(2,1,"bucket")))}function it(t,e){if(1&t){const t=s.Xb();s.Wb(0,"div",35),s.Wb(1,"button",36),s.ic("click",(function(e){s.Ic(t);const o=s.mc().index;return s.mc().deleteAccount(o)})),s.Rb(2,"i",28),s.nc(3,"svgPath"),s.Vb(),s.Vb()}2&t&&(s.Ab(2),s.uc("inlineSVG",s.oc(3,1,"bucket")))}function ct(t,e){if(1&t&&(s.Wb(0,"div",29),s.Wb(1,"div",30),s.Wb(2,"div",31),s.Wb(3,"j-form-field"),s.Rb(4,"j-entity-logo",32),s.nc(5,"bankFromAccount"),s.Wb(6,"j-label"),s.Tc(7),s.nc(8,"translate"),s.Vb(),s.Rb(9,"input",33),s.Rb(10,"j-error",13),s.Vb(),s.Vb(),s.Rc(11,it,4,3,"div",34),s.Vb(),s.Vb()),2&t){const t=e.index,o=s.mc();s.Ab(4),s.uc("name",s.oc(5,9,"KZ"+o.fGroup.get("accounts").controls[t].value)),s.Ab(3),s.Uc(s.oc(8,11,"COUNTERPARTY.IBAN")),s.Ab(2),s.uc("jShadow",o.masks.bankAccount.shadow)("dropSpecialCharacters",!0)("mask",o.masks.bankAccount.mask)("formControl",o.fGroup.get("accounts").controls[t]),s.Ab(1),s.uc("control",o.fGroup.get("accounts").controls[t])("errorMessages",o.errors.bankAccount),s.Ab(1),s.uc("ngIf",t)}}function rt(t,e){if(1&t&&(s.Wb(0,"div",37),s.Tc(1),s.Vb()),2&t){const t=s.mc();s.Ab(1),s.Vc(" ",t.errorText," ")}}function at(t,e){1&t&&s.Rb(0,"j-kbe-info")}var lt=function(t){return t.create="create",t.delete="delete",t.update="update",t}({});let st=(()=>{class t{constructor(t,e,o,n,i,c){this.modal=t,this.recipients=e,this.maskService=o,this.fb=n,this.bankFromAccount=i,this.paymentsService=c,this.checkingCounterParty$=new p.a(void 0),this.updateInProgress$=new p.a(void 0),this.masks={},this.errors=P.b,this.subs=new m.a}ngOnInit(){if(this.getMaskConfig(),this.fGroup=this.createForm(this.item),!this.editMode){const{iinOrBin:t}=this.fGroup.controls;this.subs.add(t.valueChanges.pipe(Object(V.a)(200),Object(C.a)(e=>t.valid?(this.checkingCounterParty$.next(e),Object(A.a)(this.recipients.checkCounterParty(e)).pipe(Object(O.a)(t.valueChanges))):(this.checkingCounterParty$.next(null),w.a))).subscribe(t=>{t&&this.checkingCounterParty$.getValue()===t.bin&&(this.fGroup.patchValue({name:t.name}),this.checkingCounterParty$.next(null)),this.checkingCounterParty$.next(null)}))}}get editMode(){var t;return null===(t=this.item)||void 0===t?void 0:t.id}createForm(t){var e,o,n,c,r;return this.fb.group({iinOrBin:[{value:(null===(e=t)||void 0===e?void 0:e.iinOrBin)||"",disabled:this.editMode},[i.H.required,i.H.minLength(12)]],kbeCode:[null===(n=null===(o=t)||void 0===o?void 0:o.kbe)||void 0===n?void 0:n.code,[i.H.required,P.a.kbe]],name:[(null===(c=t)||void 0===c?void 0:c.name)||"",[i.H.required,i.H.maxLength(250)]],accounts:this.fb.array(((null===(r=t)||void 0===r?void 0:r.accounts)||[{iban:""}]).map(t=>this.getAccountControlConfig(t)))})}addAccount(){this.updateInProgress$.getValue()||this.fGroup.controls.accounts.push(this.fb.control("",this.getAccountControlConfig()[1]))}deleteAccount(t){this.updateInProgress$.getValue()||this.fGroup.controls.accounts.removeAt(t)}onCancel(){this.updateInProgress$.getValue()||this.modal.close()}onSubmit(){if(this.updateInProgress$.getValue())return;if(this.fGroup.invalid)return void this.emulateSubmit();const t=this.prepareBody();this.processRequest(t)}onDelete(){this.modal.close({payload:this.item,type:lt.delete})}getAccountControlConfig(t={}){return[t.iban,[i.H.required,t=>this.paymentsService.bankExist(Object(l.ibanPrefix)(t.value||"",I.a.KZT))]]}getMaskConfig(){Object.entries({iinOrBin:"iin",bankAccount:"tengeAccount",kbeCode:"kbe"}).forEach(([t,e])=>this.masks[t]=this.maskService.getConfig(e))}emulateSubmit(){this.form.submitted=!0,this.form.ngSubmit.emit(),this.fGroup.markAllAsTouched()}prepareBody(){let t={};const e=this.fGroup.controls.accounts.value;let o=Object(l.getGroupRawValue)(this.fGroup);o.kbe={code:o.kbeCode,name:""},delete o.kbeCode,this.editMode&&(t=this.item.accounts.reduce((t,e)=>(t[e.iban]=e,t),{}),o=Object.assign(Object.assign({},this.item),o));const n=e.map(e=>{const o=Object(l.ibanPrefix)(e,I.a.KZT);let n=t[o];return n||(n={bic:this.bankFromAccount.transform(o),iban:o}),n});return o.accounts=n,o}processRequest(t){return Object(d.a)(this,void 0,void 0,(function*(){try{let e,o;this.updateInProgress$.next(!0),this.editMode?(e=yield this.recipients.updateRecipient(t),o=lt.update):(e=yield this.recipients.createRecipient(t),o=lt.create),this.modal.close({payload:e,type:o})}catch(e){this.updateInProgress$.next(!1),this.errorText=e&&e.description||JSON.stringify(e)}}))}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(D.a),s.Qb(M.a),s.Qb($.a),s.Qb(l.FormBuilderTypeSafe),s.Qb(Y.a),s.Qb(_.c))},t.\u0275cmp=s.Kb({type:t,selectors:[["j-edit-counterparty"]],viewQuery:function(t,e){var o;1&t&&s.Yc(ot,!0),2&t&&s.Ec(o=s.jc())&&(e.form=o.first)},inputs:{item:"item"},features:[s.zb([{provide:W.a,useClass:W.b}])],decls:55,vars:61,consts:[[1,"modal-header"],["translate",""],["type","button",1,"modal-back","mr-3","btn","btn-outline-primary","btn-sm","p-0",3,"click"],[3,"inlineSVG"],["class","edit-counterparty--delete btn btn-link btn-link-light-gray btn-as-text float-right mt-2",3,"click",4,"ngIf"],[1,"modal-body"],[1,"scrolled"],[1,"scrolled--content",3,"formGroup"],["formDirective","ngForm"],[1,"form-group"],["clearable","true"],["type","text","jFormInput","",1,"form-control",3,"dropSpecialCharacters","jShadow","mask","formControl"],["jSuffix","",1,"counterParty","p3",3,"jLoading","jLoadingInverted"],[3,"control","errorMessages"],[1,"row"],[1,"form-group","col-8","pr-2"],["type","text","jFormInput","",1,"form-control",3,"formControl"],[1,"form-group","col-4","pl-2"],["type","text","jFormInput","",1,"form-control",3,"mask","jShadow","dropSpecialCharacters","formControl"],["type","button","jSuffix","","tooltipClass","tooltip-light tooltip-large","container","body",1,"btn-link-gray","btn","btn-link","btn-as-text",3,"ngbTooltip","inlineSVG"],["formArrayName","accounts",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-link","text-info","p-0","ml-auto",3,"disabled","click"],["class","alert alert-danger","translate","",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"disabled","click"],["type","submit",1,"btn","btn-primary",3,"disabled","jLoading","click"],["kbeInfo",""],[1,"edit-counterparty--delete","btn","btn-link","btn-link-light-gray","btn-as-text","float-right","mt-2",3,"click"],[1,"d-inline",3,"inlineSVG"],["formArrayName","accounts"],[1,"row","form-group"],[1,"col"],["jPrefix","","hideEmpty","true",3,"name"],["type","text","jFormInput","","jReplaceOnPaste","KZ","jDynamicPrefix","KZ","jUppercase","",1,"form-control",3,"jShadow","dropSpecialCharacters","mask","formControl"],["class","col d-flex flex-grow-0 text-center",4,"ngIf"],[1,"col","d-flex","flex-grow-0","text-center"],[1,"btn","btn-link","btn-link-light-gray","btn-as-text","float-right",3,"click"],["translate","",1,"alert","alert-danger"]],template:function(t,e){if(1&t&&(s.Wb(0,"div",0),s.Wb(1,"h4",1),s.Wb(2,"button",2),s.ic("click",(function(t){return e.onCancel()})),s.Rb(3,"i",3),s.nc(4,"svgPath"),s.Vb(),s.Tc(5),s.Vb(),s.Rc(6,nt,3,3,"button",4),s.Vb(),s.Wb(7,"div",5),s.Wb(8,"div",6),s.Wb(9,"form",7,8),s.Wb(11,"div",9),s.Wb(12,"j-form-field",10),s.Wb(13,"j-label"),s.Tc(14),s.nc(15,"translate"),s.Vb(),s.Rb(16,"input",11),s.Rb(17,"div",12),s.nc(18,"async"),s.Rb(19,"j-error",13),s.Vb(),s.Vb(),s.Wb(20,"div",14),s.Wb(21,"div",15),s.Wb(22,"j-form-field",10),s.Wb(23,"j-label"),s.Tc(24),s.nc(25,"translate"),s.Vb(),s.Rb(26,"input",16),s.Rb(27,"div",12),s.nc(28,"async"),s.Vb(),s.Vb(),s.Wb(29,"div",17),s.Wb(30,"j-form-field",10),s.Wb(31,"j-label"),s.Tc(32),s.nc(33,"translate"),s.Vb(),s.Rb(34,"input",18),s.Rb(35,"button",19),s.Rb(36,"j-error",13),s.Vb(),s.Vb(),s.Vb(),s.Rc(37,ct,12,13,"div",20),s.Vb(),s.Vb(),s.Wb(38,"button",21),s.ic("click",(function(t){return e.addAccount()})),s.nc(39,"async"),s.Tc(40),s.nc(41,"translate"),s.Vb(),s.Rc(42,rt,2,1,"div",22),s.Vb(),s.Wb(43,"div",23),s.Wb(44,"button",24),s.ic("click",(function(t){return e.onCancel()})),s.nc(45,"async"),s.Tc(46),s.nc(47,"translate"),s.Vb(),s.Wb(48,"button",25),s.ic("click",(function(t){return e.onSubmit()})),s.nc(49,"async"),s.nc(50,"async"),s.Tc(51),s.nc(52,"translate"),s.Vb(),s.Vb(),s.Rc(53,at,1,0,"ng-template",null,26,s.Sc)),2&t){const t=s.Fc(54);s.Ab(3),s.uc("inlineSVG",s.oc(4,35,"chevron-left")),s.Ab(2),s.Uc("COUNTERPARTY."+(e.editMode?"EDIT_COUNTERPARTY":"ADD_COUNTERPARTY")),s.Ab(1),s.uc("ngIf",e.editMode),s.Ab(3),s.uc("formGroup",e.fGroup),s.Ab(5),s.Uc(s.oc(15,37,"COUNTERPARTY.IIN")),s.Ab(2),s.uc("dropSpecialCharacters",!0)("jShadow",e.masks.iinOrBin.shadow)("mask",e.masks.iinOrBin.mask)("formControl",e.fGroup.controls.iinOrBin),s.Ab(1),s.uc("jLoading",s.oc(18,39,e.checkingCounterParty$))("jLoadingInverted",!0),s.Ab(2),s.uc("control",e.fGroup.controls.iinOrBin)("errorMessages",e.errors.iinOrBin),s.Ab(5),s.Uc(s.oc(25,41,"COUNTERPARTY.NAME")),s.Ab(2),s.uc("formControl",e.fGroup.controls.name),s.Ab(1),s.uc("jLoading",s.oc(28,43,e.checkingCounterParty$))("jLoadingInverted",!0),s.Ab(5),s.Uc(s.oc(33,45,"COUNTERPARTY.KBE")),s.Ab(2),s.uc("mask",e.masks.kbeCode.mask)("jShadow",e.masks.kbeCode.shadow)("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.kbeCode),s.Ab(1),s.uc("ngbTooltip",t)("inlineSVG","/assets/icons/payments/question.svg"),s.Ab(1),s.uc("control",e.fGroup.controls.kbeCode)("errorMessages",e.errors.kbeCode),s.Ab(1),s.uc("ngForOf",e.fGroup.get("accounts").controls),s.Ab(1),s.uc("disabled",s.oc(39,47,e.updateInProgress$)),s.Ab(2),s.Vc("+ ",s.oc(41,49,"COUNTERPARTY.ADD_ACCOUNT"),""),s.Ab(2),s.uc("ngIf",e.errorText),s.Ab(2),s.uc("disabled",s.oc(45,51,e.updateInProgress$)),s.Ab(2),s.Uc(s.oc(47,53,"SHARED.CANCEL")),s.Ab(2),s.uc("disabled",s.oc(49,55,e.updateInProgress$))("jLoading",s.oc(50,57,e.updateInProgress$)),s.Ab(3),s.Uc(s.oc(52,59,"SHARED.SAVE"))}},directives:[L.a,F.a,n.u,i.J,i.u,i.l,N.a,G.a,U.a,i.c,B.a,r.a,i.t,i.i,H.a,K.a,Q.a,D.E,n.t,i.f,X.a,q.a,z.a,J.a,Z.a,tt.a],pipes:[et.a,L.d,n.b,Y.a],styles:[".modal-body[_ngcontent-%COMP%]{padding:.25rem 1.5rem .5rem;-webkit-box-flex:1;flex-grow:1}.modal-body[_ngcontent-%COMP%]   .counterParty[_ngcontent-%COMP%]{width:3em;position:relative}.modal-footer[_ngcontent-%COMP%]{padding:.25rem 1.5rem 1rem;flex-shrink:0}.modal-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 1rem;flex-shrink:0}.scrolled[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - 280px)}j-edit-counterparty[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;max-height:calc(100vh - 80px)}"]}),t})();var bt=o("VnnJ"),ut=o("VO+5"),dt=o("3M96");let pt=(()=>{class t extends p.a{constructor(){super(null)}activate(t){this.next(t)}clearAll(){this.next(null)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),mt=(()=>{class t{constructor(t,e){this.teleport=t,this.template=e}ngOnChanges(t){const e=t.target;e&&(e.previousValue&&this.teleport.activate({[e.previousValue]:null}),e.currentValue&&this.teleport.activate({[e.currentValue]:this.template}))}ngOnDestroy(){this.target&&this.teleport.activate({[this.target]:null})}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(pt),s.Qb(s.L))},t.\u0275dir=s.Lb({type:t,selectors:[["ng-template","jPortalledTpl",""]],inputs:{target:["jPortalledTpl","target"]},features:[s.yb()]}),t})();var ht=o("C6g9"),ft=o("zdqJ"),gt=o("tepA");function yt(t,e){if(1&t&&(s.Wb(0,"p",17),s.Rb(1,"j-entity-logo",18),s.nc(2,"bankFromAccount"),s.Tc(3),s.nc(4,"bankFromAccount"),s.Vb()),2&t){const t=e.$implicit;s.Ab(1),s.uc("name",s.oc(2,2,t.iban)),s.Ab(2),s.Vc(" ",s.oc(4,4,t.iban)," ")}}function vt(t,e){if(1&t&&(s.Wb(0,"p"),s.Tc(1),s.nc(2,"formatIban"),s.Vb()),2&t){const t=e.$implicit;s.Ab(1),s.Vc(" ",s.oc(2,1,t.iban)," ")}}function Rt(t,e){if(1&t&&(s.Wb(0,"div",19),s.Sb(1,20),s.Vb()),2&t){s.mc(2);const t=s.Fc(2);s.Ab(1),s.uc("ngTemplateOutlet",t)}}function Et(t,e){if(1&t&&(s.Wb(0,"div",21),s.Sb(1,20),s.Vb()),2&t){s.mc(2);const t=s.Fc(2);s.Ab(1),s.uc("ngTemplateOutlet",t)}}function jt(t,e){if(1&t&&(s.Ub(0),s.Wb(1,"div",3),s.Wb(2,"div",4),s.Rb(3,"input",5),s.Rb(4,"label",6),s.Vb(),s.Vb(),s.Wb(5,"div",7),s.Wb(6,"p",8),s.Tc(7),s.Vb(),s.Vb(),s.Wb(8,"div",9),s.Wb(9,"p",8),s.Tc(10),s.Vb(),s.Vb(),s.Wb(11,"div",10),s.Wb(12,"p",8),s.Tc(13),s.Vb(),s.Vb(),s.Wb(14,"div",11),s.Rc(15,yt,5,6,"p",12),s.Vb(),s.Wb(16,"div",13),s.Rc(17,vt,3,3,"p",14),s.Vb(),s.Rc(18,Rt,2,1,"div",15),s.Rc(19,Et,2,1,"div",16),s.Tb()),2&t){const t=s.mc();s.Ab(3),s.uc("jSelectionRow",t.item.id),s.Bb("id",t.item.id),s.Ab(1),s.Bb("for",t.item.id),s.Ab(3),s.Uc(t.item.iinOrBin),s.Ab(3),s.Uc(t.item.name),s.Ab(3),s.Uc(t.item.kbe.code),s.Ab(2),s.uc("ngForOf",t.item.accounts),s.Ab(2),s.uc("ngForOf",t.item.accounts),s.Ab(1),s.uc("ngIf",t.row.hasTour),s.Ab(1),s.uc("ngIf",!t.row.hasTour)}}function Tt(t,e){if(1&t){const t=s.Xb();s.Wb(0,"span",22),s.Wb(1,"button",23),s.ic("click",(function(e){return s.Ic(t),s.mc().onEdit()})),s.nc(2,"translate"),s.Rb(3,"i",24),s.nc(4,"svgPath"),s.Vb(),s.Vb(),s.Wb(5,"span"),s.Wb(6,"button",25),s.ic("click",(function(e){return s.Ic(t),s.mc().onRemove()})),s.nc(7,"translate"),s.Rb(8,"i",24),s.nc(9,"svgPath"),s.Vb(),s.Vb()}2&t&&(s.Ab(1),s.uc("ngbTooltip",s.oc(2,4,"COUNTERPARTY.EDIT_COUNTERPARTY")),s.Ab(2),s.uc("inlineSVG",s.oc(4,6,"edit")),s.Ab(3),s.uc("ngbTooltip",s.oc(7,8,"COUNTERPARTY.DELETE_COUNTERPARTY")),s.Ab(2),s.uc("inlineSVG",s.oc(9,10,"bucket")))}function xt(t,e){if(1&t){const t=s.Xb();s.Wb(0,"div",26),s.Wb(1,"span",27),s.Tc(2),s.nc(3,"translate"),s.Vb(),s.Wb(4,"button",28),s.ic("click",(function(e){return s.Ic(t),s.mc().onCancelRemove()})),s.Rb(5,"i",24),s.nc(6,"svgPath"),s.Wb(7,"small",29),s.Tc(8),s.nc(9,"translate"),s.Vb(),s.Vb(),s.Vb()}if(2&t){const t=s.mc();s.Ab(2),s.Uc(s.oc(3,4,t.row.deleteWith?"COUNTERPARTY.DELETED_COUNTERPARTIES":"COUNTERPARTY.DELETED_COUNTERPARTY")),s.Ab(3),s.uc("inlineSVG",s.oc(6,6,"arrow-loop-left")),s.Ab(3),s.Wc("",s.oc(9,8,"SHARED.RETURN")," ",t.removing,"")}}let Ot=(()=>{class t{constructor(){this.remove=new s.n,this.cancelRemove=new s.n,this.edit=new s.n}ngOnInit(){}onEdit(){this.edit.emit(this.row)}onRemove(){this.remove.emit(this.row)}onCancelRemove(){this.cancelRemove.emit(this.row)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Kb({type:t,selectors:[["j-counterparty-row"]],hostAttrs:[1,"j-table--row"],inputs:{item:"item",row:"row",removing:"removing"},outputs:{remove:"remove",cancelRemove:"cancelRemove",edit:"edit"},decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["actionsTpl",""],["removingTpl",""],[1,"counterparty-list--select","p3","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"jSelectionRow"],[1,"custom-control-label"],[1,"counterparty-list--iin","p3","j-table--cell","j-table--cell_static"],[1,"m-0"],[1,"counterparty-list--name","p3","j-table--cell"],[1,"counterparty-list--kbe","p3","j-table--cell","j-table--cell_static"],[1,"counterparty-list--bank","p3","j-table--cell","j-table--cell_static"],["class","d-flex align-items-center",4,"ngFor","ngForOf"],[1,"counterparty-list--account","p3","j-table--cell","j-table--cell_static"],[4,"ngFor","ngForOf"],["jTour","DIRECTORY.ACTIONS","jTourPosition","bottom","class","counterparty-list--tools p3 j-table--cell",4,"ngIf"],["class","counterparty-list--tools p3 j-table--cell",4,"ngIf"],[1,"d-flex","align-items-center"],["size","sm",1,"mr-1",3,"name"],["jTour","DIRECTORY.ACTIONS","jTourPosition","bottom",1,"counterparty-list--tools","p3","j-table--cell"],[3,"ngTemplateOutlet"],[1,"counterparty-list--tools","p3","j-table--cell"],[1,"mr-2"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray","ml-auto",3,"ngbTooltip","click"],[3,"inlineSVG"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[1,"p3","j-table--cell","counterparty-list--removing","d-flex"],[1,"text-muted"],["type","button",1,"ml-auto","btn","btn-link","text-info","p-0",3,"click"],[1,"ml-1"]],template:function(t,e){if(1&t&&(s.Rc(0,jt,20,10,"ng-container",0),s.Rc(1,Tt,10,12,"ng-template",null,1,s.Sc),s.Rc(3,xt,10,10,"ng-template",null,2,s.Sc)),2&t){const t=s.Fc(4);s.uc("ngIf",!e.removing)("ngIfElse",t)}},directives:[n.u,ht.a,n.t,X.a,ft.a,n.B,D.E,F.a],pipes:[Y.a,gt.a,L.d,et.a],styles:[""],changeDetection:0}),t})();var kt=o("4cI0"),St=o("DHcY");const At=["contentBody"],wt=["emptyBody"],Vt=["errorBody"];function Ct(t,e){1&t&&s.Sb(0)}function It(t,e){1&t&&s.Sb(0)}function Wt(t,e){if(1&t&&(s.Wb(0,"div",13),s.Rc(1,Ct,1,0,"ng-container",14),s.Rc(2,It,1,0,"ng-container",14),s.Vb()),2&t){const t=s.mc(),e=s.Fc(10);s.Ab(1),s.uc("ngTemplateOutlet",e),s.Ab(1),s.uc("ngTemplateOutlet",t.contentTpl)}}function Pt(t,e){if(1&t){const t=s.Xb();s.Wb(0,"button",29),s.ic("click",(function(e){return s.Ic(t),s.mc(2).onRemoveSelected()})),s.nc(1,"translate"),s.Rb(2,"i",30),s.nc(3,"svgPath"),s.Vb()}2&t&&(s.uc("ngbTooltip",s.oc(1,2,"COUNTERPARTY.DELETE_COUNTERPARTIES")),s.Ab(2),s.uc("inlineSVG",s.oc(3,4,"bucket")))}function Dt(t,e){if(1&t&&(s.Wb(0,"div",15),s.Wb(1,"div",16),s.Wb(2,"div",17),s.Wb(3,"div",18),s.Rb(4,"input",19),s.Rb(5,"label",20),s.Vb(),s.Vb(),s.Wb(6,"div",21),s.Tc(7),s.nc(8,"translate"),s.Vb(),s.Wb(9,"div",22),s.Tc(10),s.nc(11,"translate"),s.Vb(),s.Wb(12,"div",23),s.Tc(13),s.nc(14,"translate"),s.Vb(),s.Wb(15,"div",24),s.Tc(16),s.nc(17,"translate"),s.Vb(),s.Wb(18,"div",25),s.Tc(19),s.nc(20,"translate"),s.Vb(),s.Wb(21,"div",26),s.Wb(22,"span",27),s.Rc(23,Pt,4,6,"button",28),s.Vb(),s.Vb(),s.Vb(),s.Vb()),2&t){const t=s.mc();s.Ab(4),s.uc("masterSelect",!0),s.Ab(3),s.Vc("",s.oc(8,7,"COUNTERPARTY.IIN")," "),s.Ab(3),s.Uc(s.oc(11,9,"COUNTERPARTY.NAME")),s.Ab(3),s.Vc("",s.oc(14,11,"COUNTERPARTY.KBE")," "),s.Ab(3),s.Vc("",s.oc(17,13,"COUNTERPARTY.BANK")," "),s.Ab(3),s.Uc(s.oc(20,15,"COUNTERPARTY.ACCOUNT_NUMBER")),s.Ab(4),s.uc("ngIf",t.selectionModel.value.length)}}function Mt(t,e){if(1&t){const t=s.Xb();s.Wb(0,"j-counterparty-row",33),s.ic("edit",(function(o){s.Ic(t);const n=e.$implicit;return s.mc(2).onEdit(n)}))("remove",(function(o){s.Ic(t);const n=e.$implicit;return s.mc(2).onRemove(n)}))("cancelRemove",(function(o){s.Ic(t);const n=e.$implicit;return s.mc(2).onCancelRemove(n)})),s.nc(1,"async"),s.Vb()}if(2&t){const t=e.$implicit;s.uc("hidden",t.hidden)("row",t)("item",t.data)("removing",s.oc(1,4,t.removing$))}}function $t(t,e){if(1&t&&(s.Wb(0,"div",31),s.Rc(1,Mt,2,6,"ng-template",32),s.nc(2,"async"),s.nc(3,"trackByProperty"),s.Vb()),2&t){const t=s.mc();s.Ab(1),s.uc("ngForOf",s.oc(2,2,t.composedRows$))("ngForTrackBy",s.oc(3,4,"id"))}}function Yt(t,e){1&t&&s.Rb(0,"j-empty-placeholder",34)}function _t(t,e){if(1&t){const t=s.Xb();s.Wb(0,"div",35),s.Wb(1,"p",36),s.Tc(2,"SHARED.LIST_LOADING_ERR_REFRESH"),s.Vb(),s.Wb(3,"button",37),s.ic("click",(function(e){return s.Ic(t),s.mc().onRefresh()})),s.Tc(4,"SHARED.REFRESH"),s.Vb(),s.Vb()}}function Lt(t,e){if(1&t){const t=s.Xb();s.Wb(0,"button",38),s.ic("click",(function(e){return s.Ic(t),s.mc().onEdit()})),s.Tc(1),s.nc(2,"translate"),s.Vb()}2&t&&(s.Ab(1),s.Vc("+ ",s.oc(2,1,"COUNTERPARTY.ADD_COUNTERPARTY"),""))}function Ft(t,e){1&t&&s.Sb(0)}function Nt(t,e){1&t&&s.Sb(0)}function Gt(t,e){if(1&t&&(s.Wb(0,"div",39),s.Rc(1,Ft,1,0,"ng-container",14),s.Rc(2,Nt,1,0,"ng-container",14),s.Vb()),2&t){s.mc();const t=s.Fc(21);s.Ab(1),s.uc("ngTemplateOutlet",t),s.Ab(1),s.uc("ngTemplateOutlet",t)}}const Ut=function(){return{width:"200px",height:"25px","background-color":"#ECEEF1"}},Bt=function(){return{height:"115px","background-color":"#ECEEF1"}};function Ht(t,e){1&t&&(s.Rb(0,"ngx-skeleton-loader",40),s.Rb(1,"ngx-skeleton-loader",40),s.Rb(2,"ngx-skeleton-loader",40)),2&t&&(s.uc("theme",s.yc(3,Ut)),s.Ab(1),s.uc("theme",s.yc(4,Bt)),s.Ab(1),s.uc("theme",s.yc(5,Bt)))}let Kt=(()=>{class t{constructor(t,e,o,n,c){this.company=t,this.recipients=e,this.modalService=o,this.notifierService=n,this.translateService=c,this.search=new i.h(""),this.rows$=new p.a([]),this.composedRows$=new p.a([]),this.loadingErrors$=new p.a(void 0),this.selectionModel=new i.h([]),this.subs=new m.a,this.isTourShown=!1}ngOnInit(){this.store=this.recipients.store,this.subs.add(this.company.currentCompany$.pipe(Object(y.a)(0),Object(v.a)(1)).subscribe(t=>{this.selectionModel.patchValue([]),this.rows$.getValue().forEach(t=>{t.cancelRemove$&&t.cancelRemove$.next(Date.now())})})),this.combineFilter(),this.watchForBodyTpl(),this.watchForItems(),this.onRefresh()}selectAll(){}ngOnDestroy(){this.subs.unsubscribe()}onEdit(t){var e;const o=this.modalService.open(st,{backdropClass:"backdrop_light",windowClass:"modal_light modal-adaptive_sm modal_max-height modal-adaptive",centered:!0,backdrop:"static"});o.componentInstance.item=null===(e=t)||void 0===e?void 0:e.data,o.result.then(e=>this.handleEditResult(e,t))}onRemoveSelected(){let t=this.selectionModel.value;t=t[t.length-1];const e=this.rows$.getValue().find(e=>e.data.id===t);e&&this.startDeleteProcess(e,!0)}onRemove(t,e){this.startDeleteProcess(t,e)}onCancelRemove(t){t.cancelRemove$&&t.cancelRemove$.next(Date.now())}onRefresh(){return Object(d.a)(this,void 0,void 0,(function*(){try{yield this.recipients.getRecipients("",!0),this.selectionModel.patchValue([]),this.loadingErrors$.next(null)}catch(t){this.rows$.next([]),this.selectionModel.patchValue([]),this.loadingErrors$.next(t)}}))}handleEditResult(t,e){t&&([lt.create,lt.update].some(e=>e===t.type)?(this.notifierService.notify("success",this.translateService.instant("COUNTERPARTY."+(lt.create===t.type?"CREATED_COUNTERPARTY":"UPDATED_COUNTERPARTY"))),this.store.upsertItem(t.payload)):this.startDeleteProcess(e))}watchForItems(){this.subs.add(Object(h.a)([this.store.items$,this.store.fetching$,this.store.fetched$]).pipe(Object(R.a)(([t,e,o])=>!e&&o),Object(E.a)(t=>t[0]),Object(j.a)(),Object(T.a)(t=>this.selectionModel.patchValue([])),Object(E.a)(t=>t.map(t=>new S(t)))).subscribe(t=>{this.rows$.next(t)}))}combineFilter(){this.subs.add(Object(h.a)([this.rows$,this.search.valueChanges.pipe(Object(x.a)(""))]).pipe(Object(E.a)(([t,e])=>{const o=t.filter(t=>!t.hidden&&this.recipients.filterRecipient(t.data,e));return o.length>0&&(o[0].hasTour=!0),o})).subscribe(this.composedRows$))}watchForBodyTpl(){this.subs.add(Object(h.a)([this.store.fetched$,this.search.valueChanges.pipe(Object(x.a)("")),this.loadingErrors$,this.composedRows$]).pipe(Object(y.a)(0),Object(E.a)(([t,e,o,n])=>o?this.errorBody:t&&!n.length?this.emptyBody:this.contentBody),Object(j.a)()).subscribe(t=>this.contentTpl=t))}startDeleteProcess(t,e){let o;if(e){const e=this.selectionModel.value.reduce((t,e)=>(t[e]=!0,t),{});delete e[t.data.id],o=this.rows$.getValue().filter(t=>e[t.data.id]),t.deleteWith=o,o.forEach(t=>t.hidden=!0)}t.cancelRemove$=new f.a,t.removing$.next("5"),this.rows$.next([...this.rows$.getValue()]);const n=Object(g.a)(1e3).pipe(Object(O.a)(t.cancelRemove$.pipe(Object(T.a)(()=>{t.removing$.next(""),t.deleteWith&&(t.deleteWith.forEach(t=>t.hidden=!1),t.deleteWith=null),t.cancelRemove$=null}))),Object(T.a)(e=>{t.removing$.next((+t.removing$.getValue()-1).toString())}),Object(k.a)(5)).subscribe({next:e=>{4===e&&this.finishRemove(t,o)},complete:()=>n.unsubscribe(),error:()=>n.unsubscribe()})}finishRemove(t,e){return Object(d.a)(this,void 0,void 0,(function*(){!t.destroy$.closed&&t.removing$.next(null);let o=[];o=e?e.map(t=>t.data.id).concat(t.data.id):[t.data.id],this.store.removeItems(o);const n=o.reduce((t,e)=>(t[e]=!0,t),{});this.selectionModel.patchValue(this.selectionModel.value.filter(t=>!n[t])),[t,...e||[]].forEach(t=>t.destroy());try{yield this.recipients.deleteRecipient(o),this.notifierService.notify("success",this.translateService.instant("COUNTERPARTY."+(o.length>1?"DELETED_COUNTERPARTIES":"DELETED_COUNTERPARTY")))}catch(i){this.notifierService.notify("error",i)}}))}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(bt.a),s.Qb(M.a),s.Qb(D.q),s.Qb(ut.c),s.Qb(L.e))},t.\u0275cmp=s.Kb({type:t,selectors:[["j-counterparties"]],viewQuery:function(t,e){var o;1&t&&(s.Yc(At,!0),s.Yc(wt,!0),s.Yc(Vt,!0)),2&t&&(s.Ec(o=s.jc())&&(e.contentBody=o.first),s.Ec(o=s.jc())&&(e.emptyBody=o.first),s.Ec(o=s.jc())&&(e.errorBody=o.first))},decls:22,vars:12,consts:[[1,"list-page--content","list-page--content_counterparties",3,"jSelectionContainer","rows"],[1,"list-page--filter"],["clearable","true"],["jPrefix","","inlineSVG","/assets/icons/search.svg",1,"text-primary","d-block","mt-n1"],["type","text","jFormInput","","autocomplete","off",1,"form-control",3,"placeholder","formControl"],["class","counterparty-list j-table",4,"ngIf","ngIfElse"],["tableHead",""],["contentBody",""],["emptyBody",""],["errorBody",""],["jPortalledTpl","DIRECTORY_TITLE"],["loading",""],["loaderPart",""],[1,"counterparty-list","j-table"],[4,"ngTemplateOutlet"],[1,"j-table--head"],[1,"j-table--row"],[1,"counterparty-list--select","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","checkboxAll","jSelectionRow","",1,"custom-control-input",3,"masterSelect"],["for","checkboxAll",1,"custom-control-label"],[1,"counterparty-list--iin","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--name","j-table--cell","p4"],[1,"counterparty-list--kbe","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--bank","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--account","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--tools","j-table--cell"],[1,"ml-auto"],["type","button","tooltipClass","tooltip-light","placement","top","class","btn btn-link btn-as-text btn-link-light-gray",3,"ngbTooltip","click",4,"ngIf"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[3,"inlineSVG"],[1,"j-table--body"],["ngFor","",3,"ngForOf","ngForTrackBy"],[3,"hidden","row","item","removing","edit","remove","cancelRemove"],["label","COUNTERPARTY.NO_COUNTERPARTIES"],[1,"text-center","pt-5"],["translate","",1,"text-gray","text-gray"],["translate","","ng-disabled","store.fetching$ | async",1,"btn","btn-link","p-1",3,"click"],["jTour","DIRECTORY.NEW","jTourPosition","bottom",1,"mt-n3","btn","btn-link","p-0",3,"click"],[1,"p-4"],[3,"theme"]],template:function(t,e){if(1&t&&(s.Wb(0,"div",0),s.nc(1,"async"),s.Wb(2,"div",1),s.Wb(3,"j-form-field",2),s.Rb(4,"span",3),s.Rb(5,"input",4),s.nc(6,"translate"),s.Vb(),s.Vb(),s.Rc(7,Wt,3,2,"div",5),s.nc(8,"async"),s.Rc(9,Dt,24,17,"ng-template",null,6,s.Sc),s.Rc(11,$t,4,6,"ng-template",null,7,s.Sc),s.Vb(),s.Rc(13,Yt,1,0,"ng-template",null,8,s.Sc),s.Rc(15,_t,5,0,"ng-template",null,9,s.Sc),s.Rc(17,Lt,3,3,"ng-template",10),s.Rc(18,Gt,3,2,"ng-template",null,11,s.Sc),s.Rc(20,Ht,3,6,"ng-template",null,12,s.Sc)),2&t){const t=s.Fc(19);s.uc("jSelectionContainer",e.selectionModel)("rows",s.oc(1,6,e.composedRows$)),s.Ab(5),s.vc("placeholder",s.oc(6,8,"FILTER.SEARCH.COUNTERPARTY")),s.uc("formControl",e.search),s.Ab(2),s.uc("ngIf",s.oc(8,10,e.store.fetched$))("ngIfElse",t)}},directives:[dt.a,N.a,q.a,F.a,U.a,i.c,i.t,i.i,n.u,mt,n.B,ht.a,D.E,n.t,Ot,kt.a,L.a,ft.a,c.a],pipes:[n.b,L.d,et.a,St.a],styles:[".counterparty-list{min-height:200px;overflow:auto}.counterparty-list .j-table--head{min-width:760px;position:-webkit-sticky;position:sticky;top:0}.counterparty-list .j-table--body{min-width:760px}.counterparty-list .counterparty-list--select{position:-webkit-sticky;position:sticky;left:0;background:#fff}.counterparty-list--select{flex-basis:50px;max-width:50px}.counterparty-list--name{flex-basis:140px}.counterparty-list--iin{flex-basis:110px}.counterparty-list--bank{flex-basis:125px}.counterparty-list--bank>p{line-height:2em;margin-bottom:0}.counterparty-list--bank>p+p{margin-top:1em}.counterparty-list--account{flex-basis:210px}.counterparty-list--account>p{margin-bottom:0;line-height:2em}.counterparty-list--account>p+p{margin-top:1em}.counterparty-list--kbe{flex-basis:40px}.counterparty-list--tools{flex-basis:64px;margin-left:auto;text-align:right;padding-top:18px;padding-bottom:18px}.counterparty-list--tools .btn+.btn{margin-left:1em}.counterparty-list--removing{background-color:#f6f7f8}@media(min-width:960px){.counterparty-list--bank{flex-basis:150px}.counterparty-list{overflow:initial}.counterparty-list .counterparty-list--select{position:static}.counterparty-list .j-table--head{min-width:none;position:static}.counterparty-list .j-table--body{min-width:none}}"],encapsulation:2}),t})();var Qt=o("Nq+r"),Xt=o("Cfvw"),qt=o("JIr8"),zt=o("kAiJ"),Jt=o("927x"),Zt=o("bqZY"),te=o("ebvF"),ee=o("CVrE"),oe=o("TaxS"),ne=o("B+58"),ie=o("Cg+c");const ce=["formDirective"];function re(t,e){if(1&t){const t=s.Xb();s.Wb(0,"button",24),s.ic("click",(function(e){return s.Ic(t),s.mc().onDelete()})),s.Rb(1,"i",25),s.nc(2,"svgPath"),s.Vb()}2&t&&(s.Ab(1),s.uc("inlineSVG",s.oc(2,1,"bucket")))}function ae(t,e){if(1&t&&(s.Wb(0,"div",26),s.Tc(1),s.Vb()),2&t){const t=s.mc();s.Ab(1),s.Vc(" ",t.errorText," ")}}var le=function(t){return t.create="create",t.delete="delete",t.update="update",t}({});let se=(()=>{class t{constructor(t,e,o,n,i,c){this.modal=t,this.employeesService=e,this.maskService=o,this.fb=n,this.paymentsService=i,this.translate=c,this.autocomplete$=new p.a(void 0),this.updateInProgress$=new p.a(void 0),this.masks={},this.errors=P.b,this.minDate=new Date(1900,0,0),this.maxDate=new Date,this.minAmount=.01,this.maxAmount=212500,this.socialSumErr=[{error:"max",message:`${this.translate.instant("ERRORS.MAX_SUM")} ${this.maxAmount}`}],this.lockChildFields=["iin","fio","birthDate"],this.subs=new m.a}ngOnInit(){if(this.getMaskConfig(),this.fGroup=this.createForm(this.item),!this.editMode){const{iin:t}=this.fGroup.controls;this.subs.add(t.valueChanges.pipe(Object(R.a)(e=>t.valid),Object(V.a)(200),Object(C.a)(e=>t.valid?(this.autocomplete$.next(e),Object(Xt.a)(this.employeesService.getNameByIin(e)).pipe(Object(E.a)(t=>({fullName:t,bin:e})),Object(O.a)(t.valueChanges),Object(qt.a)(()=>Object(A.a)(null)))):(this.autocomplete$.next(null),w.a))).subscribe(t=>{t&&this.autocomplete$.getValue()===t.bin&&this.fGroup.patchValue({fio:t.fullName}),this.autocomplete$.next(null)}))}}get isSubmitted(){return this.form.submitted}get editMode(){var t;return null===(t=this.item)||void 0===t?void 0:t.id}createForm(t={}){var e,o,n,c;const r=P.a.SafeMaxAmount(this.maxAmount),a=P.a.SafeMinAmount(this.minAmount);return this.fb.group({iin:[{value:t.iin||"",disabled:this.editMode},[i.H.required,i.H.minLength(12)]],fio:[t.fio||"",[i.H.required]],birthDate:[t.birthDate&&Object(zt.i)(t.birthDate)||"",[i.H.required]],iban:[t.iban||"",[t=>this.paymentsService.bankExist(Object(Jt.d)(t.value||"",I.a.KZT))]],ocmcSum:[null===(e=t.ocmcSum)||void 0===e?void 0:e.amount,[a,r]],pensionSum:[null===(o=t.pensionSum)||void 0===o?void 0:o.amount,[a,r]],salarySum:[null===(n=t.salarySum)||void 0===n?void 0:n.amount,[a]],socialSum:[null===(c=t.socialSum)||void 0===c?void 0:c.amount,[a,r]]})}onCancel(){this.updateInProgress$.getValue()||this.modal.close()}onSubmit(){if(this.updateInProgress$.getValue())return;if(this.fGroup.invalid)return void this.emulateSubmit();const t=this.prepareBody();this.processRequest(t)}onDelete(){this.modal.close({payload:this.item,type:le.delete})}getMaskConfig(){Object.entries({iin:"iin",iban:"tengeAccount"}).forEach(([t,e])=>this.masks[t]=this.maskService.getConfig(e))}emulateSubmit(){this.form.submitted=!0,this.form.ngSubmit.emit(),this.fGroup.markAllAsTouched()}prepareBody(){let t=Object(Jt.c)(this.fGroup);return["ocmcSum","pensionSum","salarySum","socialSum"].forEach(e=>{const o=Object(Jt.g)(t[e]);t[e]=o?{amount:o,currency:I.a.KZT}:null}),t.birthDate=Object(zt.m)(t.birthDate),t.iban=t.iban&&Object(Jt.d)(t.iban,I.a.KZT)||null,t}processRequest(t){return Object(d.a)(this,void 0,void 0,(function*(){try{let e,o;this.updateInProgress$.next(!0),this.editMode?(e=yield this.employeesService.editEmployee(t),o=le.update):(e=yield this.employeesService.createEmployee(t),o=le.create),this.modal.close({payload:e,type:o})}catch(e){this.updateInProgress$.next(!1),this.errorText=e&&e.description||JSON.stringify(e)}}))}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(D.a),s.Qb(Zt.b),s.Qb($.a),s.Qb(te.a),s.Qb(ee.g),s.Qb(L.e))},t.\u0275cmp=s.Kb({type:t,selectors:[["j-directory-edit-employee"]],viewQuery:function(t,e){var o;1&t&&s.Oc(ce,!0),2&t&&s.Ec(o=s.jc())&&(e.form=o.first)},inputs:{item:"item"},features:[s.zb([{provide:W.a,useClass:W.b}])],decls:72,vars:68,consts:[[1,"modal-header"],["translate",""],["type","button",1,"modal-back","mr-3","btn","btn-outline-primary","btn-sm","p-0",3,"click"],[3,"inlineSVG"],["class","edit-counterparty--delete btn btn-link btn-link-light-gray btn-as-text float-right mt-2",3,"click",4,"ngIf"],[1,"modal-body"],[1,"scrolled"],[1,"scrolled--content",3,"formGroup"],["formDirective","ngForm"],[1,"form-group"],["clearable","true"],["type","text","jFormInput","",1,"form-control",3,"dropSpecialCharacters","jShadow","mask","formControl"],["jSuffix","",1,"p3",3,"jLoading","jLoadingInverted"],[3,"control","errorMessages"],["type","text","jFormInput","",1,"form-control",3,"formControl"],[3,"isCalendarShown","label","hasError","formControl","minDate","maxDate"],["jPrefix","","hideEmpty","true",3,"name"],["type","text","jFormInput","","jReplaceOnPaste","KZ","jDynamicPrefix","KZ","jUppercase","",1,"form-control",3,"dropSpecialCharacters","mask","jShadow","formControl"],["accountInput","jFormInput"],["type","text","jFormInput","","jCursorBound","","jReplaceDot","","suffix"," \u20b8","mask","separator.2","thousandSeparator"," ",1,"form-control",3,"dropSpecialCharacters","formControl"],["class","alert alert-danger","translate","",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"disabled","click"],["type","submit",1,"btn","btn-primary",3,"disabled","jLoading","click"],[1,"edit-counterparty--delete","btn","btn-link","btn-link-light-gray","btn-as-text","float-right","mt-2",3,"click"],[1,"d-inline",3,"inlineSVG"],["translate","",1,"alert","alert-danger"]],template:function(t,e){1&t&&(s.Wb(0,"div",0),s.Wb(1,"h4",1),s.Wb(2,"button",2),s.ic("click",(function(t){return e.onCancel()})),s.Rb(3,"i",3),s.nc(4,"svgPath"),s.Vb(),s.Tc(5),s.Vb(),s.Rc(6,re,3,3,"button",4),s.Vb(),s.Wb(7,"div",5),s.Wb(8,"div",6),s.Wb(9,"form",7,8),s.Wb(11,"div",9),s.Wb(12,"j-form-field",10),s.Wb(13,"j-label",1),s.Tc(14,"DIRECTORY.EMPLOYEES.IIN"),s.Vb(),s.Rb(15,"input",11),s.Rb(16,"div",12),s.nc(17,"async"),s.Rb(18,"j-error",13),s.Vb(),s.Vb(),s.Wb(19,"div",9),s.Wb(20,"j-form-field",10),s.Wb(21,"j-label",1),s.Tc(22,"DIRECTORY.EMPLOYEES.FIO"),s.Vb(),s.Rb(23,"input",14),s.Rb(24,"div",12),s.nc(25,"async"),s.Vb(),s.Vb(),s.Wb(26,"div",9),s.Rb(27,"j-date-input",15),s.nc(28,"translate"),s.Vb(),s.Wb(29,"div",9),s.Wb(30,"j-form-field",10),s.Wb(31,"j-label",1),s.Tc(32,"DIRECTORY.EMPLOYEES.ACCOUNT_SALARY"),s.Vb(),s.Rb(33,"j-entity-logo",16),s.nc(34,"bankFromAccount"),s.Rb(35,"input",17,18),s.Rb(37,"j-error",13),s.Vb(),s.Vb(),s.Wb(38,"div",9),s.Wb(39,"j-form-field",10),s.Wb(40,"j-label",1),s.Tc(41,"DIRECTORY.EMPLOYEES.SUM_SALARY"),s.Vb(),s.Rb(42,"input",19),s.Vb(),s.Vb(),s.Wb(43,"div",9),s.Wb(44,"j-form-field",10),s.Wb(45,"j-label",1),s.Tc(46,"DIRECTORY.EMPLOYEES.SUM_PENSION"),s.Vb(),s.Rb(47,"input",19),s.Rb(48,"j-error",13),s.Vb(),s.Vb(),s.Wb(49,"div",9),s.Wb(50,"j-form-field",10),s.Wb(51,"j-label",1),s.Tc(52,"DIRECTORY.EMPLOYEES.SUM_SOCIAL"),s.Vb(),s.Rb(53,"input",19),s.Rb(54,"j-error",13),s.Vb(),s.Vb(),s.Wb(55,"div",9),s.Wb(56,"j-form-field",10),s.Wb(57,"j-label",1),s.Tc(58,"DIRECTORY.EMPLOYEES.SUM_MEDICAL"),s.Vb(),s.Rb(59,"input",19),s.Rb(60,"j-error",13),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Rc(61,ae,2,1,"div",20),s.Vb(),s.Wb(62,"div",21),s.Wb(63,"button",22),s.ic("click",(function(t){return e.onCancel()})),s.nc(64,"async"),s.Tc(65),s.nc(66,"translate"),s.Vb(),s.Wb(67,"button",23),s.ic("click",(function(t){return e.onSubmit()})),s.nc(68,"async"),s.nc(69,"async"),s.Tc(70),s.nc(71,"translate"),s.Vb(),s.Vb()),2&t&&(s.Ab(3),s.uc("inlineSVG",s.oc(4,48,"chevron-left")),s.Ab(2),s.Vc(" ","DIRECTORY.EMPLOYEES."+(e.editMode?"EDIT_EMPLOYEE":"ADD_EMPLOYEE")," "),s.Ab(1),s.uc("ngIf",e.editMode),s.Ab(3),s.uc("formGroup",e.fGroup),s.Ab(6),s.uc("dropSpecialCharacters",!0)("jShadow",e.masks.iin.shadow)("mask",e.masks.iin.mask)("formControl",e.fGroup.controls.iin),s.Ab(1),s.uc("jLoading",s.oc(17,50,e.autocomplete$))("jLoadingInverted",!0),s.Ab(2),s.uc("control",e.fGroup.controls.iin)("errorMessages",e.errors.iinOrBin),s.Ab(5),s.uc("formControl",e.fGroup.controls.fio),s.Ab(1),s.uc("jLoading",s.oc(25,52,e.autocomplete$))("jLoadingInverted",!0),s.Ab(3),s.uc("isCalendarShown",!1)("label",s.oc(28,54,"DIRECTORY.EMPLOYEES.BIRTH_DATE"))("hasError",e.fGroup.controls.birthDate.errors&&e.isSubmitted)("formControl",e.fGroup.controls.birthDate)("minDate",e.minDate)("maxDate",e.maxDate),s.Ab(6),s.uc("name",s.oc(34,56,"KZ"+e.fGroup.controls.iban.value)),s.Ab(2),s.uc("dropSpecialCharacters",!0)("mask",e.masks.iban.mask)("jShadow",e.masks.iban.shadow)("formControl",e.fGroup.controls.iban),s.Ab(2),s.uc("control",e.fGroup.controls.iban)("errorMessages",e.errors.bankAccount),s.Ab(5),s.uc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.salarySum),s.Ab(5),s.uc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.pensionSum),s.Ab(1),s.uc("control",e.fGroup.controls.pensionSum)("errorMessages",e.socialSumErr),s.Ab(5),s.uc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.socialSum),s.Ab(1),s.uc("control",e.fGroup.controls.socialSum)("errorMessages",e.socialSumErr),s.Ab(5),s.uc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.ocmcSum),s.Ab(1),s.uc("control",e.fGroup.controls.ocmcSum)("errorMessages",e.socialSumErr),s.Ab(1),s.uc("ngIf",e.errorText),s.Ab(2),s.uc("disabled",s.oc(64,58,e.updateInProgress$)),s.Ab(2),s.Uc(s.oc(66,60,"SHARED.CANCEL")),s.Ab(2),s.uc("disabled",s.oc(68,62,e.updateInProgress$))("jLoading",s.oc(69,64,e.updateInProgress$)),s.Ab(3),s.Uc(s.oc(71,66,"SHARED.SAVE")))},directives:[L.a,F.a,n.u,i.J,i.u,i.l,N.a,G.a,U.a,i.c,B.a,r.a,i.t,i.i,H.a,K.a,Q.a,oe.a,X.a,q.a,z.a,J.a,Z.a,ne.a,ie.a],pipes:[et.a,n.b,L.d,Y.a],styles:[".modal-body[_ngcontent-%COMP%]{padding:.25rem 1.5rem .5rem;-webkit-box-flex:1;flex-grow:1}.modal-body[_ngcontent-%COMP%]   .counterParty[_ngcontent-%COMP%]{width:3em;position:relative}.modal-footer[_ngcontent-%COMP%]{padding:.25rem 1.5rem 1rem;flex-shrink:0}.modal-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 1rem;flex-shrink:0}.scrolled[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - 280px)}j-directory-edit-employee[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;max-height:calc(100vh - 80px)}.j-form-field[_ngcontent-%COMP%]   .is-loading[_ngcontent-%COMP%]{width:40px;position:relative}"]}),t})();var be=o("Kx/q"),ue=o("7Fmj"),de=o("wY9W");function pe(t,e){if(1&t&&(s.Ub(0),s.Wb(1,"span",7),s.Tc(2),s.Vb(),s.Tb()),2&t){const t=e.$implicit;s.Ab(2),s.Vc("",t," ")}}function me(t,e){if(1&t){const t=s.Xb();s.Ub(0),s.Wb(1,"div",2),s.Wb(2,"div",3),s.Rb(3,"input",4),s.Rb(4,"label",5),s.Vb(),s.Vb(),s.Wb(5,"div",6),s.Wb(6,"p",7),s.Tc(7),s.Rb(8,"br"),s.Wb(9,"span",8),s.Tc(10),s.nc(11,"date"),s.Vb(),s.Vb(),s.Vb(),s.Wb(12,"div",9),s.Wb(13,"p",10),s.Rc(14,pe,3,1,"ng-container",11),s.nc(15,"pipeFunction"),s.Vb(),s.Vb(),s.Wb(16,"div",12),s.Wb(17,"p",7),s.Tc(18),s.nc(19,"maskIban"),s.Vb(),s.Vb(),s.Wb(20,"div",13),s.Wb(21,"p",7),s.Rb(22,"j-money",14),s.Vb(),s.Vb(),s.Wb(23,"div",15),s.Wb(24,"p",7),s.Rb(25,"j-money",14),s.Vb(),s.Vb(),s.Wb(26,"div",15),s.Wb(27,"p",7),s.Rb(28,"j-money",14),s.Vb(),s.Vb(),s.Wb(29,"div",15),s.Wb(30,"p",7),s.Rb(31,"j-money",14),s.Vb(),s.Vb(),s.Wb(32,"div",16),s.Wb(33,"span",17),s.Wb(34,"button",18),s.ic("click",(function(e){return s.Ic(t),s.mc().onEdit()})),s.nc(35,"translate"),s.Rb(36,"i",19),s.nc(37,"svgPath"),s.Vb(),s.Vb(),s.Wb(38,"span"),s.Wb(39,"button",20),s.ic("click",(function(e){return s.Ic(t),s.mc().onRemove()})),s.nc(40,"translate"),s.Rb(41,"i",19),s.nc(42,"svgPath"),s.Vb(),s.Vb(),s.Vb(),s.Tb()}if(2&t){const t=s.mc();s.Ab(3),s.uc("jSelectionRow",t.item.id),s.Bb("id",t.item.id),s.Ab(1),s.Bb("for",t.item.id),s.Ab(3),s.Uc(t.item.iin),s.Ab(3),s.Uc(s.pc(11,15,t.item.birthDate,"dd.MM.yyyy")),s.Ab(4),s.uc("ngForOf",s.pc(15,18,t.item.fio,t.splitName)),s.Ab(4),s.Uc(s.oc(19,21,t.item.iban)),s.Ab(4),s.uc("money",t.item.salarySum),s.Ab(3),s.uc("money",t.item.pensionSum),s.Ab(3),s.uc("money",t.item.socialSum),s.Ab(3),s.uc("money",t.item.ocmcSum),s.Ab(3),s.uc("ngbTooltip",s.oc(35,23,"DIRECTORY.EMPLOYEES.EDIT")),s.Ab(2),s.uc("inlineSVG",s.oc(37,25,"edit")),s.Ab(3),s.uc("ngbTooltip",s.oc(40,27,"DIRECTORY.EMPLOYEES.DELETE")),s.Ab(2),s.uc("inlineSVG",s.oc(42,29,"bucket"))}}const he=function(t){return{num:t}};function fe(t,e){if(1&t){const t=s.Xb();s.Wb(0,"div",21),s.Wb(1,"span",22),s.Tc(2),s.Vb(),s.Wb(3,"button",23),s.ic("click",(function(e){return s.Ic(t),s.mc().onCancelRemove()})),s.Rb(4,"i",19),s.nc(5,"svgPath"),s.Wb(6,"small",24),s.Tc(7),s.nc(8,"translate"),s.Vb(),s.Vb(),s.Vb()}if(2&t){const t=s.mc();s.Ab(1),s.uc("translateParams",t.row.deleteWith?s.zc(9,he,t.row.deleteWith.length+1):null),s.Ab(1),s.Uc(t.row.deleteWith?"DIRECTORY.EMPLOYEES.EMPLOYEES_DELETED":"DIRECTORY.EMPLOYEES.EMPLOYEE_DELETED"),s.Ab(2),s.uc("inlineSVG",s.oc(5,5,"arrow-loop-left")),s.Ab(3),s.Wc("",s.oc(8,7,"SHARED.RETURN")," ",t.removing,"")}}let ge=(()=>{class t{constructor(){this.remove=new s.n,this.cancelRemove=new s.n,this.edit=new s.n}ngOnInit(){}onEdit(){this.edit.emit(this.row)}onRemove(){this.remove.emit(this.row)}onCancelRemove(){this.cancelRemove.emit(this.row)}splitName(t){return t?t.split(" "):[]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Kb({type:t,selectors:[["j-directory-employee-row"]],hostAttrs:[1,"j-table--row"],inputs:{item:"item",row:"row",removing:"removing"},outputs:{remove:"remove",cancelRemove:"cancelRemove",edit:"edit"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["removingTpl",""],[1,"directory-employees-list--select","p3","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"jSelectionRow"],[1,"custom-control-label"],[1,"directory-employees-list--iin","p3","j-table--cell","j-table--cell_static"],[1,"m-0"],[1,"text-gray"],[1,"directory-employees-list--name","p3","j-table--cell"],[1,"directory-employees-list--name-helper","m-0"],[4,"ngFor","ngForOf"],[1,"directory-employees-list--number","p3","j-table--cell","j-table--cell_static"],[1,"directory-employees-list--salary","p3","j-table--cell"],[3,"money"],[1,"directory-employees-list--payment","p3","j-table--cell","j-table--cell_static"],[1,"directory-employees-list--tools","p3","j-table--cell"],[1,"mr-2"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray","ml-auto",3,"ngbTooltip","click"],[3,"inlineSVG"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[1,"p3","j-table--cell","directory-employees-list--removing","d-flex"],["translate","",1,"text-muted",3,"translateParams"],["type","button",1,"ml-auto","btn","btn-link","text-info","p-0",3,"click"],[1,"ml-1"]],template:function(t,e){if(1&t&&(s.Rc(0,me,43,31,"ng-container",0),s.Rc(1,fe,9,11,"ng-template",null,1,s.Sc)),2&t){const t=s.Fc(2);s.uc("ngIf",!e.removing)("ngIfElse",t)}},directives:[n.u,ht.a,n.t,be.a,D.E,F.a,L.a],pipes:[n.f,ue.a,de.a,L.d,et.a],styles:[".directory-employees-list--name-helper[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;max-width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-right:.2em}"]}),t})();const ye=["contentBody"],ve=["emptyBody"],Re=["errorBody"];function Ee(t,e){1&t&&s.Sb(0)}function je(t,e){1&t&&s.Sb(0)}function Te(t,e){if(1&t&&(s.Wb(0,"div",13),s.Rc(1,Ee,1,0,"ng-container",14),s.Rc(2,je,1,0,"ng-container",14),s.Vb()),2&t){const t=s.mc(),e=s.Fc(9);s.Ab(1),s.uc("ngTemplateOutlet",e),s.Ab(1),s.uc("ngTemplateOutlet",t.contentTpl)}}function xe(t,e){if(1&t){const t=s.Xb();s.Wb(0,"button",29),s.ic("click",(function(e){return s.Ic(t),s.mc(2).onRemoveSelected()})),s.nc(1,"translate"),s.Rb(2,"i",30),s.nc(3,"svgPath"),s.Vb()}2&t&&(s.uc("ngbTooltip",s.oc(1,2,"DIRECTORY.EMPLOYEES.DELETE_MULTY")),s.Ab(2),s.uc("inlineSVG",s.oc(3,4,"bucket")))}function Oe(t,e){if(1&t&&(s.Wb(0,"div",15),s.Wb(1,"div",16),s.Wb(2,"div",17),s.Wb(3,"div",18),s.Rb(4,"input",19),s.Rb(5,"label",20),s.Vb(),s.Vb(),s.Wb(6,"div",21),s.Tc(7,"DIRECTORY.EMPLOYEES.IIN_BIRTH"),s.Vb(),s.Wb(8,"div",22),s.Tc(9,"DIRECTORY.EMPLOYEES.FIO"),s.Vb(),s.Wb(10,"div",23),s.Tc(11,"DIRECTORY.EMPLOYEES.ACCOUNT_N"),s.Vb(),s.Wb(12,"div",24),s.Tc(13,"DIRECTORY.EMPLOYEES.SUM_SAL"),s.Vb(),s.Wb(14,"div",25),s.Tc(15,"DIRECTORY.EMPLOYEES.SUM_PENS"),s.Vb(),s.Wb(16,"div",25),s.Tc(17,"DIRECTORY.EMPLOYEES.SUM_SOC"),s.Vb(),s.Wb(18,"div",25),s.Tc(19,"DIRECTORY.EMPLOYEES.SUM_MEDICAL"),s.Vb(),s.Wb(20,"div",26),s.Wb(21,"span",27),s.Rc(22,xe,4,6,"button",28),s.Vb(),s.Vb(),s.Vb(),s.Vb()),2&t){const t=s.mc();s.Ab(4),s.uc("masterSelect",!0),s.Ab(18),s.uc("ngIf",t.selectionModel.value.length)}}function ke(t,e){if(1&t){const t=s.Xb();s.Wb(0,"j-directory-employee-row",33),s.ic("edit",(function(o){s.Ic(t);const n=e.$implicit;return s.mc(2).onEdit(n)}))("remove",(function(o){s.Ic(t);const n=e.$implicit;return s.mc(2).onRemove(n)}))("cancelRemove",(function(o){s.Ic(t);const n=e.$implicit;return s.mc(2).onCancelRemove(n)})),s.nc(1,"async"),s.Vb()}if(2&t){const t=e.$implicit;s.uc("hidden",t.hidden)("row",t)("item",t.data)("removing",s.oc(1,4,t.removing$))}}function Se(t,e){if(1&t&&(s.Wb(0,"div",31),s.Rc(1,ke,2,6,"ng-template",32),s.nc(2,"async"),s.nc(3,"trackByProperty"),s.Vb()),2&t){const t=s.mc();s.Ab(1),s.uc("ngForOf",s.oc(2,2,t.composedRows$))("ngForTrackBy",s.oc(3,4,"id"))}}function Ae(t,e){if(1&t&&s.Rb(0,"j-empty-placeholder",34),2&t){const t=s.mc();s.uc("label",t.search.value?"DIRECTORY.EMPLOYEES.NOT_FOUND_CHANGE_PARAMS":"PAYMENTS.EMPLOYEES.EMPTY")}}function we(t,e){if(1&t){const t=s.Xb();s.Wb(0,"div",35),s.Wb(1,"p",36),s.Tc(2,"SHARED.LIST_LOADING_ERR_REFRESH"),s.Vb(),s.Wb(3,"button",37),s.ic("click",(function(e){return s.Ic(t),s.mc().onRefresh()})),s.Tc(4,"SHARED.REFRESH"),s.Vb(),s.Vb()}}function Ve(t,e){if(1&t){const t=s.Xb();s.Wb(0,"button",38),s.ic("click",(function(e){return s.Ic(t),s.mc().onEdit()})),s.Tc(1),s.nc(2,"translate"),s.Vb()}2&t&&(s.Ab(1),s.Vc("+ ",s.oc(2,1,"DIRECTORY.EMPLOYEES.ADD_EMPLOYEE"),""))}function Ce(t,e){1&t&&s.Sb(0)}function Ie(t,e){1&t&&s.Sb(0)}function We(t,e){if(1&t&&(s.Wb(0,"div",39),s.Rc(1,Ce,1,0,"ng-container",14),s.Rc(2,Ie,1,0,"ng-container",14),s.Vb()),2&t){s.mc();const t=s.Fc(20);s.Ab(1),s.uc("ngTemplateOutlet",t),s.Ab(1),s.uc("ngTemplateOutlet",t)}}const Pe=function(){return{width:"200px",height:"25px","background-color":"#ECEEF1"}},De=function(){return{height:"115px","background-color":"#ECEEF1"}};function Me(t,e){1&t&&(s.Rb(0,"ngx-skeleton-loader",40),s.Rb(1,"ngx-skeleton-loader",40),s.Rb(2,"ngx-skeleton-loader",40)),2&t&&(s.uc("theme",s.yc(3,Pe)),s.Ab(1),s.uc("theme",s.yc(4,De)),s.Ab(1),s.uc("theme",s.yc(5,De)))}let $e=(()=>{class t{constructor(t,e,o,n,c){this.company=t,this.employeeService=e,this.modalService=o,this.notifierService=n,this.translateService=c,this.search=new i.h(""),this.rows$=new p.a([]),this.composedRows$=new p.a([]),this.loadingErrors$=new p.a(void 0),this.selectionModel=new i.h([]),this.subs=new m.a,this.store=new Qt.a([])}ngOnInit(){this.subs.add(this.company.currentCompany$.pipe(Object(y.a)(0),Object(v.a)(1)).subscribe(t=>{this.selectionModel.patchValue([]),this.onRefresh(),this.rows$.getValue().forEach(t=>{t.cancelRemove$&&t.cancelRemove$.next(Date.now())})})),this.combineFilter(),this.watchForBodyTpl(),this.watchForItems(),this.onRefresh()}onEdit(t){var e;const o=this.modalService.open(se,{backdropClass:"backdrop_light",windowClass:"modal_light modal-adaptive_sm modal_max-height modal-adaptive",centered:!0,backdrop:"static"});o.componentInstance.item=null===(e=t)||void 0===e?void 0:e.data,o.result.then(e=>this.handleEditResult(e,t))}onRemoveSelected(){let t=this.selectionModel.value;t=t[t.length-1];const e=this.rows$.getValue().find(e=>e.data.id===t);e&&this.startDeleteProcess(e,!0)}onRemove(t,e){this.startDeleteProcess(t,e)}onCancelRemove(t){t.cancelRemove$&&t.cancelRemove$.next(Date.now())}onRefresh(){return Object(d.a)(this,void 0,void 0,(function*(){try{yield this.fetchEmployees(),this.selectionModel.patchValue([]),this.loadingErrors$.next(null)}catch(t){this.rows$.next([]),this.selectionModel.patchValue([]),this.loadingErrors$.next(t)}}))}combineFilter(){this.subs.add(Object(h.a)([this.rows$,this.search.valueChanges.pipe(Object(x.a)(""))]).pipe(Object(E.a)(([t,e])=>{const o=e.toLocaleLowerCase();return t.filter(t=>!t.hidden&&this.employeeService.filterEmployee(t.data,o))})).subscribe(this.composedRows$))}fetchEmployees(){return Object(d.a)(this,void 0,void 0,(function*(){this.store.fetching=!0;try{const t=yield this.employeeService.getEmployees();this.store.setState(t),this.store.fetching=!1,!this.store.fetched&&(this.store.fetched=!0)}catch(t){throw this.store.setState([]),!this.store.fetched&&(this.store.fetched=!0),this.store.fetching=!1,t}}))}handleEditResult(t,e){t&&([le.create,le.update].some(e=>e===t.type)?(this.notifierService.notify("success",this.translateService.instant("DIRECTORY.EMPLOYEES."+(le.create===t.type?"EMPLOYEE_ADDED":"EMPLOYEE_EDITED"))),this.store.upsertItem(t.payload)):this.startDeleteProcess(e))}watchForItems(){this.subs.add(Object(h.a)([this.store.items$,this.store.fetching$,this.store.fetched$]).pipe(Object(R.a)(([t,e,o])=>!e&&o),Object(E.a)(t=>t[0]),Object(j.a)(),Object(T.a)(t=>this.selectionModel.patchValue([])),Object(E.a)(t=>t.map(t=>new S(t)))).subscribe(t=>{this.rows$.next(t)}))}watchForBodyTpl(){this.subs.add(Object(h.a)([this.store.fetched$,this.search.valueChanges.pipe(Object(x.a)("")),this.loadingErrors$,this.composedRows$]).pipe(Object(y.a)(0),Object(E.a)(([t,e,o,n])=>o?this.errorBody:t&&!n.length?this.emptyBody:this.contentBody),Object(j.a)()).subscribe(t=>this.contentTpl=t))}startDeleteProcess(t,e){let o;if(e){const e=this.selectionModel.value.reduce((t,e)=>(t[e]=!0,t),{});delete e[t.data.id],o=this.rows$.getValue().filter(t=>e[t.data.id]),t.deleteWith=o,o.forEach(t=>t.hidden=!0)}t.cancelRemove$=new f.a,t.removing$.next("5"),this.rows$.next([...this.rows$.getValue()]);const n=Object(g.a)(1e3).pipe(Object(O.a)(t.cancelRemove$.pipe(Object(T.a)(()=>{t.removing$.next(""),t.deleteWith&&(t.deleteWith.forEach(t=>t.hidden=!1),t.deleteWith=null),t.cancelRemove$=null}))),Object(T.a)(e=>{t.removing$.next((+t.removing$.getValue()-1).toString())}),Object(k.a)(5)).subscribe({next:e=>{4===e&&this.finishRemove(t,o)},complete:()=>n.unsubscribe(),error:()=>n.unsubscribe()})}finishRemove(t,e){return Object(d.a)(this,void 0,void 0,(function*(){!t.destroy$.closed&&t.removing$.next(null);let o=[];o=e?e.map(t=>t.data.id).concat(t.data.id):[t.data.id];const n=o.map(t=>this.store.entities[t]).map(t=>t&&t.iin);this.store.removeItems(o);const i=o.reduce((t,e)=>(t[e]=!0,t),{});this.selectionModel.patchValue(this.selectionModel.value.filter(t=>!i[t])),[t,...e||[]].forEach(t=>t.destroy());try{yield this.employeeService.deleteEmployee(n),this.notifierService.notify("success",this.translateService.instant("DIRECTORY.EMPLOYEES."+(o.length>1?"EMPLOYEES_DELETED":"EMPLOYEE_DELETED"),{num:o.length}))}catch(c){this.notifierService.notify("error",c)}}))}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(bt.a),s.Qb(Zt.b),s.Qb(D.q),s.Qb(ut.c),s.Qb(L.e))},t.\u0275cmp=s.Kb({type:t,selectors:[["app-directory-employees"]],viewQuery:function(t,e){var o;1&t&&(s.Yc(ye,!0),s.Yc(ve,!0),s.Yc(Re,!0)),2&t&&(s.Ec(o=s.jc())&&(e.contentBody=o.first),s.Ec(o=s.jc())&&(e.emptyBody=o.first),s.Ec(o=s.jc())&&(e.errorBody=o.first))},decls:21,vars:9,consts:[[1,"list-page--content","list-page--content_counterparties",3,"jSelectionContainer","rows"],[1,"list-page--filter"],["clearable","true"],["jPrefix","","inlineSVG","/assets/icons/search.svg",1,"text-primary","d-block","mt-n1"],["type","text","jFormInput","","placeholder","\u041f\u043e\u0438\u0441\u043a","autocomplete","off",1,"form-control",3,"formControl"],["class","directory-employee--list j-table",4,"ngIf","ngIfElse"],["tableHead",""],["contentBody",""],["emptyBody",""],["errorBody",""],["jPortalledTpl","DIRECTORY_TITLE"],["loading",""],["loaderPart",""],[1,"directory-employee--list","j-table"],[4,"ngTemplateOutlet"],[1,"j-table--head"],[1,"j-table--row"],[1,"directory-employees-list--select","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","checkboxAll","jSelectionRow","",1,"custom-control-input",3,"masterSelect"],["for","checkboxAll",1,"custom-control-label"],["translate","",1,"directory-employees-list--iin","j-table--cell","j-table--cell_static","p4"],["translate","",1,"directory-employees-list--name","j-table--cell","p4"],["translate","",1,"directory-employees-list--number","j-table--cell","j-table--cell_static","p4"],["translate","",1,"directory-employees-list--salary","j-table--cell","p4"],["translate","",1,"directory-employees-list--payment","j-table--cell","j-table--cell_static","p4"],[1,"directory-employees-list--tools","j-table--cell"],[1,"ml-auto"],["type","button","tooltipClass","tooltip-light","placement","top","class","btn btn-link btn-as-text btn-link-light-gray",3,"ngbTooltip","click",4,"ngIf"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[3,"inlineSVG"],[1,"j-table--body"],["ngFor","",3,"ngForOf","ngForTrackBy"],[3,"hidden","row","item","removing","edit","remove","cancelRemove"],[3,"label"],[1,"text-center","pt-5"],["translate","",1,"text-gray","text-gray"],["translate","","ng-disabled","store.fetching$ | async",1,"btn","btn-link","p-1",3,"click"],[1,"mt-n3","btn","btn-link","p-0",3,"click"],[1,"p-4"],[3,"theme"]],template:function(t,e){if(1&t&&(s.Wb(0,"div",0),s.nc(1,"async"),s.Wb(2,"div",1),s.Wb(3,"j-form-field",2),s.Rb(4,"span",3),s.Rb(5,"input",4),s.Vb(),s.Vb(),s.Rc(6,Te,3,2,"div",5),s.nc(7,"async"),s.Rc(8,Oe,23,2,"ng-template",null,6,s.Sc),s.Rc(10,Se,4,6,"ng-template",null,7,s.Sc),s.Vb(),s.Rc(12,Ae,1,1,"ng-template",null,8,s.Sc),s.Rc(14,we,5,0,"ng-template",null,9,s.Sc),s.Rc(16,Ve,3,3,"ng-template",10),s.Rc(17,We,3,2,"ng-template",null,11,s.Sc),s.Rc(19,Me,3,6,"ng-template",null,12,s.Sc)),2&t){const t=s.Fc(18);s.uc("jSelectionContainer",e.selectionModel)("rows",s.oc(1,5,e.composedRows$)),s.Ab(5),s.uc("formControl",e.search),s.Ab(1),s.uc("ngIf",s.oc(7,7,e.store.fetched$))("ngIfElse",t)}},directives:[dt.a,N.a,q.a,F.a,U.a,i.c,i.t,i.i,n.u,mt,n.B,ht.a,L.a,D.E,n.t,ge,kt.a,c.a],pipes:[n.b,L.d,et.a,St.a],styles:[".directory-employee--list{min-height:200px;overflow:auto}.directory-employee--list .j-table--head{min-width:760px;position:-webkit-sticky;position:sticky;top:0}.directory-employee--list .j-table--body{min-width:760px}.directory-employee--list .directory-employees-list--select{position:-webkit-sticky;position:sticky;left:0;background:#fff}.directory-employee--list--select{flex-basis:50px;max-width:50px}.directory-employees-list--iin{flex-basis:120px}.directory-employees-list--name{flex-basis:140px;max-width:170px;flex-wrap:wrap}.directory-employees-list--number{flex-basis:100px}.directory-employees-list--salary{flex-basis:120px}.directory-employees-list--payment{flex-basis:80px;max-width:100px}.directory-employees-list--tools{flex-basis:64px;margin-left:auto;text-align:right;padding-top:18px;padding-bottom:18px;min-width:86px}.directory-employees-list--tools .btn+.btn{margin-left:1em}.directory-employees-list--removing{background-color:#f6f7f8}@media(min-width:960px){.directory-employee--list{overflow:initial;min-width:none}.directory-employee--list .j-table--head{min-width:none;position:static}.directory-employee--list .directory-employees-list--select{position:static;background:none}.directory-employee--list .j-table--body{min-width:none}}"],encapsulation:2}),t})();var Ye=o("paXB"),_e=o("7/bn"),Le=o("oMXN"),Fe=o("EiG8");function Ne(t,e){1&t&&s.Sb(0)}let Ge=(()=>{class t{constructor(t,e){this.portal=e,this.template$=e.pipe(Object(R.a)(e=>!e||t in e),Object(E.a)(e=>e&&e[t]))}}return t.\u0275fac=function(e){return new(e||t)(s.fc("name"),s.Qb(pt))},t.\u0275cmp=s.Kb({type:t,selectors:[["j-portal-host"]],inputs:{context:"context"},decls:2,vars:4,consts:[[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,e){1&t&&(s.Rc(0,Ne,1,0,"ng-container",0),s.nc(1,"async")),2&t&&s.uc("ngTemplateOutlet",s.oc(1,2,e.template$))("ngTemplateOutletContext",e.context)},directives:[n.B],pipes:[n.b],styles:[""]}),t})();const Ue=function(){return["counterparties"]},Be=function(){return["employees"]},He=["*"];let Ke=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Kb({type:t,selectors:[["j-directory-tabs"]],ngContentSelectors:He,decls:8,vars:4,consts:[[1,"list-page--nav"],["jTour","DIRECTORY.NAV","jTourPosition","bottom"],[1,"page-tabs"],["routerLinkActive","active","translate","",3,"routerLink"]],template:function(t,e){1&t&&(s.tc(),s.Wb(0,"div",0),s.Wb(1,"nav",1),s.Wb(2,"div",2),s.Wb(3,"a",3),s.Tc(4,"DIRECTORY.COUNTERPARTIES.TITLE"),s.Vb(),s.Wb(5,"a",3),s.Tc(6,"DIRECTORY.EMPLOYEES.TITLE"),s.Vb(),s.Vb(),s.Vb(),s.sc(7),s.Vb()),2&t&&(s.Ab(3),s.uc("routerLink",s.yc(2,Ue)),s.Ab(2),s.uc("routerLink",s.yc(3,Be)))},directives:[ft.a,u.f,u.e,L.a],styles:[""]}),t})();const Qe=[{path:"",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Kb({type:t,selectors:[["j-directory"]],decls:17,vars:3,consts:[[1,"row"],[1,"col-lg-10","offset-lg-1","col-xl-8","offset-xl-2"],[1,"directory__title","header-title"],[1,"directory--actions","d-md-none"],["name","DIRECTORY_TITLE"],[1,"list-page"],[1,"directory--actions","d-none","d-md-block"]],template:function(t,e){1&t&&(s.Wb(0,"j-layout-home"),s.Wb(1,"j-aside"),s.Rb(2,"j-nav-main"),s.Vb(),s.Wb(3,"j-main"),s.Wb(4,"div",0),s.Wb(5,"div",1),s.Wb(6,"section"),s.Wb(7,"h2",2),s.Tc(8),s.nc(9,"translate"),s.Wb(10,"div",3),s.Rb(11,"j-portal-host",4),s.Vb(),s.Vb(),s.Wb(12,"div",5),s.Wb(13,"j-directory-tabs"),s.Wb(14,"div",6),s.Rb(15,"j-portal-host",4),s.Vb(),s.Vb(),s.Rb(16,"router-outlet"),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Vb()),2&t&&(s.Ab(8),s.Vc("",s.oc(9,1,"DIRECTORY.TITLE")," "))},directives:[Ye.a,_e.a,Le.a,Fe.a,Ge,Ke,u.h],pipes:[L.d],styles:[".directory__title{margin-top:40px;margin-bottom:40px}.list-page{background:#fff;box-shadow:0 4px 8px rgba(0,0,0,.04),0 0 2px rgba(0,0,0,.06),0 0 1px rgba(0,0,0,.04);border-radius:12px}.list-page--nav{padding:1rem 1.5rem 0;display:-webkit-box;display:flex;width:100%;-webkit-box-align:center;align-items:center}.list-page--filter{padding:1rem;background:#f6f7f8}.page-tabs{display:-webkit-box;display:flex;min-width:100%}.page-tabs>a{white-space:nowrap;background:none;display:block;padding:12px 0;color:#666c72;margin-right:2.5rem;font-size:1.125rem}.page-tabs>a.active{color:#1a1c1f;font-weight:500;border-bottom:2px solid #ef5630}.page-tabs>a[disabled]{cursor:not-allowed;opacity:.5}.j-table--row{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;width:100%;box-shadow:0 0 0 rgba(0,0,0,.04);-webkit-transition:box-shadow .3s ease-in-out;transition:box-shadow .3s ease-in-out;will-change:box-shadow}.j-table--row+.j-table--row{border-top:1px solid #eceef1}.j-table--head .j-table--row{border-bottom:1px solid #eceef1;-webkit-box-align:center;align-items:center}.j-table--body .j-table--row:not(.j-table--row_delete):hover{box-shadow:0 10px 20px rgba(0,0,0,.04),0 2px 6px rgba(0,0,0,.04),0 0 1px rgba(0,0,0,.04)}.j-table--cell{-webkit-box-flex:1;flex-grow:1;flex-shrink:1;flex-basis:auto;padding:20px 8px}.j-table--cell:first-child{padding-left:16px}.j-table--cell:last-child{padding-right:16px}.j-table--cell_static{-webkit-box-flex:0;flex-grow:0;flex-shrink:0}.header-title .directory--actions{margin-top:.2em;float:right;margin-left:15px}.directory--actions{margin-left:auto}"],encapsulation:2}),t})(),data:{title:"DIRECTORY.TITLE"},children:[{path:"counterparties",component:Kt},{path:"employees",component:$e},{path:"**",redirectTo:"counterparties"}]},{path:"**",redirectTo:""}];let Xe=(()=>{class t{}return t.\u0275mod=s.Ob({type:t}),t.\u0275inj=s.Nb({factory:function(e){return new(e||t)},imports:[[u.g.forChild(Qe)],u.g]}),t})();o.d(e,"DirectoryModule",(function(){return qe}));let qe=(()=>{class t{}return t.\u0275mod=s.Ob({type:t}),t.\u0275inj=s.Nb({factory:function(e){return new(e||t)},providers:[l.FormBuilderTypeSafe],imports:[[n.c,a.a,Xe,c.b,i.n,i.D,r.c.forChild(),b]]}),t})()}}]);