(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{DVvf:function(t,e,i){"use strict";i.r(e);var n=i("ofXK"),o=i("3Pt+"),s=i("sYmb"),r=i("xJkR"),c=i("4Nuw"),a=i("PCNd"),u=i("tyNb"),l=i("fXoL"),d=i("bsP8"),h=i("S1F0"),m=i("oKsb"),b=i("fvpk"),f=i("mrSG"),p=i("quSY"),v=i("itXk"),y=i("lJxs"),A=i("pLZG"),S=i("TwVa"),g=i("+/Tu"),T=i("zwEd"),R=i("4wRv"),E=i("1kSV");function w(t,e){if(1&t&&l.Rb(0,"p",10),2&t){const t=l.mc();l.uc("innerHTML",t.errorText,l.Jc)}}let C=(()=>{class t{constructor(t,e){this.modal=t,this.router=e}dismissModal(){this.modal.dismiss()}closeModal(){this.router.navigate(["/transfers"]),this.modal.close()}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(E.a),l.Qb(u.c))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-transfer-error"]],inputs:{description:"description",errorText:"errorText"},decls:15,vars:5,consts:[[1,"modal-header","j-modal-header"],[1,"modal-body","px-4","pt-0","pb-4","text-center"],["src","/assets/img/history/modals/error.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted"],["translate",""],["class","mt-3 mb-0 text-danger",3,"innerHTML",4,"ngIf"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-primary","btn-block","mb-3",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[1,"mt-3","mb-0","text-danger",3,"innerHTML"]],template:function(t,e){1&t&&(l.Rb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"img",2),l.nc(3,"translate"),l.Wb(4,"h3",3),l.Tc(5,"SHARED.ERROR"),l.Vb(),l.Wb(6,"p",4),l.Wb(7,"span",5),l.Tc(8),l.Vb(),l.Vb(),l.Rc(9,w,1,1,"p",6),l.Vb(),l.Wb(10,"div",7),l.Wb(11,"button",8),l.ic("click",(function(t){return e.closeModal()})),l.Tc(12," SHARED.TRY_AGAIN "),l.Vb(),l.Wb(13,"button",9),l.ic("click",(function(t){return e.dismissModal()})),l.Tc(14," SHARED.BACK_TO_HOME "),l.Vb(),l.Vb()),2&t&&(l.Ab(2),l.vc("alt",l.oc(3,3,"SHARED.ERROR")),l.Ab(6),l.Uc(e.description),l.Ab(1),l.uc("ngIf",e.errorText))},directives:[s.a,n.u],pipes:[s.d],styles:[""]}),t})();var O=i("Kx/q");let N=(()=>{class t{constructor(t){this.modal=t}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(E.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-transfer-success"]],inputs:{description:"description",totalBalance:"totalBalance"},decls:14,vars:5,consts:[[1,"modal-header","j-modal-header"],[1,"modal-body","j-modal-body","text-center","pb-4"],["src","/assets/img/history/modals/success.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[3,"money"],["translate","",1,"m-0","text-muted"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-primary","btn-block","mb-3",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"]],template:function(t,e){1&t&&(l.Rb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"img",2),l.nc(3,"translate"),l.Wb(4,"h3",3),l.Wb(5,"strong"),l.Rb(6,"j-money",4),l.Vb(),l.Vb(),l.Wb(7,"p",5),l.Tc(8),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"button",7),l.ic("click",(function(t){return e.closeModal()})),l.Tc(11," TRANSFERS.NAVIGATE_TO_HISTORY "),l.Vb(),l.Wb(12,"button",8),l.ic("click",(function(t){return e.dismissModal()})),l.Tc(13," SHARED.BACK_TO_HOME "),l.Vb(),l.Vb()),2&t&&(l.Ab(2),l.vc("alt",l.oc(3,3,e.description)),l.Ab(4),l.uc("money",e.totalBalance),l.Ab(2),l.Vc(" ",e.description," "))},directives:[s.a,O.a],pipes:[s.d],styles:[""]}),t})();var I=i("y5b2"),F=i("L+ju"),k=i("+BgI"),V=i("wtV8"),D=i("mR7B");let j=(()=>{class t{constructor(t,e,i){this.paymentsPipelineService=t,this.paymentsApiService=e,this.maskedService=i}getTransferById(t){return this.paymentsApiService.getPaymentById(t)}saveEditedTransfer(t,e){return this.paymentsApiService.updatePayment(Object.assign(Object.assign({},e),this.mapTransferOwnPaymentBody(t)),{paymentId:t.id})}createOwnTransfer(t){return Object(f.a)(this,void 0,void 0,(function*(){try{return this.paymentsApiService.createPayment(this.mapTransferOwnPaymentBody(t))}catch(e){throw e}}))}createAndSignOwnTransfer(t){return Object(f.a)(this,void 0,void 0,(function*(){const e=yield this.createOwnTransfer(t);return this.paymentsPipelineService.processPaymentVerify(e)}))}mapTransferOwnPaymentBody(t){let e=S.j.IN_BETWEEN,i=null;t.fromAccount.accountType===F.a.ACCOUNT&&t.toAccount.accountType===F.a.CARD&&(e=S.j.ACCOUNT_TO_CARD),t.fromAccount.accountType===F.a.CARD&&t.toAccount.accountType===F.a.ACCOUNT&&(e=S.j.CARD_TO_ACCOUNT,i=t.fromAccount.accountId),t.fromAccount.accountType===F.a.CARD&&t.toAccount.accountType===F.a.CARD&&(e=S.j.CARD_TO_CARD,i=t.fromAccount.accountId);let n={type:e,category:S.h.DOMESTIC,paymentRecipient:{recipientAccount:{iban:t.to}},details:{payerIban:t.from,paymentAmount:{amount:this.maskedService.getNumberedAmount(t.amount),currency:g.a.KZT},documentId:t.documentNumber,associatedField:{parameters:{payerCardNumber:t.fromAccount.accountType===F.a.CARD?t.fromAccount.cardNumber:null,recipientCardNumber:t.toAccount.accountType===F.a.CARD?t.toAccount.cardNumber:null}}}};return i&&(n.details=Object.assign(Object.assign({},n.details),{payerAccountId:i})),n}mapTransferOwnToPayment(t,e){return e.paymentRecipient.recipientAccount.iban=t.to,e.details.payerIban=t.from,e.details.paymentAmount.amount=this.maskedService.getNumberedAmount(t.amount),e.details.documentId=t.documentNumber,e}}return t.\u0275fac=function(e){return new(e||t)(l.ec(k.a),l.ec(V.a),l.ec(D.a))},t.\u0275prov=l.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var P=i("VnnJ"),L=i("CVrE"),_=i("7rOj"),M=i("+eKG"),x=i("VO+5"),W=i("2A1n"),B=i("kDIH"),H=i("hsBV"),Q=i("9odQ"),U=i("NpBu");const K=["fromDropdown"],G=["toDropdown"],q=function(){return{height:"56px","background-color":"#ECEEF1"}},J=function(){return{height:"56px",width:"200px","background-color":"#ECEEF1"}};function X(t,e){1&t&&(l.Ub(0),l.Rb(1,"ngx-skeleton-loader",3),l.Rb(2,"ngx-skeleton-loader",3),l.Rb(3,"ngx-skeleton-loader",3),l.Rb(4,"ngx-skeleton-loader",3),l.Wb(5,"div",4),l.Rb(6,"ngx-skeleton-loader",3),l.Vb(),l.Tb()),2&t&&(l.Ab(1),l.uc("theme",l.yc(5,q)),l.Ab(1),l.uc("theme",l.yc(6,q)),l.Ab(1),l.uc("theme",l.yc(7,q)),l.Ab(1),l.uc("theme",l.yc(8,q)),l.Ab(2),l.uc("theme",l.yc(9,J)))}function Y(t,e){1&t&&l.Rb(0,"j-restricted-placeholder",5)}function Z(t,e){if(1&t&&(l.Rb(0,"p",17),l.nc(1,"translate")),2&t){const t=l.mc(2);l.uc("innerHTML",l.pc(1,1,"TRANSFERS.NOT_ENOUGH",t.translateParams),l.Jc)}}function z(t,e){if(1&t){const t=l.Xb();l.Wb(0,"div",18),l.Wb(1,"button",19),l.ic("click",(function(e){return l.Ic(t),l.mc(2).edit()})),l.Tc(2,"TRANSFERS.SAVE"),l.Vb(),l.Vb()}}function $(t,e){if(1&t){const t=l.Xb();l.Wb(0,"button",19),l.ic("click",(function(e){return l.Ic(t),l.mc(3).createOnly()})),l.Tc(1,"TRANSFERS.FOR_SIGN"),l.Vb()}}function tt(t,e){if(1&t){const t=l.Xb();l.Wb(0,"button",22),l.ic("click",(function(e){return l.Ic(t),l.mc(3).createAndSign()})),l.Tc(1,"TRANSFERS.SIGN"),l.Vb()}}function et(t,e){if(1&t){const t=l.Xb();l.Wb(0,"button",22),l.ic("click",(function(e){return l.Ic(t),l.mc(3).createOnly()})),l.Tc(1,"TRANSFERS.SEND"),l.Vb()}}function it(t,e){if(1&t&&(l.Wb(0,"div",18),l.Rc(1,$,2,0,"button",20),l.Rc(2,tt,2,0,"button",21),l.Rc(3,et,2,0,"button",21),l.Vb()),2&t){const t=l.mc(2);l.Ab(1),l.uc("ngIf",t.canSendAndSign),l.Ab(1),l.uc("ngIf",t.canSendAndSign),l.Ab(1),l.uc("ngIf",t.canSendOnly)}}function nt(t,e){if(1&t){const t=l.Xb();l.Ub(0),l.Wb(1,"form",6),l.Wb(2,"div",7),l.Wb(3,"j-account-dropdown",8,9),l.ic("selected",(function(e){return l.Ic(t),l.mc().onFromSelect(e)})),l.Vb(),l.Vb(),l.Wb(5,"div",10),l.Wb(6,"j-account-dropdown",11,12),l.ic("selected",(function(e){return l.Ic(t),l.mc().onToSelect(e)})),l.Vb(),l.Vb(),l.Wb(8,"div",10),l.Rb(9,"j-input",13),l.Vb(),l.Wb(10,"div",10),l.Rb(11,"j-amount-input",14),l.Rc(12,Z,2,4,"p",15),l.Vb(),l.Rc(13,z,3,0,"div",16),l.Rc(14,it,4,3,"div",16),l.Vb(),l.Tb()}if(2&t){const t=l.mc();l.Ab(1),l.uc("formGroup",t.transferForm),l.Ab(2),l.uc("hasError",t.f.from.invalid&&t.isSubmitted)("accounts",t.fromAccounts)("isDisabledSelectable",!1)("isLoading",t.isAccountsLoading)("isFromArrowShown",!0),l.Ab(3),l.uc("hasError",t.f.to.invalid&&t.isSubmitted)("accounts",t.toAccounts)("isLoading",t.isAccountsLoading)("isDisabledSelectable",!0),l.Ab(3),l.uc("hasError",t.f.documentNumber.invalid&&t.isSubmitted)("isClearable",!1)("formControl",t.f.documentNumber),l.Ab(2),l.uc("hasError",t.f.amount.invalid&&t.isSubmitted)("helperText","TRANSFERS.COMMISSION")("helperTextParams",t.commissionParams)("formControl",t.f.amount),l.Ab(1),l.uc("ngIf",t.hasUnsufficientFunds),l.Ab(1),l.uc("ngIf",t.isEditing),l.Ab(1),l.uc("ngIf",!t.isEditing)}}let ot=(()=>{class t{constructor(t,e,i,n,s,r,c,a,u,l,d,h,m,b,f,v,y){this.route=t,this.transfersService=e,this.companyService=i,this.paymentsService=n,this.accountsService=s,this.amountFormatPipe=r,this.modalService=c,this.router=a,this.maskedService=u,this.paymentsApiService=l,this.cardsService=d,this.featureFlagsService=h,this.notifierService=m,this.translateService=b,this.moneyPipe=f,this.navService=v,this.authorityPermissionsService=y,this.isRestricted=!1,this.isSubmitted=!1,this.isLoading=!0,this.repeatPayment=null,this.commissionParams={amount:this.moneyPipe.transform({amount:0,currency:g.a.KZT})},this.subscription=new p.a,this.isAccountsLoading=!0,this.transferForm=new o.k({id:new o.h(""),from:new o.h("",[o.H.required]),fromAccount:new o.h(null),to:new o.h("",[o.H.required]),toAccount:new o.h(null),documentNumber:new o.h("",[o.H.required]),amount:new o.h("",[o.H.required,t=>{var e;return 0==(null===(e=t)||void 0===e?void 0:e.value)?{cantBeZero:!0}:null}])})}ngOnInit(){const t=this.route.params.subscribe(t=>{t.id&&(this.f.id.setValue(t.id),this.isEditing=!0)});this.subscription.add(t)}ngAfterViewInit(){this.getPermission().then(()=>{this.isRestricted?this.isLoading=!1:this.initPage()}).catch(t=>{this.isLoading=!1,this.initPage()})}initPage(){const t=Object(v.a)([this.route.paramMap.pipe(Object(y.a)(()=>window.history.state)),this.featureFlagsService.featureFlags$.pipe(Object(A.a)(t=>{var e;return(null===(e=t)||void 0===e?void 0:e.length)>0}))]).subscribe(t=>{const[e]=t;this.isEditing?this.loadEditTransfer(this.f.id.value):e.repeatPaymentId?this.loadRepeatTransfer(e.repeatPaymentId):this.loadNewTransfer()}),e=this.transferForm.valueChanges.subscribe(t=>{this.isSubmitted=!1});this.subscription.add(t),this.subscription.add(e)}ngOnDestroy(){this.subscription.unsubscribe()}get fromAccounts(){var t;return null===(t=this.accounts)||void 0===t?void 0:t.filter(t=>!(t.accountType===c.a.CARD&&t.category===T.a.PRIVATE))}get toAccounts(){return this.accounts}get canSendAndSign(){return this.companyService.isSecondaryAuthority()||this.companyService.isPrimaryAuthority()&&this.companyService.isSingleSignScheme()}get canSendOnly(){return this.companyService.isNoSignAuthority()||this.companyService.isPrimaryAuthority()&&this.companyService.isMultipleSignScheme()}get f(){return this.transferForm.controls}get translateParams(){return{amount:this.amountFormatPipe.transform(this.amountDelta)}}get hasUnsufficientFunds(){return this.amountDelta>0}onFromSelect(t){t&&(this.selectFromAccount(t),this.applyClearOnFromSelectedRule(t),this.applySelectFromCompanionRule(t))}onToSelect(t){t&&(this.selectToAccount(t),this.applyClearOnToSelectedRule(t),this.applySelectToCompanionRule(t))}loadRepeatTransfer(t){return Object(f.a)(this,void 0,void 0,(function*(){this.isLoading=!0;const e=yield Promise.all([this.transfersService.getTransferById(t),this.retrieveAccounts()]);this.applyOnlyAccountRule();const[i]=e,n=yield this.mapRepeatTransferFromPayment(i);this.initRepeatTransfer(n),this.setAutoNumeration(),this.isLoading=!1}))}loadEditTransfer(t){return Object(f.a)(this,void 0,void 0,(function*(){this.isLoading=!0,this.originalPayment=yield this.transfersService.getTransferById(t);const e=yield this.mapRepeatTransferFromPayment(this.originalPayment);yield this.retrieveAccounts(),this.applyOnlyAccountRule(),this.initRepeatTransfer(e),this.isLoading=!1}))}loadNewTransfer(){return Object(f.a)(this,void 0,void 0,(function*(){this.isLoading=!0,yield this.retrieveAccounts(),this.setAutoNumeration(),this.isLoading=!1}))}edit(){return Object(f.a)(this,void 0,void 0,(function*(){if(this.isSubmitted=!0,!this.transferForm.invalid)try{yield this.transfersService.saveEditedTransfer(this.transferForm.value,this.originalPayment),this.showEditSuccess()}catch(t){this.showEditError(t)}}))}createOnly(){return Object(f.a)(this,void 0,void 0,(function*(){if(this.isSubmitted=!0,this.transferForm.invalid)return;this.isLoading=!0;const t=this.transferForm.getRawValue();if(!(yield this.checkIfAllowedToCreate(t.amount)))return void(this.isLoading=!1);const e=this.paymentsService.paymentNumber;try{yield this.transfersService.createOwnTransfer(t),this.showCreateSuccess(),e.entity=null}catch(i){e.entity=this.f.documentNumber.value,this.showCreateError(i)}finally{this.isLoading=!1}}))}createAndSign(){return Object(f.a)(this,void 0,void 0,(function*(){if(this.isSubmitted=!0,this.transferForm.invalid)return;this.isLoading=!0;const t=this.transferForm.getRawValue();if(!(yield this.checkIfAllowedToCreate(t.amount)))return void(this.isLoading=!1);const e=this.paymentsService.paymentNumber;try{yield this.transfersService.createAndSignOwnTransfer(t),this.showCreateAndSignSuccess(),e.entity=null}catch(i){e.entity=this.f.documentNumber.value,this.showCreateAndSignError(i)}finally{this.isLoading=!1}}))}getPermission(){return Object(f.a)(this,void 0,void 0,(function*(){try{this.isRestricted=yield this.authorityPermissionsService.isRestricted(S.j.IN_BETWEEN)}catch(t){this.isRestricted=!1}}))}checkIfAllowedToCreate(t){return Object(f.a)(this,void 0,void 0,(function*(){const e=yield this.paymentsApiService.checkWorkingTime(),i=yield this.paymentsApiService.checkAmountLimit(t,S.j.IN_BETWEEN);return console.log(e,i),e&&i}))}mapRepeatTransferFromPayment(t){var e,i,n,o,s;return Object(f.a)(this,void 0,void 0,(function*(){yield this.retrieveAccounts();let r=null===(e=t.details)||void 0===e?void 0:e.payerIban;return t.type!==S.j.CARD_TO_CARD&&t.type!==S.j.CARD_TO_ACCOUNT||(r=this.fromAccounts.find(e=>{var i;return e.accountType===c.a.CARD&&e.accountId===(null===(i=t.details)||void 0===i?void 0:i.payerAccountId)}).iban),{to:null===(n=null===(i=t.paymentRecipient)||void 0===i?void 0:i.recipientAccount)||void 0===n?void 0:n.iban,toAccount:this.toAccounts.find(e=>{var i,n;return e.iban===(null===(n=null===(i=t.paymentRecipient)||void 0===i?void 0:i.recipientAccount)||void 0===n?void 0:n.iban)}),from:r,fromAccount:this.fromAccounts.find(t=>t.iban===r),documentNumber:null===(o=t.details)||void 0===o?void 0:o.documentId,amount:null===(s=t.details)||void 0===s?void 0:s.paymentAmount.amount}}))}initRepeatTransfer(t){t&&(this.selectToAccountByIban(t.to),this.selectFromAccountByIban(t.from),this.f.documentNumber.setValue(t.documentNumber),this.f.amount.setValue(this.maskedService.getMaskedAmount(t.amount)))}get amountDelta(){var t,e;const{amount:i}=this.transferForm.getRawValue();return this.maskedService.getNumberedAmount(i)-(null===(e=null===(t=this.from)||void 0===t?void 0:t.balance)||void 0===e?void 0:e.amount)}applySelectToCompanionRule(t){var e,i;if(2==(null===(e=this.accounts)||void 0===e?void 0:e.length)){const e=this.findUnselectedAccount(t);this.selectFromAccount(e),null===(i=this.fromDropdown)||void 0===i||i.selectAccount(e)}}applySelectFromCompanionRule(t){var e,i;if(2==(null===(e=this.accounts)||void 0===e?void 0:e.length)){const e=this.findUnselectedAccount(t);this.selectToAccount(e),null===(i=this.toDropdown)||void 0===i||i.selectAccount(e)}}findUnselectedAccount(t){var e;return null===(e=this.accounts)||void 0===e?void 0:e.find(e=>e!=t)}findAccountByIban(t){var e;return null===(e=this.accounts)||void 0===e?void 0:e.find(e=>e.iban==t)}applyClearOnFromSelectedRule(t){var e;const i=t==this.to,n=t.iban==(null===(e=this.to)||void 0===e?void 0:e.iban)&&!i;(i||n)&&this.clearToAccount(),n&&this.notifierService.notify("default",this.translateService.instant("TRANSFERS.SAME_IBANS_NOTIFICATION"))}applyClearOnToSelectedRule(t){var e;const i=t==this.from,n=t.iban==(null===(e=this.from)||void 0===e?void 0:e.iban)&&!i;(i||n)&&this.clearFromAccount(),n&&this.notifierService.notify("default",this.translateService.instant("TRANSFERS.SAME_IBANS_NOTIFICATION"))}applyOnlyAccountRule(){var t;if(1==(null===(t=this.accounts)||void 0===t?void 0:t.length)){const t=this.accounts[0];t.isLocked||t.hasLockedState?(this.selectToAccount(t),this.toDropdown.selectAccount(t)):(this.selectFromAccount(t),this.fromDropdown.selectAccount(t))}}selectToAccount(t){var e;this.to=t,this.f.to.setValue(null===(e=this.to)||void 0===e?void 0:e.iban),this.f.toAccount.setValue(this.to)}selectFromAccount(t){var e;this.from=t,this.f.from.setValue(null===(e=this.from)||void 0===e?void 0:e.iban),this.f.fromAccount.setValue(this.from)}selectToAccountByIban(t){const e=this.findAccountByIban(t);this.selectToAccount(e),this.toDropdown.selectAccount(e)}selectFromAccountByIban(t){const e=this.findAccountByIban(t);this.selectFromAccount(e),this.fromDropdown.selectAccount(e)}clearToAccount(){var t;this.to=null,this.f.to.setValue(null),null===(t=this.toDropdown)||void 0===t||t.clearSelected()}clearFromAccount(){var t;this.from=null,this.f.from.setValue(null),null===(t=this.fromDropdown)||void 0===t||t.clearSelected()}retrieveAccounts(){return Object(f.a)(this,void 0,void 0,(function*(){this.isAccountsLoading=!0;try{yield this.accountsService.retrieveAccounts().then(t=>{const e=t.filter(t=>t.balance.currency===g.a.KZT&&t.accountType===c.a.ACCOUNT);this.accounts=this.accounts?[...this.accounts,...e]:[...e]}).catch(t=>{this.accounts=this.accounts||[],console.log(t)}),this.featureFlagsService.isDisabled(R.a.CARD_TRANSFERS)||(yield this.cardsService.getCorporateCards().then(t=>{const e=t.filter(t=>t.balance.currency===g.a.KZT);this.accounts=this.accounts?[...this.accounts,...e]:[...e]}).catch(t=>{this.accounts=this.accounts||[],console.log(t)}))}catch(t){}finally{this.isAccountsLoading=!1}}))}showEditSuccess(){const t=parseFloat(this.maskedService.getUnmaskedAmount(this.f.amount.value));this.showSuccessModal("TRANSFERS.EDIT.SUCCESS",t)}showEditError(t){return Object(f.a)(this,void 0,void 0,(function*(){try{yield this.showErrorModal("TRANSFERS.EDIT.ERROR",t),this.edit()}catch(t){this.navigateToHome()}}))}showCreateSuccess(){const t=this.maskedService.getNumberedAmount(this.f.amount.value);this.showSuccessModal("TRANSFERS.CREATE.SUCCESS",t)}showCreateError(t){return Object(f.a)(this,void 0,void 0,(function*(){try{yield this.showErrorModal("TRANSFERS.CREATE.ERROR",t),this.createOnly()}catch(t){this.navigateToHome()}}))}showCreateAndSignSuccess(){const t=this.maskedService.getNumberedAmount(this.f.amount.value);this.showSuccessModal("TRANSFERS.CREATE_AND_SIGN.SUCCESS",t,!0)}showCreateAndSignError(t){return Object(f.a)(this,void 0,void 0,(function*(){try{yield this.showErrorModal("TRANSFERS.CREATE_AND_SIGN.ERROR",t),this.createAndSign()}catch(t){this.navigateToHome()}}))}showSuccessModal(t,e,i=!1){return Object(f.a)(this,void 0,void 0,(function*(){const n=this.modalService.open(N,{backdropClass:"backdrop_light",windowClass:"modal_light modal_sm",backdrop:"static",centered:!0});n.componentInstance.description=t,n.componentInstance.totalBalance={amount:e,currency:g.a.KZT};try{yield n.result,this.navigateToHistory(i)}catch(o){this.navigateToHome()}}))}showErrorModal(t,e){var i;const n=this.modalService.open(C,{backdropClass:"backdrop_light",windowClass:"modal_light modal_sm",backdrop:"static",centered:!0});return n.componentInstance.description=t,n.componentInstance.errorText=this.mapErrors(null===(i=e)||void 0===i?void 0:i.data)||e,n.result}mapErrors(t){let e="";for(const[i,n]of Object.entries(t))e+=n+"<br>";return e||null}setAutoNumeration(){this.subscription.add(this.paymentsService.paymentNumber$.subscribe(t=>{this.f.documentNumber.setValue(t)}))}navigateToHome(){this.navService.retrieveContractBadges(),this.navService.retrieveLetterBadges(),this.router.navigate(["/"])}navigateToHistory(t=!1){let e=I.d.FOR_SIGN;this.navService.retrieveContractBadges(),this.navService.retrieveLetterBadges(),t&&this.companyService.isPrimaryAuthority()&&this.companyService.isSingleSignScheme()&&(e=I.d.IN_PROGRESS),this.router.navigate(["/history/tenge"],{queryParams:{paymentStatus:e}})}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(u.a),l.Qb(j),l.Qb(P.a),l.Qb(L.g),l.Qb(c.c),l.Qb(_.a),l.Qb(E.q),l.Qb(u.c),l.Qb(D.a),l.Qb(L.c),l.Qb(M.a),l.Qb(R.b),l.Qb(x.c),l.Qb(s.e),l.Qb(_.e),l.Qb(d.a),l.Qb(W.c))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-transfers-own"]],viewQuery:function(t,e){var i;1&t&&(l.Yc(K,!0),l.Yc(G,!0)),2&t&&(l.Ec(i=l.jc())&&(e.fromDropdown=i.first),l.Ec(i=l.jc())&&(e.toDropdown=i.first))},decls:4,vars:4,consts:[[4,"ngIf"],[3,"hidden"],["label","PAYMENTS.RESTRICTED_PLACEHOLDER",4,"ngIf"],[3,"theme"],[1,"d-flex","justify-content-end"],["label","PAYMENTS.RESTRICTED_PLACEHOLDER"],[3,"formGroup"],[1,"form-group","form-from"],["label","TRANSFERS.FROM",3,"hasError","accounts","isDisabledSelectable","isLoading","isFromArrowShown","selected"],["fromDropdown",""],[1,"form-group"],["label","TRANSFERS.TO",3,"hasError","accounts","isLoading","isDisabledSelectable","selected"],["toDropdown",""],["label","TRANSFERS.DOCUMENT_NUMBER",3,"hasError","isClearable","formControl"],["label","TRANSFERS.AMOUNT",3,"hasError","helperText","helperTextParams","formControl"],["class","text-muted p3",3,"innerHTML",4,"ngIf"],["class","form-footer",4,"ngIf"],[1,"text-muted","p3",3,"innerHTML"],[1,"form-footer"],["type","button","translate","",1,"btn","btn-outline-primary",3,"click"],["type","button","class","btn btn-outline-primary","translate","",3,"click",4,"ngIf"],["type","submit","class","btn btn-primary ml-3","translate","",3,"click",4,"ngIf"],["type","submit","translate","",1,"btn","btn-primary","ml-3",3,"click"]],template:function(t,e){1&t&&(l.Rc(0,X,7,10,"ng-container",0),l.Wb(1,"section",1),l.Rc(2,Y,1,0,"j-restricted-placeholder",2),l.Rc(3,nt,15,20,"ng-container",0),l.Vb()),2&t&&(l.uc("ngIf",e.isLoading),l.Ab(1),l.uc("hidden",e.isLoading),l.Ab(1),l.uc("ngIf",e.isRestricted),l.Ab(1),l.uc("ngIf",!e.isRestricted))},directives:[n.u,r.a,B.a,o.J,o.u,o.l,H.a,Q.b,o.t,o.i,U.a,s.a],pipes:[s.d],styles:[".form-footer[_ngcontent-%COMP%]{border-top:1px solid rgba(183,190,197,.5);display:-webkit-box;display:flex;-webkit-box-pack:end;justify-content:flex-end;margin-top:1.5rem;padding-top:1.5rem}.form-from[_ngcontent-%COMP%]{position:relative;z-index:5}"]}),t})(),st=(()=>{class t{constructor(t,e){this.router=t,this.navService=e}ngOnInit(){}onClose(){this.navService.retrieveLetterBadges(),this.navService.retrieveContractBadges(),this.router.navigate(["/"])}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(u.c),l.Qb(d.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-transfers"]],decls:7,vars:0,consts:[["closePosition","outside","colsClassList","offset-lg-2 col-lg-8 offset-xl-3 col-xl-6",3,"closed"],[1,"account-header"],["translate","",1,"f-page-title"]],template:function(t,e){1&t&&(l.Wb(0,"f-page",0),l.ic("closed",(function(t){return e.onClose()})),l.Wb(1,"f-page-header"),l.Wb(2,"section",1),l.Wb(3,"h1",2),l.Tc(4,"TRANSFERS.TITLE"),l.Vb(),l.Vb(),l.Vb(),l.Wb(5,"f-page-body"),l.Rb(6,"j-transfers-own"),l.Vb(),l.Vb())},directives:[h.a,m.a,s.a,b.a,ot],styles:[""]}),t})();const rt=[{path:"",component:st,data:{title:"TRANSFERS.TITLE"}},{path:":id",component:st},{path:"**",redirectTo:""}];let ct=(()=>{class t{}return t.\u0275mod=l.Ob({type:t}),t.\u0275inj=l.Nb({factory:function(e){return new(e||t)},imports:[[u.g.forChild(rt)],u.g]}),t})();i.d(e,"TransfersModule",(function(){return at}));let at=(()=>{class t{}return t.\u0275mod=l.Ob({type:t}),t.\u0275inj=l.Nb({factory:function(e){return new(e||t)},imports:[[n.c,o.n,o.D,r.b,ct,c.b,a.a,s.c]]}),t})()}}]);